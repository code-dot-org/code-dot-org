window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

// Setup Google Analytics tag and dimensions
(function () {
    gtag('js', new Date());
    gtag('config', 'G-L9HT5MZ3HD');
    gtag('set', {'dimension1': '<%=request.language%>'});
    gtag('set', {'dimension4': '<%=user_type%>'});
})();

(function () {
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-37745279-1', '<%=request.site%>');

  ga('set', 'anonymizeIp', true);
  ga('set', 'dimension1', '<%=request.language%>');
  ga('set', 'dimension4', '<%=user_type%>');

  ga('send', 'pageview');

  function trackEvent(category, action, label, value) {
    ga('send', 'event', category, action, label, value);
  }

  function readCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
      var c = ca[i];
      while (c.charAt(0)==' ') c = c.substring(1,c.length);
      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
  }
  window.trackEvent = trackEvent;
  window.readCookie = readCookie;
  })();
window.addEventListener('load', function() {
  var ga = document.createElement('script');
  ga.type = 'text/javascript';
  ga.async = true;
  ga.src = 'https://www.google-analytics.com/analytics.js';
  document.body.appendChild(ga);
});

<!-- Google Tag Manager -->
(function(w,d,s,l,i){
    w[l]=w[l]||[];
    w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
    j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;
    f.parentNode.insertBefore(j,f);

})(window,document,'script','dataLayer','GTM-TZZBRK5');


<!-- End Google Tag Manager -->
