require 'digest'

module HashUtils
  def self.file_contents_hash(file_globs)
    # Resolve all file patterns to individual file names
    file_names = Dir[*file_globs].
      select {|file_name| File.file?(file_name)}.
      sort

    # For each file, concat its name with a hash of its contents.
    # We include the file name here so renaming a file will generate a different result hash.
    intermediate_hashes = file_names.map {|f| f + Digest::MD5.file(f).hexdigest}

    # The final result is generated by joining all intermediate hashes, and then hashing that.
    return Digest::MD5.hexdigest(intermediate_hashes.join)
  end
end
