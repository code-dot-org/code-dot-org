# Our entry into our docker development environment is described here.

# For an overview of how to use the Docker Development Environment see `DOCKER.md`

# It is split among a few different files that are then merged together via
# the following `include` section.

include:
  # Services the dashboard server depends on
  - path: ./docker/developers/docker-compose.mysql.yml
  - path: ./docker/developers/docker-compose.redis.yml

  # Selenium services for UI testing
  - path: ./docker/developers/docker-compose.selenium.yml

  # MinIO S3 Emulation
  - path: ./docker/developers/docker-compose.minio.yml

  # The dashboard server
  - path: ./docker/developers/docker-compose.dashboard.yml

services:
  all-services:
    image: alpine
    depends_on:
      - dashboard-services
      - s3-services
    command: >
      /bin/sh -c "
        echo 'All dashboard services running (MySQL, Redis, MinIO).' &&
        echo &&
        echo 'To shut down all containers:' &&
        echo 'docker compose stop' &&
        echo &&
        echo 'To run the native dashboard server:' &&
        echo './bin/dashboard-server' &&
        echo &&
        echo 'Be sure to have the following in your locals.yml to link to the contained services:' &&
        echo &&
        echo 'db_writer: mysql://root:password@127.0.0.1/' &&
        echo 'db_endpoint_writer: 127.0.0.1' &&
        echo 'db_credential_admin:' &&
        echo '  username: user' &&
        echo '  password: password' &&
        echo 'cloudfront_key_pair_id: localoverride' &&
        echo 'cloudfront_private_key: localoverride' &&
        echo 'slack_bot_token: localoverride' &&
        echo \"properties_encryption_key: ''\" &&
        echo 'aws_s3_endpoint: http://localhost:9000' &&
        echo 'aws_access_key_id: local-development' &&
        echo 'aws_secret_access_key: allstudents'
      "
