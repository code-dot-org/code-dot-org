#!/usr/bin/env ruby
require_relative '../deployment'

def main()
  run_cmd = if rack_env? :development
    rerun_cmd = "rerun -p '**/*.{rb,ru,yml}' -d'#{deploy_dir('lib')},#{deploy_dir('shared/middleware')},#{pegasus_dir}' --"
    "#{CDO.dashboard_enable_pegasus && rerun_cmd} rackup"
  else
    "unicorn -c #{dashboard_dir('config/unicorn.rb')}"
  end

  Dir.chdir(dashboard_dir) do
    system "RAILS_ENV=#{CDO.rack_env} bundle exec #{run_cmd} -e #{CDO.rack_env} -p #{CDO.dashboard_port}"
  end
end

main
