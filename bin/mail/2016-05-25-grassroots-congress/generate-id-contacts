#!/usr/bin/env ruby
require_relative '../mailing-common/mailing-list-utils'

# ID: teachers and petition signers from a specific list of zip-codes in the state

# Zip codes provided by marketing team.
ZIP_CODES = %q(
  83111, 83120, 83201, 83202, 83203, 83204, 83209, 83210, 83211, 83212, 83213,
  83214, 83215, 83217, 83218, 83220, 83221, 83223, 83226, 83227, 83228, 83232,
  83233, 83234, 83235, 83236, 83237, 83238, 83239, 83241, 83243, 83244, 83245,
  83246, 83250, 83251, 83252, 83253, 83254, 83255, 83261, 83262, 83263, 83271,
  83272, 83274, 83276, 83277, 83278, 83281, 83283, 83285, 83286, 83287, 83301,
  83302, 83311, 83312, 83313, 83314, 83316, 83318, 83320, 83321, 83322, 83323,
  83324, 83325, 83327, 83328, 83330, 83332, 83333, 83334, 83335, 83336, 83337,
  83338, 83340, 83341, 83342, 83344, 83346, 83347, 83348, 83349, 83350, 83352,
  83353, 83354, 83355, 83401, 83402, 83404, 83406, 83420, 83421, 83422, 83423,
  83424, 83425, 83427, 83428, 83429, 83431, 83433, 83434, 83435, 83436, 83440,
  83442, 83443, 83444, 83445, 83446, 83448, 83449, 83450, 83451, 83452, 83454,
  83455, 83460, 83462, 83463, 83464, 83465, 83466, 83467, 83468, 83469, 83601,
  83616, 83623, 83624, 83627, 83633, 83647, 83648, 83702, 83703, 83704, 83705,
  83706, 83709, 83712, 83713, 83714, 83716
).split(',').map(&:strip).join(' OR ')

query = %Q(
  (
    (kind_s:user && role_s:teacher) ||
    kind_s:Petition
  ) && (
    (
      state_code_s:id &&
      zip_code_s:(#{ZIP_CODES})
    ) || (
      create_ip_state_s:Idaho &&
      create_ip_postal_code_s:(#{ZIP_CODES})
    )
  )
)

results = query_subscribed_contacts(q: query)
puts "#{results.count} ID contacts"

export_contacts_to_csv results, 'id-contacts.csv'
