#!/usr/bin/env ruby

# This script removes the 'survey2016_' prefix from the keys in the JSON
# SurveyResult.properties hash for SurveyResult's of kind DiversitySurvey2016.

require_relative '../../../dashboard/config/environment'

PREFIX_TO_REMOVE = 'survey2016_'.freeze

SurveyResult.
  where(kind: SurveyResult::DIVERSITY_2016).
  find_each do |survey_result|
  # The keys to transform are in the properties column, so extract them from the
  # JSON.
  transformed_properties = {}
  survey_result.properties.each do |key, value|
    raise unless key.start_with? PREFIX_TO_REMOVE
    transformed_properties[key.gsub(PREFIX_TO_REMOVE, '')] = value
  end
  survey_result.update!(properties: transformed_properties)
end
