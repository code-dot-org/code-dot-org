- content_for(:head) do
  = stylesheet_link_tag 'css/levelbuilder', media: 'all'
  = stylesheet_link_tag 'jquery.handsontable.full', media: 'all'
  %script{src: minifiable_asset_path('js/levelbuilder.js')}
  = javascript_include_tag 'jquery.handsontable.full'

- content_for :body_scripts do
  - video_infos = {}
  - Video.all.each { |video| video_infos[video.key] = video.summarize(false) }
  - script_data = { editorall: { video_infos: video_infos }.to_json }
  %script{src: minifiable_asset_path('js/levels/editors/_all.js'), data: script_data}

- unless @level.is_a?(DSLDefined) || @level.is_a?(Unplugged)
  .field
    = f.label :display_name
    %p Optionally override how this level is displayed on the Course Overview page.
    = f.text_field :display_name, placeholder: '(defaults to Name)'
  .field
    = f.label 'notes'
    %p
      Notes for yourself or other Levelbuilders. Viewable here and here alone.
    = f.text_area :notes, rows: 6, class: "input-block-level"

- if (@level.uses_droplet?) || @level.is_a?(Blockly)
  .field
    = f.label :thumbnail_url, 'Optional thumbnail URL (overrides default thumbnail)'
    = f.text_field :thumbnail_url

  .field
    = f.label :failure_message_override, 'Failure Message Override'
    %p If specified this error message will be used to replace ALL error messages in the puzzle. Be certain this is what you want before using.
    = f.text_field :failure_message_override, style: 'width: 600px;', placeholder: 'Type Override Failure Message Here'

%legend.control-legend{data: {toggle: "collapse", target: "#audit_log_info"}}
  Audit Log

%p A log of the people who most recently edited this level (up to the last 10 people)

#audit_log_info.collapse
  = render partial: 'levels/editors/audit_log', locals: {f: f}

- if @level.respond_to?(:free_play) || (@level.uses_droplet?) || @level.is_a?(Blockly)
  = render partial: 'levels/editors/sub_level_types', locals: {f: f}

- if @level.is_a?(Weblab) || (@level.uses_droplet?) || @level.is_a?(Blockly) || @level.respond_to?(:disable_sharing)
  %legend.control-legend{data: {toggle: "collapse", target: "#shareAndRemix"}}
    Share and Remix Settings

  #shareAndRemix.collapse
    -if @level.is_a?(Weblab) || (@level.uses_droplet?) || @level.is_a?(Blockly)
      = render partial: 'levels/editors/hide_share_and_remix', locals: {f: f}

    - if @level.respond_to? :disable_sharing
      .field
        = render partial: 'levels/editors/checkboxes', locals: {f: f, field_name: :disable_sharing, description: "Disable sharing"}
        %p If set, this level cannot be shared or saved to galleries even if it's free play.

%legend.control-legend{data: {toggle: "collapse", target: "#concepts"}}
  Concepts

#concepts.collapse
  = f.label 'concepts'
  %p
    Select
    %a.select_all{href: '#'} all
    \/
    %a.select_none{href: '#'} none
    (shift-click or cmd-click to select multiple).
  = f.collection_select :concept_ids, Concept.cached, :id, :name, { :selected => @level.concept_ids }, { :multiple => true, :name => 'level[concept_ids][]', :size => Concept.cached.length }

  -# We can only save a related LevelConceptDifficulty object for a level that's already been created, not for a new level about to be created
  - if @level && @level.id
    .field
      = f.label 'concept difficulties'
      %a{href: "https://docs.google.com/spreadsheets/d/1jPVTIqsIH6qLUd_WlKtzE7CEiaQG-hqM9n_A1hY-rL0"} Concept Difficulty Tagging guidelines
      %table{style: 'width: 80%'}
        %thead
          %tr
            %th Concept
            %th Difficulty
        %tbody
          - concept_difficulty = @level.level_concept_difficulty || LevelConceptDifficulty.new(level:@level)
          %input{type: 'hidden', name: "level[level_concept_difficulty_attributes][id]", value: concept_difficulty.id}
          - LevelConceptDifficulty::CONCEPTS.each do |concept|
            - difficulty = concept_difficulty.send(concept)
            %tr
              %td
                = concept
              %td
                = select_tag "level[level_concept_difficulty_attributes][#{concept}]", options_for_select((1..LevelConceptDifficulty::MAXIMUM_CONCEPT_DIFFICULTY).to_a, difficulty), include_blank: true

%legend.control-legend{data: {toggle: "collapse", target: "#reference"}}
  Video & Reference Materials

%p Video settings. Map reference. Reference Links.

#reference.collapse
  .field
    = f.label :video_key, 'Level Video'
    %p
      Add new videos by going to
      %a{href:"/videos/new"} the add video page
      - if @level.is_a?(DSLDefined)
        %p Warning: This is a DSL defined level. You can use the dropdown to find the video key that you'd like to use, but selecting in the dropdown will NOT be sufficient to associate the video with the level. If you'd like to add a video to this level you need to add video_key 'video_key' to the DSL box.
    = f.select :video_key, options_for_select(video_key_choices, @level.video_key), {include_blank: true}, {class: 'video-dropdown'}
    .video-preview{style: 'display: block'}

  - if (@level.uses_droplet?) || @level.is_a?(Blockly)
    .field
      = render partial: 'levels/editors/checkboxes', locals: {f: f, field_name: :never_autoplay_video, description: "Never autoplay video"}

  .field
    = f.label :map_reference, 'Map Reference'
    %p If there is a key resource you want to reference in the instructions, add the link here. It will show up under the 'Help & Tips' tab.
    %p This should be a string representing the URL on docs.code.org you want to embed, i.e. '/docs/csd/maker_leds/index.html'.
    = f.text_field :map_reference, placeholder: 'Map Reference'

  .field
    = f.label :reference_link, 'Reference Links'
    %p Add links to pages on Curriculum Builder below. They will show up in the 'Help & Tips' tab below any videos and the map reference.
    %p These should be strings representing the URL on [docs|curriculum].code.org you want to embed, i.e. '/docs/csd/maker_leds/index.html' or '/curriculum/path/to/file'.
    %p Put each link on a new line
    .row
      .span8
        - @level.reference_links = [''] unless @level.reference_links.try(:present?)
        = text_area_tag 'level[reference_links]', @level.reference_links.join("\r\n"), rows: 6, class: "input-block-level", placeholder: 'Additional Reference Link'

- if (@level.uses_droplet?) || @level.is_a?(Blockly)
  %legend.control-legend{data: {toggle: "collapse", target: "#assets"}}
    Preload Asset List

  #assets.collapse
    = f.label :preload_asset_list, 'Preload asset list'
    %p A list of assets to be preloaded at page load time. The extension must be mp3, ogg, png, gif, jpg, jpeg, mov, or mp4. (click the plus sign to add an asset)
    - @level.preload_asset_list = [''] unless @level.preload_asset_list.try(:present?)
    - @level.preload_asset_list.each do |url|
      = text_field_tag 'level[preload_asset_list][]', url, placeholder: 'Asset URL', style: 'width: 100%; box-sizing: border-box; min-height: 28px;'
    #plusPreloadAssetList
      %i.fa.fa-plus-circle

=render partial: 'levels/editors/callouts', locals: {f: f}
