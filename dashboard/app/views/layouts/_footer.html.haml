- require 'cdo/footer'
- full_width = local_assigns[:full_width]
- options = {ge_region: params[:ge_region]}
- footer_contents = Cdo::Footer.get_footer_contents(options)
- locale_options = Cdo::Footer.get_locale_options(options)
.navbar-static-top.footer
  .container{ style: 'padding: 10px;' + (full_width ? 'margin: auto' : '') }
    .row
      .span9{style: (full_width ? 'max-width: 80%;' : '')}
        - piped_spaces = ' | '
        - privacy_updated = DCDO.get('recent_privacy_policy_update', nil)
        - links = (footer_contents[:links] || []).map(&:dup)
        - if privacy_updated
          - links.reject! { |link| link[:title] == 'privacy' }
        - else
          - links.reject! { |link| link[:title] == 'privacy_updated' }
        - links.each_with_index do |link, index|
          - if link[:domain] == 'studio.code.org'
            - link[:url] = CDO.studio_url(link[:url])
          - elsif link[:domain] == 'code.org'
            - link[:url] = CDO.code_org_url(link[:url])
          - else
            - link[:rel] = "noopener noreferrer nofollow"
          = link_to t("footer.#{link[:title]}"), link[:url], link.except(:title, :url, :domain)
          - unless index == links.length - 1
            .dim!= piped_spaces
        %br/

        %small.fineprint.dim
          %br/
          = sanitize(t('footer.help_from_html_old'), tags: %w(a br), attributes: %w(href))
          %br/
          = sanitize(t('footer.art_from_html_old', current_year: Time.now.year), tags: %w(a br), attributes: %w(href))
          %br/
          = sanitize(t('footer.trademark', current_year: Time.now.year, cs_discoveries: "CS Discoveries&reg;"), tags: %w(a br), attributes: %w(href))
          %br/
          = sanitize(t('footer.built_on_github'), tags: %w(a br), attributes: %w(href))
        %div.powered-by-aws
          %a{:href=>"https://aws.amazon.com/what-is-cloud-computing"}
            %img{:src=>"/shared/images/Powered-By_logo-horiz_RGB_REV.png", :alt=>"Powered by AWS Cloud Computing", :style=>"width: 190px"}

      .span3{style: 'float: right;' + (full_width ? 'width: 140px; margin-left: 0px' : '')}
        -# NOTE UTF-8 is not being enforced for this form. Do not modify it to accept
        -# user input or to persist data without also updating it to enforce UTF-8
        = form_tag(locale_url, method: :post, id: 'localeForm', style: 'margin-bottom: 0px;', enforce_utf8: false) do
          = hidden_field_tag :user_return_to, request.url
          = select_tag :locale, options_for_select(locale_options, locale), { onchange: 'this.form.submit();', 'aria-label':  t('footer.locale_select', default: 'Select language') }
        %small.dim
          !="&copy; Code.org, #{Time.now.year}"
