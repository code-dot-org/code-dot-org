<Pythonlab>
  <config><![CDATA[{
  "game_id": 72,
  "created_at": "2024-09-17T22:37:21.000Z",
  "level_num": "custom",
  "user_id": 18602,
  "properties": {
    "encrypted": "false",
    "long_instructions": "# Magic Potion\r\n\r\n::: details [**✅ Step 1**]\r\nFilter for all **root** ingredients that have a non-null *\"Source\"*. Print the total amount of entries found.\r\n:::\r\n\r\n::: details [**✅ Step 2**]\r\nFilter for all ingredients whose *\"Effect\"* ends with **\"ing\"**. Print the filtered DataFrame.\r\n:::\r\n\r\n::: details [**✅ Step 3**]\r\nFilter for all **legendary** quality ingredients that come from the **forest** and which are used for **transformation**. Print the filtered DataFrame.\r\n:::\r\n\r\n::: details [**✅ Step 4**]\r\nCalculate the **total** and **median** *\"QuantityAvailable\"* for each *\"Category\"*.\r\n:::\r\n",
    "ai_tutor_available": "false",
    "submittable": "false",
    "hide_share_and_remix": "false",
    "predict_settings": {
      "isPredictLevel": false
    },
    "start_sources": {
      "files": {
        "0": {
          "id": "0",
          "name": "main.py",
          "language": "py",
          "contents": "import pandas as pd\n\n\ndf = pd.read_csv('magical_potion_ingredients.csv')\n\n# Step 1\nfiltered_herbs = df[(df['Category'] == 'root') & (df['Source'].notnull())]\nprint(len(filtered_herbs))\n\n# Step 2\nfiltered_effects = df[df['Effect'].str.endswith('ing')]\nprint(filtered_effects)\n\n# Step 3\nfiltered_rare_forest = df[(df['Rarity'] == 'legendary') & (df['Source'] == 'forest')]\nprint(filtered_rare_forest)\n\n# Step 4\ncategory_agg = df.groupby('Category')['QuantityAvailable'].agg(['sum', 'mean']).reset_index()\nprint(category_agg)\n",
          "folderId": "0",
          "active": false,
          "open": true
        },
        "1": {
          "id": "1",
          "name": "magical_potion_ingredients.csv",
          "language": "csv",
          "contents": "IngredientName,Category,Effect,QuantityAvailable,Source,Rarity,ExpirationDate\nMoonshade Blossom,mineral,healing,50,desert,rare,10/18/2023\nDragonfire Root,mineral,invisibility,10,desert,rare,9/6/2023\nStarlight Dust,herb,strength,33,swamp,rare,10/10/2023\nWhispering Leaf,essence,wisdom,27,sea,uncommon,12/27/2024\nPhoenix Feather,herb,speed,27,swamp,rare,7/1/2024\nMystic Crystal,essence,transformation,46,forest,uncommon,9/29/2023\nShadow Vine,root,levitation,3,sea,common,2/12/2023\nEldertree Bark,mineral,fire resistance,26,swamp,rare,3/19/2024\nMermaid Scale,essence,water breathing,86,desert,epic,11/5/2024\nSunstone Shard,essence,night vision,3,swamp,rare,2/28/2023\nNightshade Berry,flower,teleportation,59,forest,epic,7/31/2024\nFrostflower,root,mind control,5,,uncommon,8/14/2023\nThunderclap Seed,herb,clairvoyance,33,mountain,rare,8/20/2023\nGolden Nectar,mineral,shielding,84,forest,common,8/29/2023\nSilverthorn,essence,regeneration,2,sea,common,10/14/2023\nCrimson Petal,essence,shape-shifting,83,swamp,common,11/15/2024\nSpirit Essence,,enhanced hearing,75,forest,common,7/31/2025\nGoblin Ear,root,enhanced sight,2,forest,common,6/28/2024\nFairy Wing,herb,truth serum,88,mountain,uncommon,2/6/2024\nGriffin Claw,herb,fear inducement,18,mountain,common,3/11/2024\nWraithbone,flower,dream manipulation,79,swamp,rare,11/16/2025\nTroll Moss,essence,healing,93,sea,epic,6/8/2023\nBasilisk Scale,flower,invisibility,5,desert,common,10/13/2024\nCelestial Dew,mineral,strength,87,mountain,common,1/23/2024\nAbyssal Pearl,mineral,wisdom,93,,uncommon,12/15/2024\nSiren's Song,mineral,speed,75,desert,epic,1/31/2025\nDragon's Breath,essence,transformation,21,desert,common,10/21/2024\nSylvan Leaf,root,levitation,4,desert,uncommon,9/16/2025\nSpectral Mist,,fire resistance,95,,rare,6/21/2023\nInferno Gem,mineral,water breathing,100,,uncommon,2/19/2024\nEchoing Stone,herb,night vision,32,swamp,uncommon,12/10/2023\nLuminous Dewdrop,herb,teleportation,24,swamp,epic,12/17/2024\nArcane Powder,essence,mind control,86,forest,rare,11/13/2024\nPhantom Silk,herb,clairvoyance,24,desert,common,1/16/2024\nTitan's Blood,herb,shielding,95,swamp,common,2/10/2025\nFae Dust,herb,regeneration,66,mountain,rare,2/29/2024\nGlacial Ice,herb,shape-shifting,68,mountain,rare,11/4/2025\nVolcanic Ash,herb,enhanced hearing,6,mountain,rare,12/31/2024\nDwarven Beard,essence,enhanced sight,67,desert,common,10/30/2023\nEnchanted Root,mineral,truth serum,58,desert,uncommon,3/24/2025\nMoonlit Water,flower,fear inducement,15,,uncommon,9/9/2025\nElven Hair,essence,dream manipulation,95,forest,common,11/21/2023\nNecrotic Bone,flower,healing,96,forest,legendary,6/5/2025\nRadiant Shard,herb,invisibility,13,swamp,uncommon,5/17/2025\nWolfsbane,root,strength,6,sea,epic,3/21/2023\nEtherial Mist,mineral,wisdom,64,sea,uncommon,7/18/2024\nStormbringer,essence,speed,47,mountain,uncommon,7/6/2025\nLeviathan Scale,mineral,transformation,10,desert,rare,12/21/2025\nMystic Mushroom,root,levitation,3,,epic,6/9/2023\nGlimmerweed,root,fire resistance,4,desert,,7/14/2024\nHallowed Petal,mineral,water breathing,69,forest,common,6/21/2023\nCinder Blossom,flower,night vision,48,forest,uncommon,4/20/2024\nVampire Blood,herb,teleportation,93,desert,uncommon,7/25/2023\nAzure Feather,essence,mind control,82,desert,uncommon,11/30/2024\nObsidian Shard,root,clairvoyance,2,mountain,rare,8/3/2024\nRunic Stone,mineral,shielding,14,forest,rare,5/3/2024\nGolden Apple,essence,regeneration,52,swamp,epic,7/31/2023\nStardust,root,shape-shifting,3,mountain,rare,6/3/2023\nMystic Root,essence,enhanced hearing,16,desert,rare,12/13/2025\nShadow Essence,root,enhanced sight,7,mountain,,11/12/2025\nCelestial Herb,root,truth serum,5,sea,rare,7/1/2023\nFrostbite,root,fear inducement,11,sea,rare,3/6/2024\nThunder Seed,herb,dream manipulation,81,mountain,common,1/17/2024\nMoonstone,root,healing,2,swamp,rare,12/18/2023\nSpecter Leaf,herb,invisibility,33,desert,common,4/14/2023\nPhoenix Down,flower,strength,31,desert,,11/9/2024\nElderberry,mineral,wisdom,19,forest,uncommon,12/15/2023\nGiant's Toe,,speed,56,sea,,2/18/2023\nAngel's Tear,essence,transformation,58,forest,legendary,11/21/2024\nMermaid Tear,herb,levitation,17,mountain,common,10/10/2025\nDragon Heart,root,fire resistance,2,mountain,rare,6/1/2023\nWhispering Moss,mineral,water breathing,89,,rare,5/20/2024\nSilver Bloom,flower,night vision,78,,rare,11/11/2025\nCrystal Petal,essence,teleportation,27,desert,common,1/9/2023\nGoblin Tooth,herb,mind control,33,swamp,rare,5/27/2025\nFairy Dust,flower,clairvoyance,4,,rare,12/7/2023\nGriffin Feather,root,shielding,3,sea,common,7/17/2025\nWraith Essence,root,regeneration,5,desert,rare,11/7/2024\nTroll's Blood,,shape-shifting,65,desert,rare,11/7/2023\nBasilisk Tooth,herb,enhanced hearing,87,desert,,8/10/2024\nCelestial Herb,herb,enhanced sight,16,mountain,epic,4/3/2024\nAbyssal Root,root,truth serum,2,mountain,common,2/10/2023\nSiren's Hair,root,fear inducement,1,swamp,uncommon,3/23/2024\nDragon Scale,flower,dream manipulation,41,desert,rare,7/17/2024\nSylvan Petal,mineral,healing,4,sea,epic,5/15/2023\nSpectral Shard,essence,invisibility,60,swamp,common,4/18/2023\nInferno Seed,root,strength,5,mountain,rare,12/20/2025\nEchoing Feather,herb,wisdom,36,forest,legendary,12/8/2025\nLuminous Petal,essence,speed,34,mountain,rare,1/12/2023\nArcane Gem,essence,transformation,63,swamp,,1/12/2023\nPhantom Powder,herb,levitation,5,swamp,common,5/26/2024\nTitan's Bone,root,fire resistance,2,sea,uncommon,2/5/2024\nFae Feather,herb,water breathing,49,swamp,common,2/20/2023\nGlacial Shard,essence,night vision,49,swamp,rare,6/11/2024\nVolcanic Stone,essence,teleportation,80,mountain,epic,10/8/2023\nDwarven Root,herb,mind control,65,forest,uncommon,3/20/2024\nEnchanted Berry,essence,clairvoyance,14,swamp,epic,3/4/2025\nMoonlit Petal,root,shielding,3,forest,uncommon,9/20/2023\nElven Root,flower,regeneration,88,sea,epic,10/13/2025\nNecrotic Shard,herb,shape-shifting,14,forest,rare,7/6/2025\nRadiant Petal,flower,enhanced hearing,56,desert,common,4/2/2025\nWolfsbane Root,essence,enhanced sight,71,desert,,4/15/2024\nEtherial Leaf,root,truth serum,5,forest,epic,1/4/2025\nDragon's Claw,root,fear inducement,3,swamp,epic,10/14/2024\n",
          "folderId": "0",
          "active": false,
          "open": true
        },
        "2": {
          "id": "2",
          "name": "test.py",
          "language": "py",
          "contents": "import ast\nimport unittest\n\nclass TestFilterAndAggregation(unittest.TestCase):\n    def setUp(self):\n        import os\n        possible_files = [f for f in os.listdir() if f.endswith(\".py\") and \"test\" not in f.lower()]\n        if not possible_files:\n            raise FileNotFoundError(\"No student solution file found in the directory.\")\n        filename = possible_files[0]\n\n        with open(filename, \"r\") as file:\n            self.tree = ast.parse(file.read())\n\n    def detect_notnull_filter_on_source(self):\n        \"\"\"Detects filtering using .notnull() on the 'Source' column.\"\"\"\n        for node in ast.walk(self.tree):\n            if isinstance(node, ast.Call) and isinstance(node.func, ast.Attribute):\n                if (node.func.attr == 'notnull' and\n                    isinstance(node.func.value, ast.Subscript) and\n                    node.func.value.slice.value == 'Source'):\n                    return True\n        return False\n\n    def detect_endswith_filter_on_effect(self):\n        \"\"\"Detects filtering using .str.endswith('ing') on the 'Effect' column.\"\"\"\n        for node in ast.walk(self.tree):\n            if isinstance(node, ast.Call) and isinstance(node.func, ast.Attribute):\n                if (node.func.attr == 'endswith' and\n                    isinstance(node.func.value, ast.Attribute) and\n                    node.func.value.attr == 'str' and\n                    isinstance(node.func.value.value, ast.Subscript) and\n                    node.func.value.value.slice.value == 'Effect'):\n                    if isinstance(node.args[0], ast.Constant) and node.args[0].value == 'ing':\n                        return True\n        return False\n\n    def detect_filter_legendary_forest_transformation(self):\n        \"\"\"Detects filtering for legendary ingredients from the forest used for transformation.\"\"\"\n        for node in ast.walk(self.tree):\n            if isinstance(node, ast.BoolOp) and isinstance(node.op, ast.And):\n                legendary_detected = False\n                forest_detected = False\n                transformation_detected = False\n\n                for condition in node.values:\n                    if isinstance(condition, ast.Compare):\n                        if isinstance(condition.left, ast.Subscript):\n                            # Check for legendary rarity\n                            if (condition.left.slice.value == 'Rarity' and \n                                isinstance(condition.comparators[0], ast.Constant) and \n                                condition.comparators[0].value == 'legendary'):\n                                legendary_detected = True\n                            # Check for forest source\n                            if (condition.left.slice.value == 'Source' and \n                                isinstance(condition.comparators[0], ast.Constant) and \n                                condition.comparators[0].value == 'forest'):\n                                forest_detected = True\n                            # Check for 'Use' or similar column for transformation\n                            if (condition.left.slice.value in ['Use', 'Purpose', 'Usage'] and \n                                isinstance(condition.comparators[0], ast.Constant) and \n                                condition.comparators[0].value in ['transformation', 'alchemy', 'morphing']):\n                                transformation_detected = True\n\n                if legendary_detected and forest_detected and transformation_detected:\n                    return True\n        return False\n\n    def detect_groupby_and_aggregation_on_category(self):\n        \"\"\"Detects a groupby on 'Category' followed by aggregation on 'QuantityAvailable' using sum and mean.\"\"\"\n        for node in ast.walk(self.tree):\n            if isinstance(node, ast.Call) and isinstance(node.func, ast.Attribute):\n                # Check for .agg() function used after groupby\n                if node.func.attr == 'agg' and isinstance(node.func.value, ast.Call):\n                    groupby_call = node.func.value\n                    if (isinstance(groupby_call.func, ast.Attribute) and\n                        groupby_call.func.attr == 'groupby' and\n                        isinstance(groupby_call.args[0], ast.Constant) and\n                        groupby_call.args[0].value == 'Category'):\n                        # Check for aggregation on sum and mean\n                        if isinstance(node.args[0], ast.Dict):\n                            if any(isinstance(key, ast.Constant) and key.value == 'QuantityAvailable' for key in node.args[0].keys):\n                                for value in node.args[0].values:\n                                    if (isinstance(value, ast.List) and\n                                        any(isinstance(elt, ast.Constant) and elt.value in ['sum', 'mean', 'median'] for elt in value.elts)):\n                                        return True\n        return False\n\n    def test_step_1_root_ingredients_notnull_source(self):\n        \"\"\"Filter for root ingredients that have a non-null 'Source'.\"\"\"\n        notnull_filter_detected = self.detect_notnull_filter_on_source()\n        self.assertTrue(notnull_filter_detected, \"Filter for root ingredients that have a non-null 'Source'.\")\n\n    def test_step_2_endswith_ing_on_effect(self):\n        \"\"\"Filter for ingredients whose 'Effect' ends with 'ing'.\"\"\"\n        endswith_filter_detected = self.detect_endswith_filter_on_effect()\n        self.assertTrue(endswith_filter_detected, \"Filter for ingredients whose 'Effect' ends with 'ing'.\")\n\n    def test_step_3_legendary_forest_transformation_filter(self):\n        \"\"\"Filter for legendary ingredients from the forest used for transformation.\"\"\"\n        legendary_filter_detected = self.detect_filter_legendary_forest_transformation()\n        self.assertTrue(legendary_filter_detected, \"Filter for legendary ingredients from the forest used for transformation.\")\n\n    def test_step_4_groupby_on_category_aggregation_quantity(self):\n        \"\"\"Calculate the total and median 'QuantityAvailable' for each Category.\"\"\"\n        aggregation_detected = self.detect_groupby_and_aggregation_on_category()\n        self.assertTrue(aggregation_detected, \"Calculate the total and median 'QuantityAvailable' for each Category.\")\n\nif __name__ == \"__main__\":\n    unittest.main()\n",
          "folderId": "0",
          "active": true,
          "open": true,
          "type": "validation"
        }
      },
      "folders": {
      },
      "openFiles": [
        "0",
        "1",
        "2"
      ]
    },
    "display_name": "Magic Potion Ingredients",
    "bubble_choice_description": "Practice using pandas functions to filter a dataset that contains information about a variety of fictional ingredients which can be used to brew up different magical effects.",
    "thumbnail_url": "https://images.code.org/6bce4a9a1e6e864045e7fccf95d57a10-potion.png",
    "teacher_markdown": "**Student Takeaways:**\r\n- Students learn how to filter a dataset based on multiple conditions, including non-null values, specific string patterns, and categorical attributes. \r\n- Students understand how to calculate and interpret aggregate measures such as total and median values within specific categories, which is essential for summarizing data.\r\n\r\n**Possible Misconceptions and/or Difficulties:**\r\n- Students might struggle with combining multiple conditions in a filter, especially when mixing different types of criteria like string methods, categorical filtering, and non-null checks.\r\n- There might be confusion about how to correctly use aggregation functions like sum() and median() in pandas, particularly in grouping data by categories.\r\n"
  },
  "published": true,
  "audit_log": "[{\"changed_at\":\"2024-09-17T22:37:21.492+00:00\",\"changed\":[\"cloned from \\\"datascience-U2L9-L8d_2024-pilot\\\"\"],\"cloned_from\":\"datascience-U2L9-L8d_2024-pilot\"},{\"changed_at\":\"2024-09-17 22:42:57 +0000\",\"changed\":[\"long_instructions\",\"predict_settings\",\"display_name\",\"bubble_choice_description\",\"thumbnail_url\",\"teacher_markdown\"],\"changed_by_id\":18602,\"changed_by_email\":\"angelina+levelbuilder@code.org\"},{\"changed_at\":\"2024-09-17 22:44:41 +0000\",\"changed\":[\"start_sources\"],\"changed_by_id\":18602,\"changed_by_email\":\"angelina+levelbuilder@code.org\"},{\"changed_at\":\"2024-10-02 00:49:33 +0000\",\"changed\":[\"start_sources\"],\"changed_by_id\":18602,\"changed_by_email\":\"angelina+levelbuilder@code.org\"},{\"changed_at\":\"2024-10-02 00:49:38 +0000\",\"changed\":[\"predict_settings\"],\"changed_by_id\":18602,\"changed_by_email\":\"angelina+levelbuilder@code.org\"},{\"changed_at\":\"2024-10-02 01:02:55 +0000\",\"changed\":[\"start_sources\"],\"changed_by_id\":18602,\"changed_by_email\":\"angelina+levelbuilder@code.org\"}]"
}]]></config>
</Pythonlab>
