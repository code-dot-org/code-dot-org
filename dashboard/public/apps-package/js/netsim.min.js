require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({233:[function(a){var b=a("../appMain"),c=a("../StudioApp").singleton,d=a("./netsim"),e=a("./levels"),f=a("./skins");window.netsimMain=function(a){a.skinsModule=f,a.isEditorless=!0;var g=new d;g.injectStudioApp(c),b(g,e,a)}},{"../StudioApp":4,"../appMain":5,"./levels":231,"./netsim":234,"./skins":240}],240:[function(a,b,c){var d=a("../skins");c.load=function(a,b){var c=d.load(a,b);return c}},{"../skins":244}],234:[function(a,b){"use strict";var c=a("../utils"),d=c.getLodash(),e=a("./locale"),f=a("../ObservableEvent"),g=a("../RunLoop"),h=a("./page.html.ejs"),i=a("./netsimConstants"),j=a("./netsimUtils"),k=a("./DashboardUser"),l=a("./NetSimBitLogPanel"),m=a("./NetSimLobby"),n=a("./NetSimLocalClientNode"),o=a("./NetSimLogger"),p=a("./NetSimLogPanel"),q=a("./NetSimRouterNode"),r=a("./NetSimSendPanel"),s=a("./NetSimShard"),t=a("./NetSimShardCleaner"),u=a("./NetSimStatusPanel"),v=a("./NetSimTabsComponent"),w=a("./NetSimVisualization"),x=i.DnsMode,y=i.MessageGranularity,z=o.getSingleton(),A=a("./netsimGlobals"),B=1e4,C=b.exports=function(){this.skin=null,this.level={},this.heading=0,this.currentUser_=k.getCurrentUser(),this.shard_=null,this.shardCleaner_=null,this.myNode=null,this.runLoop_=new g,this.chunkSize_=8,this.myDeviceBitRate_=1/0,this.enabledEncodings_=[],this.dnsMode_=x.NONE,this.receivedMessageLog_=null,this.sentMessageLog_=null,this.shardChange=new f,this.shardChange.register(this.onShardChange_.bind(this)),this.eventKeys={}};C.prototype.injectStudioApp=function(a){this.studioApp_=a},C.prototype.init=function(b){if(!this.studioApp_)throw new Error("NetSim requires a StudioApp");A.setRootControllers(this.studioApp_,this),this.skin=b.skin,this.level=j.scrubLevelConfiguration_(b.level),b.html=h({assetUrl:this.studioApp_.assetUrl,data:{visualization:"",localeDirection:this.studioApp_.localeDirection(),controls:a("./controls.html.ejs")({assetUrl:this.studioApp_.assetUrl})},hideRunButton:!0}),b.enableShowCode=!1,b.pinWorkspaceToBottom=!0,b.loadAudio=this.loadAudio_.bind(this),this.studioApp_.configureDom=this.configureDomOverride_.bind(this.studioApp_),this.studioApp_.onResize=this.onResizeOverride_.bind(this.studioApp_),this.studioApp_.init(b),this.currentUser_.whenReady(function(){this.initWithUserName_(this.currentUser_)}.bind(this)),this.runLoop_.tick.register(this.tick.bind(this)),this.runLoop_.begin()},C.prototype.tick=function(a){this.isConnectedToShard()&&(this.myNode.tick(a),this.shard_.tick(a),this.shardCleaner_&&this.shardCleaner_.tick(a))},C.prototype.getUniqueLevelKey=function(){return location.pathname.substr(1).replace(/\W/g,"-")},C.prototype.getOverrideShardID=function(){var a=location.search.split("?");if(1===a.length)return void 0;var b;return a[1].split("&").forEach(function(a){var c=a.split("=");c.length>1&&"s"===c[0]&&(b=c[1])}),b},C.prototype.shouldEnableCleanup=function(){return!location.search.match(/disableCleaning/i)},C.prototype.shouldShowAnyTabs=function(){return this.level.showTabs.length>0},C.prototype.initWithUserName_=function(a){this.mainContainer_=$("#netsim"),this.level.messageGranularity===y.PACKETS?(this.receivedMessageLog_=new p($("#netsim-received"),{logTitle:e.receivedMessageLog(),isMinimized:!1,hasUnreadMessages:!0,packetSpec:this.level.clientInitialPacketHeader}),this.sentMessageLog_=new p($("#netsim-sent"),{logTitle:e.sentMessageLog(),isMinimized:!0,hasUnreadMessages:!1,packetSpec:this.level.clientInitialPacketHeader})):this.level.messageGranularity===y.BITS&&(this.receivedMessageLog_=new l($("#netsim-received"),{logTitle:e.receiveBits(),isMinimized:!1,netsim:this,showReadWireButton:!0}),this.sentMessageLog_=new l($("#netsim-sent"),{logTitle:e.sentBitsLog(),isMinimized:!1,netsim:this})),this.statusPanel_=new u($("#netsim-status"),{disconnectCallback:this.disconnectFromRemote.bind(this,function(){}),cleanShardNow:this.cleanShardNow.bind(this),expireHeartbeat:this.expireHeartbeat.bind(this)}),this.visualization_=new w($("svg"),this.runLoop_,this),this.lobby_=new m($(".lobby-panel"),this,{user:a,levelKey:this.getUniqueLevelKey(),sharedShardSeed:this.getOverrideShardID()}),this.shouldShowAnyTabs()&&(this.tabs_=new v($("#netsim-tabs"),this.runLoop_,{chunkSizeSliderChangeCallback:this.setChunkSize.bind(this),myDeviceBitRateChangeCallback:this.setMyDeviceBitRate.bind(this),encodingChangeCallback:this.changeEncodings.bind(this),routerBandwidthSliderChangeCallback:this.setRouterBandwidth.bind(this),routerBandwidthSliderStopCallback:this.changeRemoteRouterBandwidth.bind(this),routerMemorySliderChangeCallback:this.setRouterMemory.bind(this),routerMemorySliderStopCallback:this.changeRemoteRouterMemory.bind(this),dnsModeChangeCallback:this.changeRemoteDnsMode.bind(this),becomeDnsCallback:this.becomeDnsNode.bind(this)}),this.tabs_.attachToRunLoop(this.runLoop_)),this.sendPanel_=new r($("#netsim-send"),this.level,this),this.changeEncodings(this.level.defaultEnabledEncodings),this.setChunkSize(this.level.defaultChunkSizeBits),this.setMyDeviceBitRate(this.level.defaultBitRateBitsPerSecond),this.setRouterBandwidth(this.level.defaultRouterBandwidth),this.setRouterMemory(this.level.defaultRouterMemory),this.setDnsMode(this.level.defaultDnsMode),this.render(),window.addEventListener("beforeunload",this.onBeforeUnload_.bind(this)),window.addEventListener("unload",this.onUnload_.bind(this)),window.addEventListener("resize",d.debounce(this.updateLayout.bind(this),250))},C.prototype.onBeforeUnload_=function(a){return window.__TestInterface&&window.__TestInterface.ignoreOnBeforeUnload?void 0:this.isConnectedToRemote()?(a.returnValue=e.onBeforeUnloadWarning(),e.onBeforeUnloadWarning()):void 0},C.prototype.onUnload_=function(){this.isConnectedToShard()&&this.synchronousDisconnectFromShard_()},C.prototype.isConnectedToShard=function(){return null!==this.myNode},C.prototype.isConnectedToShardID=function(a){return this.isConnectedToShard()&&this.shard_.id===a},C.prototype.connectToShard=function(a,b){return this.isConnectedToShard()?(z.warn("Auto-closing previous connection..."),void this.disconnectFromShard(this.connectToShard.bind(this,a,b))):(this.shard_=new s(a),this.shouldEnableCleanup()&&(this.shardCleaner_=new t(this.shard_,B)),void this.createMyClientNode_(b,function(a,b){this.myNode=b,this.shardChange.notifyObservers(this.shard_,this.myNode)}.bind(this)))},C.prototype.createMyClientNode_=function(a,b){n.create(this.shard_,a,function(a,c){return a?(z.error("Failed to create client node; "+a.message),void b(a,null)):(c.setLostConnectionCallback(this.disconnectFromShard.bind(this)),c.initializeSimulation(this.sentMessageLog_,this.receivedMessageLog_),void b(a,c))}.bind(this))},C.prototype.synchronousDisconnectFromShard_=function(){this.myNode.stopSimulation(),this.myNode.synchronousDestroy(),this.myNode=null},C.prototype.disconnectFromShard=function(a){return a=a||function(){},this.isConnectedToShard()?this.isConnectedToRemote()?void this.disconnectFromRemote(this.disconnectFromShard.bind(this,a)):(this.myNode.stopSimulation(),void this.myNode.destroy(function(b,c){b&&z.warn("Error destroying node:"+b.message),this.myNode=null,this.shardChange.notifyObservers(null,null),a(b,c)}.bind(this))):(z.warn("Redundant disconnect call."),void a(null,null))},C.prototype.isConnectedToRemote=function(){return this.isConnectedToClient()||this.isConnectedToRouter()},C.prototype.getConnectedRemoteNode=function(){var a=this.getConnectedClient(),b=this.getConnectedRouter();return a?a:b},C.prototype.isConnectedToClient=function(){return!!this.getConnectedClient()},C.prototype.getConnectedClient=function(){return this.isConnectedToShard()?this.myNode.myRemoteClient:null},C.prototype.isConnectedToRouter=function(){return!!this.getConnectedRouter()},C.prototype.getConnectedRouter=function(){return this.isConnectedToShard()?this.myNode.myRouter:null},C.prototype.connectToRouter=function(a){if(this.isConnectedToRemote())return z.warn("Auto-disconnecting from previous router."),void this.disconnectFromRemote(this.connectToRouter.bind(this,a));var b=this;q.get(a,this.shard_,function(c,d){return c?void z.warn("Failed to find router with ID "+a+"; "+c.message):void b.myNode.connectToRouter(d,function(a){a&&z.warn("Failed to connect to "+d.getDisplayName()+"; "+a.message)})})},C.prototype.disconnectFromRemote=function(a){a=c.valueOr(a,function(){}),this.myNode.disconnectRemote(a)},C.prototype.receiveBit=function(a){this.myNode.getLatestMessageOnSimplexWire(a)},C.prototype.changeEncodings=function(a){this.enabledEncodings_=a,this.tabs_&&this.tabs_.setEncodings(a),this.receivedMessageLog_.setEncodings(a),this.sentMessageLog_.setEncodings(a),this.sendPanel_.setEncodings(a),this.visualization_.setEncodings(a),this.updateLayout()},C.prototype.getEncodings=function(){return this.enabledEncodings_},C.prototype.setChunkSize=function(a){this.chunkSize_=a,this.tabs_&&this.tabs_.setChunkSize(a),this.receivedMessageLog_.setChunkSize(a),this.sentMessageLog_.setChunkSize(a),this.sendPanel_.setChunkSize(a)},C.prototype.setMyDeviceBitRate=function(a){this.myDeviceBitRate_=a,this.tabs_&&this.tabs_.setMyDeviceBitRate(a),this.sendPanel_.setBitRate(a)},C.prototype.setRouterCreationTime=function(a){this.tabs_&&this.tabs_.setRouterCreationTime(a)},C.prototype.setRouterBandwidth=function(a){this.tabs_&&this.tabs_.setRouterBandwidth(a)},C.prototype.changeRemoteRouterBandwidth=function(a){this.setRouterBandwidth(a),this.isConnectedToRouter()&&this.getConnectedRouter().setBandwidth(a)},C.prototype.setRouterMemory=function(a){this.tabs_&&this.tabs_.setRouterMemory(a)},C.prototype.changeRemoteRouterMemory=function(a){this.setRouterMemory(a),this.isConnectedToRouter()&&this.getConnectedRouter().setMemory(a)},C.prototype.setDnsMode=function(a){this.dnsMode_=a,this.tabs_&&this.tabs_.setDnsMode(a),this.visualization_.setDnsMode(a)},C.prototype.getDnsMode=function(){return this.dnsMode_},C.prototype.changeRemoteDnsMode=function(a){this.setDnsMode(a),this.isConnectedToRouter()&&this.getConnectedRouter().setDnsMode(a)},C.prototype.setIsDnsNode=function(a){this.tabs_&&this.tabs_.setIsDnsNode(a),this.isConnectedToRouter()&&this.setDnsTableContents(this.getConnectedRouter().getAddressTable())},C.prototype.setDnsNodeID=function(a){this.visualization_.setDnsNodeID(a)},C.prototype.becomeDnsNode=function(){if(this.setIsDnsNode(!0),this.myNode&&this.myNode.myRouter){var a=this.myNode,b=a.myRouter;b.dnsNodeID=a.entityID,b.update()}},C.prototype.setDnsTableContents=function(a){this.tabs_&&this.tabs_.setDnsTableContents(a)},C.prototype.setRouterLogData=function(a){this.tabs_&&this.tabs_.setRouterLogData(a)},C.prototype.setRouterQueuedPacketCount_=function(a){this.tabs_&&this.tabs_.setRouterQueuedPacketCount(a)},C.prototype.setRouterMemoryInUse_=function(a){this.tabs_&&this.tabs_.setRouterMemoryInUse(a)},C.prototype.setRouterDataRate_=function(a){this.tabs_&&this.tabs_.setRouterDataRate(a)},C.prototype.loadAudio_=function(){},C.prototype.configureDomOverride_=function(a){var b=document.getElementById(a.containerId);b.innerHTML=a.html;var c=this.MIN_WORKSPACE_HEIGHT,d=document.getElementById("netsim-leftcol");a.pinWorkspaceToBottom?(document.body.style.overflow="hidden",b.className=b.className+" pin_bottom",d.className=d.className+" pin_bottom"):(d.style.minHeight=c+"px",b.style.minHeight=c+"px")},C.prototype.onResizeOverride_=function(){var a=document.getElementById("appcontainer"),b=a.parentNode,c=window.getComputedStyle(b),d=parseInt(c.width,10);a.style.top=b.offsetTop+"px",a.style.width=d+"px"},C.prototype.render=function(){var a,b,c,d,f,g;a=!1,b=e.disconnected(),this.myNode&&(b="In Lobby",c=this.myNode.getHostname(),this.myNode.myWire&&(d=this.myNode.myWire.localAddress)),this.isConnectedToRemote()&&(a=!0,b=e.connected(),f=this.getConnectedRemoteNode().getDisplayName()),g=this.lobby_.getShareLink(),this.isConnectedToRemote()?(this.mainContainer_.find("#netsim-disconnected").hide(),this.mainContainer_.find("#netsim-connected").show(),this.sendPanel_.setFromAddress(d),this.statusPanel_&&this.statusPanel_.render({isConnected:a,statusString:b,myHostname:c,myAddress:d,remoteNodeName:f,shareLink:g})):(this.mainContainer_.find("#netsim-disconnected").show(),this.mainContainer_.find("#netsim-connected").hide(),this.lobby_.render()),this.updateLayout()},C.prototype.onShardChange_=function(a,b){this.eventKeys.registeredWithLocalNode&&(this.eventKeys.registeredWithLocalNode.remoteChange.unregister(this.eventKeys.remoteChange),this.eventKeys.registeredWithLocalNode=null),b&&(this.eventKeys.remoteChange=b.remoteChange.register(this.onRemoteChange_.bind(this)),this.eventKeys.registeredWithLocalNode=b),this.render()},C.prototype.onRemoteChange_=function(a,b){var c=b&&b instanceof q,d=!b&&this.eventKeys.registeredWithRouter;this.eventKeys.registeredWithRouter&&(this.eventKeys.registeredWithRouter.stateChange.unregister(this.eventKeys.routerStateChange),this.eventKeys.registeredWithRouter.statsChange.unregister(this.eventKeys.routerStatsChange),this.eventKeys.registeredWithRouter.wiresChange.unregister(this.eventKeys.routerWiresChange),this.eventKeys.registeredWithRouter.logChange.unregister(this.eventKeys.routerLogChange),this.eventKeys.registeredWithRouter=null),c&&(this.eventKeys.routerStateChange=b.stateChange.register(this.onRouterStateChange_.bind(this)),this.eventKeys.routerStatsChange=b.statsChange.register(this.onRouterStatsChange_.bind(this)),this.eventKeys.routerWiresChange=b.wiresChange.register(this.onRouterWiresChange_.bind(this)),this.eventKeys.routerLogChange=b.logChange.register(this.onRouterLogChange_.bind(this)),this.eventKeys.registeredWithRouter=b),this.render(),c?this.onRouterConnect_(b):d&&this.onRouterDisconnect_()},C.prototype.onRouterConnect_=function(a){this.onRouterStateChange_(a),this.onRouterStatsChange_(a),this.setRouterLogData(a.getLog())},C.prototype.onRouterDisconnect_=function(){this.setRouterCreationTime(0),this.setRouterQueuedPacketCount_(0),this.setRouterMemoryInUse_(0),this.setRouterDataRate_(0),this.setRouterLogData([])},C.prototype.onRouterStateChange_=function(a){var b={};this.myNode&&(b=this.myNode),this.setRouterCreationTime(a.creationTime),this.setRouterBandwidth(a.bandwidth),this.setRouterMemory(a.memory),this.setDnsMode(a.dnsMode),this.setDnsNodeID(a.dnsMode===x.NONE?void 0:a.dnsNodeID),this.setIsDnsNode(a.dnsMode===x.MANUAL&&a.dnsNodeID===b.entityID)},C.prototype.onRouterStatsChange_=function(a){this.setRouterQueuedPacketCount_(a.getQueuedPacketCount()),this.setRouterMemoryInUse_(a.getMemoryInUse()),this.setRouterDataRate_(a.getCurrentDataRate())},C.prototype.onRouterWiresChange_=function(){this.isConnectedToRouter()&&this.setDnsTableContents(this.getConnectedRouter().getAddressTable())},C.prototype.onRouterLogChange_=function(){this.isConnectedToRouter()&&this.setRouterLogData(this.getConnectedRouter().getLog())},C.prototype.cleanShardNow=function(){this.shardCleaner_&&this.shardCleaner_.cleanShard()},C.prototype.expireHeartbeat=function(){this.myNode&&this.myNode.heartbeat&&(this.myNode.heartbeat.spoofExpired(),z.info("Local node heartbeat is now expired."))},C.prototype.animateSetWireState=function(a){this.visualization_.animateSetWireState(a)},C.prototype.animateReadWireState=function(a){this.visualization_.animateReadWireState(a)},C.prototype.updateLayout=function(){var a=$("#netsim-rightcol"),b=$("#netsim-send"),c=$("#netsim-logs");if(a.is(":visible")){var d=a.height(),e=b.height(),f=d-e,g=!this.sentMessageLog_.isMinimized(),h=!this.receivedMessageLog_.isMinimized();if(h&&g){var i=Math.floor(f/2);this.receivedMessageLog_.setHeight(i),this.sentMessageLog_.setHeight(i)}else h?this.receivedMessageLog_.setHeight(Math.floor(f-this.sentMessageLog_.getHeight())):g&&this.sentMessageLog_.setHeight(Math.floor(f-this.receivedMessageLog_.getHeight()));c.css("height",d-e)}}},{"../ObservableEvent":1,"../RunLoop":3,"../utils":292,"./DashboardUser":160,"./NetSimBitLogPanel":163,"./NetSimLobby":180,"./NetSimLocalClientNode":181,"./NetSimLogPanel":185,"./NetSimLogger":186,"./NetSimRouterNode":204,"./NetSimSendPanel":210,"./NetSimShard":211,"./NetSimShardCleaner":212,"./NetSimStatusPanel":218,"./NetSimTabsComponent":221,"./NetSimVisualization":222,"./controls.html.ejs":229,"./locale":232,"./netsimConstants":235,"./netsimGlobals":236,"./netsimUtils":238,"./page.html.ejs":239}],239:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../locale");buf.push('\n\n<div id="rotateContainer" style="background-image: url(',escape(assetUrl("media/mobile_tutorial_turnphone.png")),')">\n  <div id="rotateText">\n    <p>',escape(a.rotateText()),"<br>",escape(a.orientationLock()),"</p>\n  </div>\n</div>\n\n");var b=function(){buf.push('  <div id="bubble" class="clearfix">\n    <table id="prompt-table">\n      <tr>\n        <td id="prompt-icon-cell">\n          <img id="prompt-icon"/>\n        </td>\n        <td id="prompt-cell">\n          <p id="prompt">\n          </p>\n        </td>\n      </tr>\n    </table>\n    <div id="ani-gif-preview-wrapper">\n      <div id="ani-gif-preview">\n      </div>\n    </div>\n  </div>\n')};buf.push('\n<div id="appcontainer">\n  <!-- Should disable spell-check on all netsim elements -->\n  <div id="netsim" autocapitalize="false" autocorrect="false" autocomplete="false" spellcheck="false">\n\n    <div id="netsim-disconnected">\n      <div class="lobby-panel"></div>\n    </div>\n\n\n    <div id="netsim-connected">\n      <div id="netsim-leftcol">\n        <div class="column-width-limiter">\n\n          <div id="netsim-status"></div>\n\n          <div id="netsim-visualization">\n            <svg version="1.1" width="298" height="298" xmlns="http://www.w3.org/2000/svg">\n\n              <filter id="backgroundBlur">\n                <feGaussianBlur in="SourceGraphic" stdDeviation="5" />\n                <feComponentTransfer>\n                  <feFuncA slope="0.5" type="linear"></feFuncA>\n                </feComponentTransfer>\n              </filter>\n\n              <g id="centered-group" transform="translate(150,150)">\n                <g id="background-group" filter="url(#backgroundBlur)"></g>\n                <g id="foreground-group"></g>\n              </g>\n            </svg>\n          </div>\n\n          <div id="netsim-tabs"></div>\n\n        </div>\n      </div>\n\n      <div id="netsim-rightcol">\n        <div id="netsim-logs">\n          <div id="netsim-received"></div>\n          <div id="netsim-sent"></div>\n        </div>\n        <div id="netsim-send"></div>\n      </div>\n    </div>\n  </div>\n  <div id="footers" dir="',escape(data.localeDirection),'">\n    '),b(),buf.push('\n  </div>\n</div>\n\n<div class="clear"></div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../locale":129,ejs:302}],231:[function(a,b){var c=a("./netsimConstants"),d=(a("./Packet"),c.BITS_PER_NIBBLE,c.MessageGranularity),e=c.DnsMode,f=(c.EncodingType,c.NetSimTabType,b.exports={});f.custom={showClientsInLobby:!1,showRoutersInLobby:!1,canConnectToClients:!1,canConnectToRouters:!1,showAddRouterButton:!1,messageGranularity:d.BITS,automaticReceive:!1,broadcastMode:!1,addressFormat:"4",packetCountBitWidth:4,routerExpectsPacketHeader:[],clientInitialPacketHeader:[],showHostnameInGraph:!1,showAddPacketButton:!1,showPacketSizeControl:!1,defaultPacketSizeLimit:1/0,showTabs:[],defaultTabIndex:0,showPulseRateSlider:!1,showMetronome:!1,showEncodingControls:[],defaultEnabledEncodings:[],showBitRateControl:!1,lockBitRateControl:!1,defaultBitRateBitsPerSecond:1/0,showChunkSizeControl:!1,lockChunkSizeControl:!1,defaultChunkSizeBits:8,showRouterBandwidthControl:!1,defaultRouterBandwidth:1/0,showRouterMemoryControl:!1,defaultRouterMemory:1/0,showDnsModeControl:!1,defaultDnsMode:e.NONE}},{"./Packet":228,"./netsimConstants":235}],229:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div id="slider-cell">\n  <img id="spinner" style="visibility: hidden;" src="',escape(assetUrl("media/netsim/loading.gif")),'" height=15 width=15>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:302}],222:[function(a,b){"use strict";var c=a("../utils"),d=c.getLodash(),e=a("./netsimNodeFactory"),f=a("./NetSimFakeVizWire"),g=a("./NetSimWire"),h=a("./NetSimVizNode"),i=a("./NetSimVizWire"),j=a("./netsimGlobals"),k=a("./tweens"),l=a("./netsimConstants").NodeType,m=b.exports=function(a,b,c){this.svgRoot_=a,this.netsim_=c,this.shard_=null,c.shardChange.register(this.onShardChange_.bind(this)),this.elements_=[],this.localNode=null,this.visualizationWidth=300,this.visualizationHeight=300,this.eventKeys={},b.tick.register(this.tick.bind(this)),b.render.register(this.render.bind(this))};m.prototype.tick=function(a){this.elements_.forEach(function(b){b.tick(a)}),this.elements_=this.elements_.filter(function(a){return a.isDead()?(a.getRoot().remove(),!1):!0})},m.prototype.render=function(){this.elements_.forEach(function(a){a.render()})},m.prototype.onShardChange_=function(a,b){this.setShard(a),this.setLocalNode(b)},m.prototype.setShard=function(a){this.shard_=a,this.eventKeys.registeredWithShard&&(this.eventKeys.registeredWithShard.nodeTable.tableChange.unregister(this.eventKeys.nodeTable),this.eventKeys.registeredWithShard.wireTable.tableChange.unregister(this.eventKeys.wireTable),this.eventKeys.registeredWithShard=null),a&&(this.eventKeys.nodeTable=a.nodeTable.tableChange.register(this.onNodeTableChange_.bind(this)),this.eventKeys.wireTable=a.wireTable.tableChange.register(this.onWireTableChange_.bind(this)),this.eventKeys.registeredWithShard=a)},m.prototype.setLocalNode=function(a){this.eventKeys.registeredWithLocalNode&&(this.eventKeys.registeredWithLocalNode.remoteChange.unregister(this.eventKeys.remoteChange),this.eventKeys.registeredWithLocalNode=null),a&&(this.eventKeys.remoteChange=a.remoteChange.register(this.onRemoteChange_.bind(this)),this.eventKeys.registeredWithLocalNode=a),a?(this.localNode?this.localNode.configureFrom(a):(this.localNode=new h(a),this.elements_.push(this.localNode),this.svgRoot_.find("#background-group").append(this.localNode.getRoot())),this.localNode.setIsLocalNode()):(this.localNode.kill(),this.localNode=null),this.pullElementsToForeground()},m.prototype.onRemoteChange_=function(){this.pullElementsToForeground(),this.distributeForegroundNodes()},m.prototype.getEntityByID=function(a,b){return d.find(this.elements_,function(c){return c instanceof a&&c.id===b})},m.prototype.getWiresAttachedToNode=function(a){return this.elements_.filter(function(b){return b instanceof i&&(b.localVizNode===a||a.isRouter&&b.remoteVizNode===a)})},m.prototype.getFakeWiresAttachedToNode=function(a){return this.elements_.filter(function(b){return b instanceof f&&(b.localVizNode===a||b.remoteVizNode===a)})},m.prototype.onNodeTableChange_=function(a){var b=e.nodesFromRows(this.shard_,a);this.updateVizEntitiesOfType_(h,b,function(a){var b=new h(a);return b.setDnsMode(this.netsim_.getDnsMode()),b.snapToPosition(Math.random()*this.visualizationWidth-this.visualizationWidth/2,Math.random()*this.visualizationHeight-this.visualizationHeight/2),b}.bind(this))},m.prototype.onWireTableChange_=function(a){var b=a.map(function(a){return new g(this.shard_,a)}.bind(this));this.updateVizEntitiesOfType_(i,b,function(a){var b=new i(a,this.getEntityByID.bind(this));return b.setEncodings(this.netsim_.getEncodings()),b}.bind(this)),j.getLevelConfig().broadcastMode&&this.updateBroadcastModeWires_(),this.pullElementsToForeground(),this.distributeForegroundNodes()},m.prototype.updateBroadcastModeWires_=function(){this.elements_.forEach(function(a){a instanceof f&&a.kill()},this);var a=this.generateBroadcastModeConnections_();a.forEach(function(a){var b=new f(a,this.getEntityByID.bind(this));this.addVizEntity_(b)},this)},m.prototype.generateBroadcastModeConnections_=function(){for(var a=this.shard_.nodeTable.readAllCached(),b=this.shard_.wireTable.readAllCached(),c=a.length,d={},e=0;c>e;e++)d[a[e].id]=e;for(var f=new Array(c),g=0;c>g;g++){f[g]=new Array(c);for(var h=0;c>h;h++)f[g][h]=!1}b.forEach(function(a){var b=d[a.localNodeID],c=d[a.remoteNodeID];void 0!==b&&void 0!==c&&(f[b][c]=!0,f[c][b]=!0)});for(var i=0;c>i;i++)for(var j=0;c>j;j++)for(var k=0;c>k;k++)f[j][i]&&f[i][k]&&(f[j][k]=!0);for(var m=[],n=0;c-1>n;n++)for(var o=n+1;c>o;o++){var p=a[n].type===l.CLIENT&&a[o].type===l.CLIENT,q=f[n][o];p&&q&&m.push({nodeA:a[n].id,nodeB:a[o].id})}return m},m.prototype.updateVizEntitiesOfType_=function(a,b,c){this.killVizEntitiesOfTypeMissingMatch_(a,b),b.forEach(function(b){var d=this.getEntityByID(a,b.entityID);d?d.configureFrom(b):this.addVizEntity_(c(b))},this)},m.prototype.killVizEntitiesOfTypeMissingMatch_=function(a,b){this.elements_.forEach(function(c){var d=c instanceof a,e=b.some(function(a){return a.entityID===c.id});d&&!e&&c.kill()})},m.prototype.addVizEntity_=function(a){this.elements_.push(a),this.svgRoot_.find("#background-group").prepend(a.getRoot())};var n=function(a,b){a.getRoot().detach(),a instanceof i||a instanceof f?a.getRoot().prependTo(b):a.getRoot().appendTo(b)};m.prototype.pullElementsToForeground=function(){if(this.elements_.forEach(function(a){a.visited=!1}),this.netsim_.isConnectedToRemote()){var a=[];this.localNode&&a.push(this.localNode);for(var b;a.length>0;)b=a.pop(),b.visited=!0,a=a.concat(this.getUnvisitedNeighborsOf_(b))}else this.localNode&&(this.localNode.visited=!0);var c=this.svgRoot_.find("#foreground-group"),d=this.svgRoot_.find("#background-group");this.elements_.forEach(function(a){var b=$.contains(c[0],a.getRoot()[0]);a.visited&&!b?(n(a,c),a.onDepthChange(!0)):!a.visited&&b&&(n(a,d),a.onDepthChange(!1))},this)},m.prototype.getUnvisitedNeighborsOf_=function(a){var b=[];return a instanceof h?b=this.getWiresAttachedToNode(a).concat(this.getFakeWiresAttachedToNode(a)):a instanceof i&&(a.localVizNode&&b.push(a.localVizNode),a.remoteVizNode&&b.push(a.remoteVizNode)),b.filter(function(a){return!a.visited})},m.prototype.distributeForegroundNodes=function(){if(j.getLevelConfig().broadcastMode)return void this.distributeForegroundNodesForBroadcast_();var a=this.elements_.filter(function(a){return a instanceof h&&a.isForeground});if(0!==a.length){if(1===a.length)return void a[0].tweenToPosition(0,0,600,k.easeOutQuad);var b;if(2===a.length){b=this.localNode;var c=d.find(a,function(a){return a!==b});return b.tweenToPosition(-75,0,400,k.easeOutQuad),void c.tweenToPosition(75,0,600,k.easeOutQuad)}b=this.localNode;var e=d.find(a,function(a){return a.isRouter}),f=a.filter(function(a){return a!==b&&a!==e});b.tweenToPosition(-100,0,400,k.easeOutQuad),e.tweenToPosition(0,0,500,k.easeOutQuad);for(var g=2*Math.PI/(f.length+1),i=0;i<f.length;i++){var l=100,m=Math.PI+(i+1)*g,n=Math.cos(m)*l,o=Math.sin(m)*l;f[i].tweenToPosition(n,o,600,k.easeOutQuad)}}},m.prototype.distributeForegroundNodesForBroadcast_=function(){var a=this.elements_.filter(function(a){return a instanceof h&&a.isForeground&&!a.isRouter});if(0!==a.length){if(1===a.length)return void a[0].tweenToPosition(0,0,600,k.easeOutQuad);var b;if(2===a.length){b=this.localNode;var c=d.find(a,function(a){return a!==b});return b.tweenToPosition(-75,0,400,k.easeOutQuad),void c.tweenToPosition(75,0,600,k.easeOutQuad)}b=this.localNode;var e=a.filter(function(a){return a!==b});b.tweenToPosition(-100,0,400,k.easeOutQuad);for(var f=2*Math.PI/(e.length+1),g=0;g<e.length;g++){var i=100,j=Math.PI+(g+1)*f,l=Math.cos(j)*i,m=Math.sin(j)*i;e[g].tweenToPosition(l,m,600,k.easeOutQuad)}}},m.prototype.setDnsMode=function(a){this.elements_.forEach(function(b){b instanceof h&&b.setDnsMode(a)})},m.prototype.setDnsNodeID=function(a){this.elements_.forEach(function(b){b instanceof h&&b.setIsDnsNode(b.id===a)})},m.prototype.setEncodings=function(a){this.elements_.forEach(function(b){b instanceof i&&b.setEncodings(a)})},m.prototype.animateSetWireState=function(a){var b=this.getVizWireToRemote(),c=this.getVizWireFromRemote();b&&c&&(c.hide(),b.animateSetState(a))},m.prototype.animateReadWireState=function(a){var b=this.getVizWireToRemote(),c=this.getVizWireFromRemote();b&&c&&(c.hide(),b.animateReadState(a))},m.prototype.getVizWireToRemote=function(){if(!this.localNode)return null;var a=this.elements_.filter(function(a){return a instanceof i&&a.localVizNode===this.localNode},this);return 0===a.length?null:a[0]},m.prototype.getVizWireFromRemote=function(){if(!this.localNode)return null;var a=this.elements_.filter(function(a){return a instanceof i&&a.remoteVizNode===this.localNode},this);return 0===a.length?null:a[0]}},{"../utils":292,"./NetSimFakeVizWire":178,"./NetSimVizNode":225,"./NetSimVizWire":226,"./NetSimWire":227,"./netsimConstants":235,"./netsimGlobals":236,"./netsimNodeFactory":237,"./tweens":241}],226:[function(a,b){"use strict";a("../utils");var c=a("./netsimUtils").jQuerySvgElement,d=a("./NetSimVizEntity"),e=a("./NetSimVizNode"),f=a("./tweens"),g=a("./dataConverters"),h=a("./netsimConstants"),i=a("./netsimGlobals"),j=h.EncodingType,k=g.binaryToAB,l=-10,m=b.exports=function(a,b){d.call(this,a);var e=this.getRoot();e.addClass("viz-wire"),this.line_=c("path").appendTo(e),this.questionMark_=c("text").text("?").addClass("question-mark").appendTo(e),this.text_=c("text").addClass("state-label").appendTo(e),this.textPosX_=0,this.textPosY_=0,this.encodings_=[],this.getEntityByID_=b,this.localVizNode=null,this.remoteVizNode=null,this.configureFrom(a),this.render()};m.inherits(d),m.prototype.configureFrom=function(a){this.localVizNode=this.getEntityByID_(e,a.localNodeID),this.remoteVizNode=this.getEntityByID_(e,a.remoteNodeID),this.localVizNode&&this.localVizNode.setAddress(a.localAddress),this.remoteVizNode&&this.remoteVizNode.setAddress(a.remoteAddress),i.getLevelConfig().broadcastMode&&this.getRoot().css("display","none")},m.prototype.render=function(){m.superPrototype.render.call(this);var a="M 0 0",b={x:0,y:0};this.localVizNode&&this.remoteVizNode&&(a="M "+this.localVizNode.posX+" "+this.localVizNode.posY+" L "+this.remoteVizNode.posX+" "+this.remoteVizNode.posY,b=this.getWireCenterPosition()),this.line_.attr("d",a),this.text_.attr("x",this.textPosX_).attr("y",this.textPosY_),this.questionMark_.attr("x",b.x).attr("y",b.y)},m.prototype.hide=function(){this.getRoot().addClass("hidden-wire")},m.prototype.kill=function(){m.superPrototype.kill.call(this),this.localVizNode=null,this.remoteVizNode=null},m.prototype.setEncodings=function(a){this.encodings_=a},m.prototype.animateSetState=function(a){if(this.localVizNode&&this.remoteVizNode){var b=300,c=300;this.stopAllAnimation(),this.setWireClasses_(a),this.text_.text(this.getDisplayBit_(a)),this.snapTextToPosition(this.getLocalNodePosition()),this.tweenTextToPosition(this.getWireCenterPosition(),b,f.easeOutQuad),this.doAfterDelay(b+c,function(){this.setWireClasses_("unknown")}.bind(this))}},m.prototype.animateReadState=function(a){if(this.localVizNode&&this.remoteVizNode){var b=300,c=300;this.stopAllAnimation(),this.setWireClasses_(a),this.text_.text(this.getDisplayBit_(a)),this.snapTextToPosition(this.getWireCenterPosition()),this.doAfterDelay(b,function(){this.tweenTextToPosition(this.getLocalNodePosition(),c,f.easeOutQuad),this.setWireClasses_("unknown")}.bind(this))
}},m.prototype.setWireClasses_=function(a){var b="0"===a,c=!b&&"1"===a,d=!b&&!c;this.getRoot().toggleClass("state-on",c),this.getRoot().toggleClass("state-off",b),this.getRoot().toggleClass("state-unknown",d)},m.prototype.getDisplayBit_=function(a){return this.isEncodingEnabled_(j.A_AND_B)&&!this.isEncodingEnabled_(j.BINARY)&&(a=k(a)),a},m.prototype.isEncodingEnabled_=function(a){return this.encodings_.some(function(b){return b===a})},m.prototype.tweenTextToPosition=function(a,b,c){b>0?(this.tweens_.push(new f.TweenValueTo(this,"textPosX_",a.x,b,c)),this.tweens_.push(new f.TweenValueTo(this,"textPosY_",a.y,b,c))):(this.textPosX_=a.x,this.textPosY_=a.y)},m.prototype.snapTextToPosition=function(a){this.tweenTextToPosition(a,0)},m.prototype.getLocalNodePosition=function(){return{x:this.localVizNode.posX,y:this.localVizNode.posY}},m.prototype.getWireCenterPosition=function(){return{x:(this.remoteVizNode.posX-this.localVizNode.posX)/2+this.localVizNode.posX,y:(this.remoteVizNode.posY-this.remoteVizNode.posY)/2+this.localVizNode.posY+l}}},{"../utils":292,"./NetSimVizEntity":224,"./NetSimVizNode":225,"./dataConverters":230,"./netsimConstants":235,"./netsimGlobals":236,"./netsimUtils":238,"./tweens":241}],221:[function(a,b){"use strict";var c=a("./NetSimTabsComponent.html.ejs"),d=a("./NetSimRouterTab"),e=a("./NetSimMyDeviceTab"),f=a("./NetSimDnsTab"),g=a("./netsimConstants").NetSimTabType,h=a("./netsimUtils").shouldShowTab,i=a("./netsimGlobals"),j=b.exports=function(a,b,c){this.rootDiv_=a,this.runLoop_=b,this.chunkSizeSliderChangeCallback_=c.chunkSizeSliderChangeCallback,this.myDeviceBitRateChangeCallback_=c.myDeviceBitRateChangeCallback,this.encodingChangeCallback_=c.encodingChangeCallback,this.routerBandwidthSliderChangeCallback_=c.routerBandwidthSliderChangeCallback,this.routerBandwidthSliderStopCallback_=c.routerBandwidthSliderStopCallback,this.routerMemorySliderChangeCallback_=c.routerMemorySliderChangeCallback,this.routerMemorySliderStopCallback_=c.routerMemorySliderStopCallback,this.dnsModeChangeCallback_=c.dnsModeChangeCallback,this.becomeDnsCallback_=c.becomeDnsCallback,this.routerTab_=null,this.myDeviceTab_=null,this.dnsTab_=null,this.render()};j.prototype.attachToRunLoop=function(a){this.routerTab_&&this.routerTab_.attachToRunLoop(a)},j.prototype.render=function(){var a=i.getLevelConfig(),b=c({level:a}),j=$(b);this.rootDiv_.html(j),this.rootDiv_.find(".netsim-tabs").tabs({active:a.defaultTabIndex}),h(a,g.MY_DEVICE)&&(this.myDeviceTab_=new e(this.rootDiv_.find("#tab_my_device"),this.runLoop_,{chunkSizeChangeCallback:this.chunkSizeSliderChangeCallback_,bitRateChangeCallback:this.myDeviceBitRateChangeCallback_,encodingChangeCallback:this.encodingChangeCallback_})),h(a,g.ROUTER)&&(this.routerTab_=new d(this.rootDiv_.find("#tab_router"),{bandwidthSliderChangeCallback:this.routerBandwidthSliderChangeCallback_,bandwidthSliderStopCallback:this.routerBandwidthSliderStopCallback_,memorySliderChangeCallback:this.routerMemorySliderChangeCallback_,memorySliderStopCallback:this.routerMemorySliderStopCallback_})),h(a,g.DNS)&&(this.dnsTab_=new f(this.rootDiv_.find("#tab_dns"),this.dnsModeChangeCallback_,this.becomeDnsCallback_))},j.prototype.setChunkSize=function(a){this.myDeviceTab_&&this.myDeviceTab_.setChunkSize(a)},j.prototype.setMyDeviceBitRate=function(a){this.myDeviceTab_&&this.myDeviceTab_.setBitRate(a)},j.prototype.setEncodings=function(a){this.myDeviceTab_&&this.myDeviceTab_.setEncodings(a)},j.prototype.setRouterCreationTime=function(a){this.routerTab_&&this.routerTab_.setRouterCreationTime(a)},j.prototype.setRouterBandwidth=function(a){this.routerTab_&&this.routerTab_.setBandwidth(a)},j.prototype.setRouterMemory=function(a){this.routerTab_&&this.routerTab_.setMemory(a)},j.prototype.setRouterQueuedPacketCount=function(a){this.routerTab_&&this.routerTab_.setRouterQueuedPacketCount(a)},j.prototype.setRouterMemoryInUse=function(a){this.routerTab_&&this.routerTab_.setMemoryInUse(a)},j.prototype.setRouterDataRate=function(a){this.routerTab_&&this.routerTab_.setDataRate(a)},j.prototype.setDnsMode=function(a){this.dnsTab_&&this.dnsTab_.setDnsMode(a)},j.prototype.setIsDnsNode=function(a){this.dnsTab_&&this.dnsTab_.setIsDnsNode(a)},j.prototype.setDnsTableContents=function(a){this.dnsTab_&&this.dnsTab_.setDnsTableContents(a)},j.prototype.setRouterLogData=function(a){this.routerTab_&&this.routerTab_.setRouterLogData(a)}},{"./NetSimDnsTab":172,"./NetSimMyDeviceTab":192,"./NetSimRouterTab":208,"./NetSimTabsComponent.html.ejs":220,"./netsimConstants":235,"./netsimGlobals":236,"./netsimUtils":238}],220:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("./locale"),b=require("./netsimUtils").shouldShowTab,c=require("./netsimConstants").NetSimTabType,d=b(level,c.INSTRUCTIONS),e=b(level,c.MY_DEVICE),f=b(level,c.ROUTER),g=b(level,c.DNS),h=level.instructions||"";buf.push('\n<div class="netsim-tabs">\n  <ul>\n    '),d&&buf.push('\n    <li><a href="#tab_instructions">',escape(a.instructions()),"</a></li>\n    "),buf.push("\n    "),e&&buf.push('\n      <li><a href="#tab_my_device">',escape(a.myDevice()),"</a></li>\n    "),buf.push("\n    "),f&&buf.push('\n      <li><a href="#tab_router">',escape(a.router()),"</a></li>\n    "),buf.push("\n    "),g&&buf.push('\n      <li><a href="#tab_dns">',escape(a.dns()),"</a></li>\n    "),buf.push("\n  </ul>\n  "),d&&buf.push('\n    <div id="tab_instructions"><p>',escape(h),"</p></div>\n  "),buf.push("\n  "),e&&buf.push('\n    <div id="tab_my_device"></div>\n  '),buf.push("\n  "),f&&buf.push('\n    <div id="tab_router"></div>\n  '),buf.push("\n  "),g&&buf.push('\n    <div id="tab_dns"></div>\n  '),buf.push("\n</div>")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./locale":232,"./netsimConstants":235,"./netsimUtils":238,ejs:302}],218:[function(a,b){"use strict";a("../utils");var c=a("./NetSimStatusPanel.html.ejs"),d=a("./NetSimPanel.js"),e=b.exports=function(a,b){this.disconnectCallback_=b.disconnectCallback,this.cleanShardNow_=b.cleanShardNow,this.expireHeartbeat_=b.expireHeartbeat,d.call(this,a,{className:"netsim_status_panel",panelTitle:"Status",beginMinimized:!0})};e.inherits(d),e.prototype.render=function(a){a=a||{},this.setPanelTitle(a.statusString),e.superPrototype.render.call(this);var b=$(c({remoteNodeName:a.remoteNodeName,myHostname:a.myHostname,myAddress:a.myAddress,shareLink:a.shareLink}));this.getBody().html(b),a.isConnected&&this.addButton("Disconnect",this.disconnectCallback_),this.getBody().find(".clean-shard-now").click(this.cleanShardNow_),this.getBody().find(".expire-heartbeat").click(this.expireHeartbeat_)}},{"../utils":292,"./NetSimPanel.js":198,"./NetSimStatusPanel.html.ejs":217}],217:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("./locale"),b=!1;buf.push('\n<div class="content-wrap">\n  '),remoteNodeName&&buf.push("\n  <p>Connected to ",escape(remoteNodeName),"</p>\n  "),buf.push("\n\n  "),myHostname&&buf.push("\n  <p>My hostname: ",escape(myHostname),"</p>\n  "),buf.push("\n\n  "),myAddress&&buf.push("\n  <p>My address: ",escape(myAddress),"</p>\n  "),buf.push("\n\n  "),shareLink&&buf.push('\n  <p><a href="',escape(shareLink),'">',escape(a.shareThisNetwork()),"</a></p>\n  "),buf.push("\n\n  "),b&&buf.push('\n    <input type="button" class="debug-button expire-heartbeat" value="Expire Heartbeat" title="Make local node look expired" />\n    <input type="button" class="debug-button clean-shard-now" value="Clean Shard Now" title="Manuallly start a cleaning cycle from this client" />\n  '),buf.push("\n</div>\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./locale":232,ejs:302}],212:[function(a,b){"use strict";var c=a("../utils"),d=a("../commands"),e=d.Command,f=d.CommandSequence,g=a("./NetSimEntity"),h=a("./NetSimHeartbeat"),i=a("./NetSimNode"),j=a("./NetSimWire"),k=a("./NetSimMessage"),l=a("./NetSimLogEntry"),m=a("./NetSimLogger"),n=c.getLodash(),o=m.getSingleton(),p=12e4,q=6e5,r=6e4,s=function(a,b){b=void 0!==b?b:{},h.call(this,a,b),this.nodeID_=0};s.inherits(h),s.create=function(a,b){g.create(s,a,b)},s.getAllCurrent=function(a,b){a.heartbeatTable.readAll(function(c,d){if(c)return void b(c,null);var e=d.filter(function(a){return a.cleaner===!0&&Date.now()-a.time<r}).map(function(b){return new s(a,b)});b(null,e)})},s.prototype.buildRow=function(){return c.extend(s.superPrototype.buildRow.call(this),{cleaner:!0})};var t=b.exports=function(a,b){this.shard_=a,this.nextAttemptTime_=Date.now()+b,this.heartbeat=null};t.prototype.tick=function(a){Date.now()>=this.nextAttemptTime_&&(this.nextAttemptTime_=Date.now()+p,this.cleanShard()),this.heartbeat&&this.heartbeat.tick(a),this.steps_&&(this.steps_.tick(a),this.steps_.isFinished()&&(this.steps_=void 0))},t.prototype.cleanShard=function(){this.getCleaningLock(function(a){return a?void o.warn("Failed to get cleaning lock: "+a.message):(this.steps_=new f([new u(this,"heartbeat",this.shard_.heartbeatTable),new x(this),new u(this,"heartbeat",this.shard_.heartbeatTable),new u(this,"node",this.shard_.nodeTable),new y(this),new u(this,"node",this.shard_.nodeTable),new u(this,"wire",this.shard_.wireTable),new z(this),new u(this,"message",this.shard_.messageTable),new A(this),new u(this,"log",this.shard_.logTable),new B(this),new w(this)]),void this.steps_.begin())}.bind(this))},t.prototype.hasCleaningLock=function(){return null!==this.heartbeat},t.prototype.getCleaningLock=function(a){s.create(this.shard_,function(b,c){return b?void a(b,null):void s.getAllCurrent(this.shard_,function(b,d){return b||d.length>1?void c.destroy(function(){a(new Error("Failed to acquire cleaning lock"),null)}):(this.heartbeat=c,o.info("Cleaning lock acquired"),void a(null,null))}.bind(this))}.bind(this))},t.prototype.releaseCleaningLock=function(a){this.heartbeat.destroy(function(b){this.heartbeat=null,this.nextAttemptTime_=Date.now()+q,o.info("Cleaning lock released"),a(b,null)}.bind(this))},t.prototype.cacheTable=function(a,b){void 0===this.tableCache&&(this.tableCache={}),this.tableCache[a]=b},t.prototype.getTableCache=function(a){return this.tableCache[a]},t.prototype.getShard=function(){return this.shard_};var u=function(a,b,c){e.call(this),this.cleaner_=a,this.key_=b,this.table_=c};u.inherits(e),u.prototype.onBegin_=function(){this.table_.readAll(function(a,b){this.cleaner_.cacheTable(this.key_,b),this.succeed()}.bind(this))};var v=function(a){e.call(this),this.entity_=a};v.inherits(e),v.prototype.onBegin_=function(){this.entity_.destroy(function(a){return a?(o.warn("Failed to destroy entity: "+a.message),void this.fail()):(o.info("Deleted entity"),void this.succeed())}.bind(this))};var w=function(a){e.call(this),this.cleaner_=a};w.inherits(e),w.prototype.onBegin_=function(){this.cleaner_.releaseCleaningLock(function(a){a?this.succeed():this.fail()}.bind(this))};var x=function(a){f.call(this),this.cleaner_=a};x.inherits(f),x.prototype.onBegin_=function(){var a=this.cleaner_.getTableCache("heartbeat");this.commandList_=a.filter(function(a){return Date.now()-a.time>r}).map(function(a){return new v(new h(this.cleaner_.getShard(),a))}.bind(this)),f.prototype.onBegin_.call(this)};var y=function(a){f.call(this),this.cleaner_=a};y.inherits(f),y.prototype.onBegin_=function(){var a=this.cleaner_.getTableCache("heartbeat"),b=this.cleaner_.getTableCache("node");this.commandList_=b.filter(function(b){return a.every(function(a){return a.nodeID!==b.id})}).map(function(a){return new v(new i(this.cleaner_.getShard(),a))}.bind(this)),f.prototype.onBegin_.call(this)};var z=function(a){f.call(this),this.cleaner_=a};z.inherits(f),z.prototype.onBegin_=function(){var a=this.cleaner_.getTableCache("node"),b=this.cleaner_.getTableCache("wire");this.commandList_=b.filter(function(b){return!(a.some(function(a){return a.id===b.localNodeID})&&a.some(function(a){return a.id===b.remoteNodeID}))}).map(function(a){return new v(new j(this.cleaner_.getShard(),a))}.bind(this)),f.prototype.onBegin_.call(this)};var A=function(a){f.call(this),this.cleaner_=a};A.inherits(f),A.prototype.onBegin_=function(){var a=this.cleaner_.getTableCache("node"),b=this.cleaner_.getTableCache("message");this.commandList_=b.filter(function(b){var c=n.find(a,function(a){return a.id===b.simulatedBy});if(!c)return!0;var d=n.find(a,function(a){return a.id===b.toNodeID});return!d}).map(function(a){return new v(new k(this.cleaner_.getShard(),a))}.bind(this)),f.prototype.onBegin_.call(this)};var B=function(a){f.call(this),this.cleaner_=a};B.inherits(f),B.prototype.onBegin_=function(){var a=this.cleaner_.getTableCache("node"),b=this.cleaner_.getTableCache("log");this.commandList_=b.filter(function(b){return a.every(function(a){return a.id!==b.nodeID})}).map(function(a){return new v(new l(this.cleaner_.getShard(),a))}.bind(this)),f.prototype.onBegin_.call(this)}},{"../commands":85,"../utils":292,"./NetSimEntity":177,"./NetSimHeartbeat":179,"./NetSimLogEntry":182,"./NetSimLogger":186,"./NetSimMessage":188,"./NetSimNode":193,"./NetSimWire":227}],211:[function(a,b){"use strict";var c=a("../clientApi").SharedTableApi,d=a("./NetSimTable"),e="HQJ8GCCMGP7Yh8MrtDusIA==";window&&window.location&&window.location.hostname&&"localhost"===window.location.hostname.split(".")[0]&&(e="JGW2rHUp_UCMW_fQmRf6iQ==");var f=b.exports=function(a){this.id=a,this.nodeTable=new d(new c(e,a+"_n")),this.wireTable=new d(new c(e,a+"_w")),this.messageTable=new d(new c(e,a+"_m")),this.messageTable.setPollingInterval(3e3),this.logTable=new d(new c(e,a+"_l")),this.logTable.setPollingInterval(1e4),this.heartbeatTable=new d(new c(e,a+"_h"))};f.prototype.tick=function(a){this.nodeTable.tick(a),this.wireTable.tick(a),this.messageTable.tick(a),this.logTable.tick(a)}},{"../clientApi":83,"./NetSimTable":219}],219:[function(a,b){"use strict";var c=a("../utils").getLodash(),d=a("../ObservableEvent"),e=5e3,f=b.exports=function(a){this.remoteTable_=a,this.tableChange=new d,this.cache_={},this.lastFullUpdateTime_=0,this.pollingInterval_=e};f.prototype.readAll=function(a){this.remoteTable_.readAll(function(b,c){null===b&&this.fullCacheUpdate_(c),a(b,c)}.bind(this))},f.prototype.readAllCached=function(){return this.arrayFromCache_()},f.prototype.read=function(a,b){this.remoteTable_.read(a,function(c,d){null===c&&this.updateCacheRow_(a,d),b(c,d)}.bind(this))},f.prototype.create=function(a,b){this.remoteTable_.create(a,function(a,c){null===a&&this.addRowToCache_(c),b(a,c)}.bind(this))},f.prototype.update=function(a,b,c){this.remoteTable_.update(a,b,function(d,e){null===d&&this.updateCacheRow_(a,b),c(d,e)}.bind(this))},f.prototype["delete"]=function(a,b){this.remoteTable_["delete"](a,function(c,d){null===c&&this.removeRowFromCache_(a),b(c,d)}.bind(this))},f.prototype.synchronousDelete=function(a){this.remoteTable_.synchronousDelete(a),this.removeRowFromCache_(a)},f.prototype.fullCacheUpdate_=function(a){var b=a.reduce(function(a,b){return a[b.id]=b,a},{});c.isEqual(this.cache_,b)||(this.cache_=b,this.tableChange.notifyObservers(this.arrayFromCache_())),this.lastFullUpdateTime_=Date.now()},f.prototype.addRowToCache_=function(a){this.cache_[a.id]=a,this.tableChange.notifyObservers(this.arrayFromCache_())},f.prototype.removeRowFromCache_=function(a){void 0!==this.cache_[a]&&(delete this.cache_[a],this.tableChange.notifyObservers(this.arrayFromCache_()))},f.prototype.updateCacheRow_=function(a,b){var d=this.cache_[a],e=b;e.id=a,c.isEqual(d,e)||(this.cache_[a]=e,this.tableChange.notifyObservers(this.arrayFromCache_()))},f.prototype.arrayFromCache_=function(){var a=[];for(var b in this.cache_)this.cache_.hasOwnProperty(b)&&a.push(this.cache_[b]);return a},f.prototype.setPollingInterval=function(a){this.pollingInterval_=a},f.prototype.tick=function(){var a=Date.now();a-this.lastFullUpdateTime_>this.pollingInterval_&&(this.lastFullUpdateTime_=a,this.readAll(function(){}))}},{"../ObservableEvent":1,"../utils":292}],210:[function(a,b){"use strict";var c=a("../utils"),d=a("./locale"),e=a("./NetSimSendPanel.html.ejs"),f=a("./NetSimPanel"),g=a("./NetSimPacketEditor"),h=a("./NetSimPacketSizeControl"),i=a("./Packet"),j=a("./dataConverters"),k=a("./netsimConstants"),l=a("./netsimGlobals"),m=k.EncodingType,n=k.MessageGranularity,o=k.BITS_PER_BYTE,p=j.binaryToAB,q=a("./NetSimLogger").getSingleton(),r=b.exports=function(a,b,c){this.levelConfig_=b,this.packetSpec_=b.clientInitialPacketHeader,this.netsim_=c,this.packets_=[],this.fromAddress_=0,this.maxPacketSize_=b.defaultPacketSizeLimit,this.chunkSize_=o,this.bitRate_=1/0,this.enabledEncodings_=b.defaultEnabledEncodings,this.packetsDiv_=null,this.packetSizeControl_=null,this.isPlayingSendAnimation_=!1;var e=b.messageGranularity===n.PACKETS?d.sendAMessage():d.sendBits();this.netsim_.runLoop_.tick.register(this.tick.bind(this)),f.call(this,a,{className:"netsim-send-panel",panelTitle:e})};r.inherits(f),r.prototype.beginSendingPackets_=function(){this.isPlayingSendAnimation_=!0,this.disableEverything()},r.prototype.stopSendingPackets_=function(){this.resetPackets_(),this.enableEverything(),this.isPlayingSendAnimation_=!1},r.prototype.tick=function(a){if(this.isPlayingSendAnimation_){if(0===this.packets_.length)return void this.stopSendingPackets_();var b=this.packets_[0];b.isSending()?b.tick(a):b.beginSending(this.netsim_.myNode)}},r.prototype.render=function(){r.superPrototype.render.call(this);var a=$(e({level:this.levelConfig_}));if(this.getBody().html(a),this.levelConfig_.showPacketSizeControl){var b=l.getLevelConfig(),c=new i.Encoder(b.addressFormat,b.packetCountBitWidth,this.packetSpec_);this.packetSizeControl_=new h(this.rootDiv_.find(".packet-size"),this.packetSizeChangeCallback_.bind(this),{minimumPacketSize:c.getHeaderLength(),sliderStepValue:1}),this.packetSizeControl_.setValue(this.maxPacketSize_)}this.packetsDiv_=this.getBody().find(".send-panel-packets"),this.getBody().find("#add-packet-button").click(this.onAddPacketButtonPress_.bind(this)),this.getBody().find("#send-button").click(this.onSendButtonPress_.bind(this)),this.getBody().find("#set-wire-button").click(this.onSetWireButtonPress_.bind(this)),this.resetPackets_()},r.prototype.addPacket_=function(){var a=this.packets_.length+1;this.packets_.forEach(function(b){b.setPacketCount(a)});var b=0;this.packets_.length>0&&(b=this.packets_[this.packets_.length-1].toAddress);var c=new g({messageGranularity:this.levelConfig_.messageGranularity,packetSpec:this.packetSpec_,toAddress:b,fromAddress:this.fromAddress_,packetIndex:a,packetCount:a,maxPacketSize:this.maxPacketSize_,chunkSize:this.chunkSize_,bitRate:this.bitRate_,enabledEncodings:this.enabledEncodings_,removePacketCallback:this.removePacket_.bind(this),contentChangeCallback:this.onContentChange_.bind(this)}),d=this.netsim_.updateLayout.bind(this.netsim_);c.getRoot().appendTo(this.packetsDiv_),c.getRoot().hide().slideDown("fast",d),this.packets_.push(c)},r.prototype.removePacket_=function(a){var b=this.netsim_.updateLayout.bind(this.netsim_);if(a.getRoot().slideUp("fast",function(){$(this).remove(),b()}),this.packets_=this.packets_.filter(function(b){return b!==a}),!this.isPlayingSendAnimation_)for(var c,d=this.packets_.length,e=0;d>e;e++)c=e+1,this.packets_[e].setPacketIndex(c),this.packets_[e].setPacketCount(d)},r.prototype.resetPackets_=function(){this.packetsDiv_.empty(),this.packets_.length=0,this.addPacket_()},r.prototype.onContentChange_=function(){var a=this.getNextBit_();this.isEncodingEnabled_(m.A_AND_B)&&!this.isEncodingEnabled_(m.BINARY)&&(a=p(a)),this.getBody().find("#set-wire-button").text(d.setWireToValue({value:a}))},r.prototype.isEncodingEnabled_=function(a){return this.enabledEncodings_.some(function(b){return b===a})},r.prototype.setFromAddress=function(a){this.fromAddress_=c.valueOr(a,0),this.packets_.forEach(function(a){a.setFromAddress(this.fromAddress_)}.bind(this))},r.prototype.onAddPacketButtonPress_=function(a){var b=$(a.target);if(!b.is("[disabled]")){this.addPacket_();var c=this.getBody().find(".send-panel-packets");c.animate({scrollTop:c[0].scrollHeight},"fast")}},r.prototype.onSendButtonPress_=function(a){var b=$(a.target);b.is("[disabled]")||this.beginSendingPackets_()},r.prototype.onSetWireButtonPress_=function(a){var b=$(a.target);if(!b.is("[disabled]")){var c=this.netsim_.myNode;if(!c)throw new Error("Tried to set wire state when no connection is established.");this.disableEverything(),this.netsim_.animateSetWireState(this.getNextBit_()),c.setSimplexWireState(this.getNextBit_(),function(a){return a?void q.warn(a.message):(this.consumeFirstBit(),void this.enableEverything())}.bind(this))}},r.prototype.getNextBit_=function(){return this.packets_.length>0?this.packets_[0].getFirstBit():"0"},r.prototype.disableEverything=function(){this.getBody().find("input, textarea").prop("disabled",!0),this.getBody().find(".netsim-button").attr("disabled","disabled"),this.packetSizeControl_&&this.packetSizeControl_.disable()},r.prototype.enableEverything=function(){this.getBody().find("input, textarea").prop("disabled",!1),this.getBody().find(".netsim-button").removeAttr("disabled"),this.packetSizeControl_&&this.packetSizeControl_.enable()},r.prototype.consumeFirstBit=function(){this.packets_.length>0&&(this.packets_[0].consumeFirstBit(),""===this.packets_[0].getPacketBinary()&&this.packets_.length>1&&this.removePacket_(this.packets_[0]))},r.prototype.setEncodings=function(a){this.enabledEncodings_=a,this.packets_.forEach(function(b){b.setEncodings(a)}),this.onContentChange_()},r.prototype.setChunkSize=function(a){this.chunkSize_=a,this.packets_.forEach(function(b){b.setChunkSize(a)})},r.prototype.setBitRate=function(a){this.bitRate_=a,this.packets_.forEach(function(b){b.setBitRate(a)})},r.prototype.packetSizeChangeCallback_=function(a){this.maxPacketSize_=a,this.packets_.forEach(function(b){b.setMaxPacketSize(a)})},r.prototype.onMinimizerClick_=function(){r.superPrototype.onMinimizerClick_.call(this),this.netsim_.updateLayout()}},{"../utils":292,"./NetSimLogger":186,"./NetSimPacketEditor":195,"./NetSimPacketSizeControl":196,"./NetSimPanel":198,"./NetSimSendPanel.html.ejs":209,"./Packet":228,"./dataConverters":230,"./locale":232,"./netsimConstants":235,"./netsimGlobals":236}],209:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("./locale"),b=require("./netsimConstants").MessageGranularity;buf.push('\n<div class="send-panel-packets"></div>\n<div class="panel-footer">\n  <div class="right-side-controls">\n    '),level.showAddPacketButton&&buf.push('\n      <span class="netsim-button secondary large-button" id="add-packet-button">',escape(a.addPacket()),"</span>\n    "),buf.push("\n    "),level.messageGranularity===b.PACKETS?buf.push('\n      <span class="netsim-button large-button" id="send-button">',escape(a.send()),"</span>\n    "):level.messageGranularity===b.BITS&&buf.push('\n      <span class="netsim-button large-button" id="set-wire-button">',escape(a.setWire()),"</span>\n    "),buf.push('\n  </div>\n  <div class="packet-size"></div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./locale":232,"./netsimConstants":235,ejs:302}],208:[function(a,b){"use strict";var c=a("./NetSimRouterTab.html.ejs"),d=a("./NetSimBandwidthControl"),e=a("./NetSimMemoryControl"),f=a("./NetSimRouterLogTable"),g=a("./NetSimRouterStatsTable"),h=a("./netsimGlobals"),i=b.exports=function(a,b){this.rootDiv_=a,this.bandwidthSliderChangeCallback_=b.bandwidthSliderChangeCallback,this.bandwidthSliderStopCallback_=b.bandwidthSliderStopCallback,this.memorySliderChangeCallback_=b.memorySliderChangeCallback,this.memorySliderStopCallback_=b.memorySliderStopCallback,this.routerLogTable_=null,this.routerStatsTable_=null,this.bandwidthControl_=null,this.memoryControl_=null,this.render()};i.prototype.attachToRunLoop=function(a){this.routerStatsTable_&&this.routerStatsTable_.attachToRunLoop(a)},i.prototype.render=function(){var a=h.getLevelConfig(),b=$(c({level:a}));this.rootDiv_.html(b),this.routerLogTable_=new f(this.rootDiv_.find(".router_log_table"),a),this.routerStatsTable_=new g(this.rootDiv_.find(".router-stats")),a.showRouterBandwidthControl&&(this.bandwidthControl_=new d(this.rootDiv_.find(".bandwidth-control"),this.bandwidthSliderChangeCallback_,this.bandwidthSliderStopCallback_)),a.showRouterMemoryControl&&(this.memoryControl_=new e(this.rootDiv_.find(".memory-control"),this.memorySliderChangeCallback_,this.memorySliderStopCallback_))},i.prototype.setRouterLogData=function(a){this.routerLogTable_.setRouterLogData(a),this.routerStatsTable_&&this.routerStatsTable_.setRouterLogData(a)},i.prototype.setRouterCreationTime=function(a){this.routerStatsTable_&&this.routerStatsTable_.setRouterCreationTime(a)},i.prototype.setBandwidth=function(a){this.bandwidthControl_&&this.bandwidthControl_.setValue(a),this.routerStatsTable_&&this.routerStatsTable_.setBandwidth(a)},i.prototype.setMemory=function(a){this.memoryControl_&&this.memoryControl_.setValue(a),this.routerStatsTable_&&this.routerStatsTable_.setTotalMemory(a)},i.prototype.setRouterQueuedPacketCount=function(a){this.routerStatsTable_&&this.routerStatsTable_.setRouterQueuedPacketCount(a)},i.prototype.setMemoryInUse=function(a){this.routerStatsTable_&&this.routerStatsTable_.setMemoryInUse(a)},i.prototype.setDataRate=function(a){this.routerStatsTable_&&this.routerStatsTable_.setDataRate(a)}},{"./NetSimBandwidthControl":161,"./NetSimMemoryControl":187,"./NetSimRouterLogTable":203,"./NetSimRouterStatsTable":206,"./NetSimRouterTab.html.ejs":207,"./netsimGlobals":236}],207:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("./locale");buf.push('\n<div class="netsim-router-tab">\n  <h1>',escape(a.routerTab_stats()),'</h1>\n  <div class="router-stats"></div>\n  '),level.showRouterBandwidthControl&&buf.push("\n    <h1>",escape(a.routerTab_bandwidth()),'</h1>\n    <div class="bandwidth-control"></div>\n  '),buf.push("\n  "),level.showRouterMemoryControl&&buf.push("\n    <h1>",escape(a.routerTab_memory()),'</h1>\n    <div class="memory-control"></div>\n  '),buf.push('\n  <div class="router_log_table"></div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./locale":232,ejs:302}],206:[function(a,b){"use strict";var c=a("./NetSimRouterStatsTable.html.ejs"),d=a("./netsimUtils"),e=a("./NetSimLogEntry"),f=500,g=1e3,h=60,i=g*h,j=60,k=i*j,l=b.exports=function(a){this.rootDiv_=a,this.lastRenderTime_=null,this.routerCreationTime_=0,this.totalPackets_=0,this.successfulPackets_=0,this.totalData_=0,this.successfulData_=0,this.bandwidthLimit_=0,this.dataRate_=0,this.totalMemory_=0,this.queuedPackets_=0,this.usedMemory_=0,this.render({})};l.prototype.attachToRunLoop=function(a){a.render.register(this.render.bind(this))},l.prototype.render=function(a){if(this.needsRender(a)){var b=$(c({uptime:this.getLocalizedUptime(),queuedPackets:this.queuedPackets_,totalPackets:this.totalPackets_,successfulPackets:this.successfulPackets_,totalData:this.totalData_,successfulData:this.successfulData_,bandwidthLimit:this.bandwidthLimit_,dataRate:this.dataRate_,totalMemory:this.totalMemory_,usedMemory:this.usedMemory_}));this.rootDiv_.html(b),this.lastRenderTime_=a.time}},l.prototype.needsRender=function(a){return!this.lastRenderTime_||a.time-this.lastRenderTime_>f},l.prototype.setNeedsRender=function(){this.lastRenderTime_=null},l.prototype.getLocalizedUptime=function(){var a=0,b=0,c=0;if(this.routerCreationTime_>0){var e=Date.now()-this.routerCreationTime_;a=Math.floor(e/k),e-=a*k,b=Math.floor(e/i),e-=b*i,c=Math.floor(e/g)}return a.toString()+":"+d.zeroPadLeft(b,2)+":"+d.zeroPadLeft(c,2)};var m=function(a){return a.reduce(function(a,b){return a+b.binary.length},0)};l.prototype.setRouterLogData=function(a){var b=a.filter(function(a){return a.status===e.LogStatus.SUCCESS});this.totalPackets_=a.length,this.successfulPackets_=b.length,this.totalData_=m(a),this.successfulData_=m(b),this.setNeedsRender()},l.prototype.setRouterCreationTime=function(a){this.routerCreationTime_=a,this.setNeedsRender()},l.prototype.setBandwidth=function(a){this.bandwidthLimit_=a,this.setNeedsRender()},l.prototype.setTotalMemory=function(a){this.totalMemory_=a,this.setNeedsRender()},l.prototype.setRouterQueuedPacketCount=function(a){this.queuedPackets_=a,this.setNeedsRender()},l.prototype.setMemoryInUse=function(a){this.usedMemory_=a,this.setNeedsRender()},l.prototype.setDataRate=function(a){this.dataRate_=a,this.setNeedsRender()}},{"./NetSimLogEntry":182,"./NetSimRouterStatsTable.html.ejs":205,"./netsimUtils":238}],205:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../utils"),b=require("./netsimUtils"),c=function(a,b){buf.push("\n      <tr>\n        <th nowrap>",escape(a),"</th>\n        <td>",escape(b),"</td>\n      </tr>\n    ")},d=function(b,d,e,f){f=a.valueOr(f,function(a){return a});var g=f(d)+" / "+f(e);e>0&&1/0>e&&(g+=" ("+Math.round(100*d/e)+"%)"),c(b,g)};buf.push("\n<table>\n  <tbody>\n    "),c("Uptime",uptime),buf.push("\n    "),c("Queued Packets",queuedPackets),buf.push("\n    "),d("Memory Use",usedMemory,totalMemory,b.bitsToLocalizedRoundedBytesize),buf.push("\n    "),d("Throughput",dataRate,bandwidthLimit,b.bitrateToLocalizedRoundedBitrate),buf.push("\n    "),d("Routed Packets",successfulPackets,totalPackets),buf.push("\n    "),d("Routed Data",successfulData,totalData,b.bitsToLocalizedRoundedBytesize),buf.push("\n  </tbody>\n</table>\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../utils":292,"./netsimUtils":238,ejs:302}],203:[function(a,b){"use strict";var c=a("./NetSimRouterLogTable.html.ejs"),d=b.exports=function(a,b){this.rootDiv_=a,this.levelConfig_=b,this.routerLogData_=[],this.render()};d.prototype.render=function(){var a=$(c({level:this.levelConfig_,tableData:this.routerLogData_}));this.rootDiv_.html(a)},d.prototype.setRouterLogData=function(a){this.routerLogData_=a,this.render()}},{"./NetSimRouterLogTable.html.ejs":202}],202:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("./locale"),b=(require("./netsimConstants"),require("./netsimUtils")),c=require("./Packet"),d=level.routerExpectsPacketHeader,e=d.indexOf(c.HeaderType.TO_ADDRESS)>-1,f=d.indexOf(c.HeaderType.FROM_ADDRESS)>-1,g=d.indexOf(c.HeaderType.PACKET_INDEX)>-1&&d.indexOf(c.HeaderType.PACKET_COUNT)>-1;buf.push('\n<div class="netsim-router-log">\n  <h1>Router Traffic</h1>\n  <table>\n    <thead>\n    <tr>\n      '),e&&buf.push("\n        <th nowrap>",escape(a.to()),"</th>\n      "),buf.push("\n      "),f&&buf.push("\n        <th nowrap>",escape(a.from()),"</th>\n      "),buf.push("\n      "),g&&buf.push("\n        <th nowrap>",escape(a.packetInfo()),"</th>\n      "),buf.push("\n      <th nowrap>",escape(a.size()),"</th>\n      <th nowrap>",escape(a.status()),"</th>\n    </tr>\n    </thead>\n    <tbody>\n    "),tableData.sort(function(a,b){return a.timestamp>b.timestamp?-1:1
}),tableData.forEach(function(d){var h=[];buf.push('\n    <tr class="',escape(h.join(" ")),'" title="',escape(d.getMessageAscii()),'">\n      '),e&&buf.push("\n        <td nowrap>",escape(d.getHeaderField(c.HeaderType.TO_ADDRESS)),"</td>\n      "),buf.push("\n      "),f&&buf.push("\n        <td nowrap>",escape(d.getHeaderField(c.HeaderType.FROM_ADDRESS)),"</td>\n      "),buf.push("\n      "),g&&buf.push("\n        <td nowrap>",escape(a.xOfYPackets({x:d.getHeaderField(c.HeaderType.PACKET_INDEX),y:d.getHeaderField(c.HeaderType.PACKET_COUNT)})),"</td>\n      "),buf.push("\n      <td nowrap>",escape(b.bitsToLocalizedRoundedBytesize(d.binary.length)),"</td>\n      <td nowrap>",escape(d.getLocalizedStatus()),"</td>\n    </tr>\n    ")}),buf.push("\n    </tbody>\n  </table>\n</div>")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./Packet":228,"./locale":232,"./netsimConstants":235,"./netsimUtils":238,ejs:302}],196:[function(a,b){"use strict";var c=a("./locale"),d=a("./NetSimSlider"),e=b.exports=function(a,b,c){d.call(this,a,{onChange:b,min:c.minimumPacketSize,max:1024,upperBoundInfinite:!0}),this.render()};e.inherits(d),e.prototype.getPacketSizeText=function(a){return 1/0===a?c.unlimited():c.numBitsPerPacket({numBits:a})},e.prototype.valueToLabel=function(a){return 1/0===a?c.unlimited():c.numBitsPerPacket({numBits:a})},e.prototype.valueToShortLabel=function(a){return 1/0===a?c.unlimited():a}},{"./NetSimSlider":216,"./locale":232}],195:[function(a,b){"use strict";a("../utils");var c=a("./locale"),d=a("./NetSimPacketEditor.html.ejs"),e=a("../constants").KeyCodes,f=a("./NetSimEncodingControl"),g=a("./NetSimLogPanel"),h=a("./Packet"),i=a("./dataConverters"),j=a("./netsimConstants"),k=a("./netsimGlobals"),l=j.EncodingType,m=j.BITS_PER_BYTE,n=i.minifyBinary,o=i.formatAB,p=i.formatBinary,q=i.formatHex,r=i.alignDecimal,s=i.abToBinary,t=i.abToInt,u=i.binaryToAB,v=i.binaryToHex,w=i.binaryToInt,x=i.binaryToDecimal,y=i.binaryToAscii,z=i.hexToBinary,A=i.intToAB,B=i.intToBinary,C=i.intToHex,D=i.decimalToBinary,E=i.asciiToBinary,F=b.exports=function(a){var b=k.getLevelConfig();this.rootDiv_=$("<div>").addClass("netsim-packet"),this.messageGranularity_=a.messageGranularity,this.packetSpec_=a.packetSpec,this.toAddress=a.toAddress||i.binaryToAddressString("0",b.addressFormat),this.fromAddress=a.fromAddress||i.binaryToAddressString("0",b.addressFormat),this.packetIndex=void 0!==a.packetIndex?a.packetIndex:1,this.packetCount=void 0!==a.packetCount?a.packetCount:1,this.message=a.message||"",this.maxPacketSize_=a.maxPacketSize||1/0,this.currentChunkSize_=a.chunkSize||m,this.bitRate_=a.bitRate||1/0,this.enabledEncodings_=a.enabledEncodings||[],this.removePacketCallback_=a.removePacketCallback,this.contentChangeCallback_=a.contentChangeCallback,this.removePacketButton_=null,this.bitCounter_=null,this.isPlayingSendAnimation_=!1,this.isSendingPacketToRemote_=!1,this.myNode_=null,this.originalBinary_="",this.remainingBinary_="",this.lastBitSentTime_=void 0,this.render()};F.prototype.getRoot=function(){return this.rootDiv_},F.prototype.render=function(){var a=$(d({messageGranularity:this.messageGranularity_,packetSpec:this.packetSpec_}));this.rootDiv_.html(a),this.bindElements_(),this.updateFields_(),this.updateRemoveButtonVisibility_(),g.adjustHeaderColumnWidths(this.rootDiv_),f.hideRowsByEncoding(this.rootDiv_,this.enabledEncodings_)},F.prototype.beginSending=function(a){this.isPlayingSendAnimation_=!0,this.originalBinary_=this.getPacketBinary().substr(0,this.maxPacketSize_),this.remainingBinary_=this.originalBinary_,this.myNode_=a,0===this.remainingBinary_.length&&this.finishSending()},F.prototype.finishSending=function(){this.isPlayingSendAnimation_=!1,this.isSendingPacketToRemote_=!0,this.myNode_.sendMessage(this.originalBinary_,function(){this.isSendingPacketToRemote_=!1,this.removePacketCallback_(this)}.bind(this))},F.prototype.isSending=function(){return this.isPlayingSendAnimation_||this.isSendingPacketToRemote_},F.prototype.tick=function(a){if(this.isPlayingSendAnimation_&&!this.isSendingPacketToRemote_){this.lastBitSentTime_||(this.lastBitSentTime_=a.time);var b=a.time-this.lastBitSentTime_,c=1e3*(1/this.bitRate_),d=Math.floor(b/c);d>0&&(this.lastBitSentTime_=a.time,this.remainingBinary_=this.remainingBinary_.substr(d),this.setPacketBinary(this.remainingBinary_),0===this.remainingBinary_.length&&this.finishSending())}};var G=function(a){var b=$(a.target);b.hasClass("watermark")&&(b.val(""),b.removeClass("watermark"))},H=function(a){return function(b){if(b.metaKey||b.ctrlKey)return!0;if(b.which<e.SPACE||b.which>=e.DELETE)return!0;var c=String.fromCharCode(b.which);return a.test(c)?void 0:(b.preventDefault(),!1)}};F.prototype.makeKeyupHandler=function(a,b,c){return function(d){var e=b(d.target.value,c);"string"!=typeof e&&isNaN(e)||(this[a]=e,this.updateFields_(d.target))}.bind(this)},F.prototype.makeBlurHandler=function(a,b,c){return function(d){var e=b(d.target.value,c);"number"==typeof e&&isNaN(e)&&(e=b("0")),this[a]=e,this.updateFields_()}.bind(this)};var I=function(a,b){return w(a.substr(-b))},J=function(a,b){return t(a.substr(-b))},K=function(a,b){return I(z(a),b)},L=function(a,b){return I(B(parseInt(a,10)),b)},M=function(a){var b=k.getLevelConfig(),c=i.addressStringToBinary(a,b.addressFormat);return i.binaryToAddressString(c,b.addressFormat)};F.prototype.bindElements_=function(){var a=k.getLevelConfig(),b=this.rootDiv_,c=[{typeName:l.A_AND_B,addressFieldAllowedCharacters:/[AB\s]/i,addressFieldConversion:function(b){return i.binaryToAddressString(i.abToBinary(b),a.addressFormat)},shortNumberAllowedCharacters:/[AB]/i,shortNumberConversion:J,messageAllowedCharacters:/[AB\s]/i,messageConversion:s},{typeName:l.BINARY,addressFieldAllowedCharacters:/[01\s]/i,addressFieldConversion:function(b){return i.binaryToAddressString(b,a.addressFormat)},shortNumberAllowedCharacters:/[01]/,shortNumberConversion:I,messageAllowedCharacters:/[01\s]/,messageConversion:n},{typeName:l.HEXADECIMAL,addressFieldAllowedCharacters:/[0-9a-f\s]/i,addressFieldConversion:function(b){return i.binaryToAddressString(i.hexToBinary(b),a.addressFormat)},shortNumberAllowedCharacters:/[0-9a-f]/i,shortNumberConversion:K,messageAllowedCharacters:/[0-9a-f\s]/i,messageConversion:z},{typeName:l.DECIMAL,addressFieldAllowedCharacters:/[0-9.\s]/i,addressFieldConversion:M,shortNumberAllowedCharacters:/[0-9]/,shortNumberConversion:L,messageAllowedCharacters:/[0-9\s]/,messageConversion:function(a){return D(a,this.currentChunkSize_)}.bind(this)},{typeName:l.ASCII,addressFieldAllowedCharacters:/[0-9.\s]/i,addressFieldConversion:M,shortNumberAllowedCharacters:/[0-9]/,shortNumberConversion:L,messageAllowedCharacters:/./,messageConversion:function(a){return E(a,this.currentChunkSize_)}.bind(this)}];c.forEach(function(a){var c=b.find("tr."+a.typeName),d=a.typeName+"UI";this[d]={};var e=this[d],f=k.getLevelConfig(),g=new h.Encoder(f.addressFormat,f.packetCountBitWidth,this.packetSpec_);this.packetSpec_.forEach(function(b){var d,f,i=b,j=g.getFieldBitWidth(i);h.isAddressField(i)?(d=a.addressFieldAllowedCharacters,f=a.addressFieldConversion):(d=a.shortNumberAllowedCharacters,f=a.shortNumberConversion),e[i]=c.find("input."+i),e[i].keypress(H(d)),e[i].keyup(this.makeKeyupHandler(i,f,j)),e[i].blur(this.makeBlurHandler(i,f,j))},this),e.message=c.find("textarea.message"),e.message.focus(G),e.message.keypress(H(a.messageAllowedCharacters)),e.message.keyup(this.makeKeyupHandler("message",a.messageConversion)),e.message.blur(this.makeBlurHandler("message",a.messageConversion))},this),this.removePacketButton_=b.find(".remove-packet-button"),this.removePacketButton_.click(this.onRemovePacketButtonClick_.bind(this)),this.bitCounter_=b.find(".bit-counter")},F.prototype.updateFields_=function(a){var b=this.currentChunkSize_,d=[],e=k.getLevelConfig(),f=new h.Encoder(e.addressFormat,e.packetCountBitWidth,this.packetSpec_);this.packetSpec_.forEach(function(a){var b,c,g,j,k,l=a,m=f.getFieldBitWidth(l);h.isAddressField(l)?(b=function(a){return i.binaryToAB(i.addressStringToBinary(a,e.addressFormat))},c=function(a){return i.formatBinaryForAddressHeader(i.addressStringToBinary(a,e.addressFormat),e.addressFormat)},g=function(a){return i.binaryToHex(i.addressStringToBinary(a,e.addressFormat))},j=M,k=M):(b=A,c=B,g=C,j=function(a){return a.toString(10)},k=j),d.push({inputElement:this.a_and_bUI[l],newValue:b(this[l],m)}),d.push({inputElement:this.binaryUI[l],newValue:c(this[l],m)}),d.push({inputElement:this.hexadecimalUI[l],newValue:g(this[l],Math.ceil(m/4))}),d.push({inputElement:this.decimalUI[l],newValue:j(this[l],m)}),d.push({inputElement:this.asciiUI[l],newValue:k(this[l],m)})},this),d.push({inputElement:this.a_and_bUI.message,newValue:o(u(this.message),b),watermark:c.a_and_b()}),d.push({inputElement:this.binaryUI.message,newValue:p(this.message,b),watermark:c.binary()}),d.push({inputElement:this.hexadecimalUI.message,newValue:q(v(this.message),b),watermark:c.hexadecimal()}),d.push({inputElement:this.decimalUI.message,newValue:r(x(this.message,b)),watermark:c.decimal()}),d.push({inputElement:this.asciiUI.message,newValue:y(this.message,b),watermark:c.ascii()}),d.forEach(function(b){b.inputElement[0]!==a&&(b.watermark&&""===b.newValue?(b.inputElement.val(b.watermark),b.inputElement.addClass("watermark")):(b.inputElement.val(b.newValue),b.inputElement.removeClass("watermark")))}),this.updateBitCounter(),this.contentChangeCallback_()},F.prototype.updateRemoveButtonVisibility_=function(){this.removePacketButton_.css("display",1===this.packetCount?"none":"")},F.prototype.getPacketBinary=function(){var a=k.getLevelConfig(),b=new h.Encoder(a.addressFormat,a.packetCountBitWidth,this.packetSpec_);return b.concatenateBinary(b.makeBinaryHeaders({toAddress:this.toAddress,fromAddress:this.fromAddress,packetIndex:this.packetIndex,packetCount:this.packetCount}),this.message)},F.prototype.setPacketBinary=function(a){var b=new h(this.packetSpec_,a);this.specContainsHeader_(h.HeaderType.TO_ADDRESS)&&(this.toAddress=b.getHeaderAsAddressString(h.HeaderType.TO_ADDRESS)),this.specContainsHeader_(h.HeaderType.FROM_ADDRESS)&&(this.fromAddress=b.getHeaderAsAddressString(h.HeaderType.FROM_ADDRESS)),this.specContainsHeader_(h.HeaderType.PACKET_INDEX)&&(this.packetIndex=b.getHeaderAsInt(h.HeaderType.PACKET_INDEX)),this.specContainsHeader_(h.HeaderType.PACKET_COUNT)&&(this.packetCount=b.getHeaderAsInt(h.HeaderType.PACKET_COUNT)),this.message=b.getBodyAsBinary(),this.updateFields_()},F.prototype.specContainsHeader_=function(a){return this.packetSpec_.some(function(b){return b===a})},F.prototype.getFirstBit=function(){var a=this.getPacketBinary();return a.length>0?a.substr(0,1):"0"},F.prototype.setFromAddress=function(a){this.fromAddress=a,this.updateFields_()},F.prototype.setPacketIndex=function(a){this.packetIndex=a,this.updateFields_()},F.prototype.setPacketCount=function(a){this.packetCount=a,this.updateFields_(),this.updateRemoveButtonVisibility_()},F.prototype.setMaxPacketSize=function(a){this.maxPacketSize_=a,this.updateBitCounter()},F.prototype.setEncodings=function(a){this.enabledEncodings_=a,f.hideRowsByEncoding(this.rootDiv_,a)},F.prototype.setChunkSize=function(a){this.currentChunkSize_=a,this.updateFields_()},F.prototype.setBitRate=function(a){this.bitRate_=a},F.prototype.updateBitCounter=function(){var a=this.getPacketBinary().length,b=1/0===this.maxPacketSize_?c.infinity():this.maxPacketSize_;this.bitCounter_.html(c.bitCounter({x:a,y:b})),this.bitCounter_.toggleClass("oversized",a>this.maxPacketSize_)},F.prototype.onRemovePacketButtonClick_=function(a){var b=$(a.target);b.is("[disabled]")||b.parents().is("[disabled]")||this.removePacketCallback_(this)},F.prototype.consumeFirstBit=function(){this.setPacketBinary(this.getPacketBinary().substr(1))}},{"../constants":86,"../utils":292,"./NetSimEncodingControl":176,"./NetSimLogPanel":185,"./NetSimPacketEditor.html.ejs":194,"./Packet":228,"./dataConverters":230,"./locale":232,"./netsimConstants":235,"./netsimGlobals":236}],194:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(){buf.push('\n      <thead>\n        <tr>\n          <th nowrap class="',escape(i.ENCODING_LABEL),'"></th>\n          '),m&&buf.push('\n          <th nowrap class="',escape(i.TO_ADDRESS),'">',escape(c.to()),"</th>\n          "),buf.push("\n          "),n&&buf.push('\n          <th nowrap class="',escape(i.FROM_ADDRESS),'">',escape(c.from()),"</th>\n          "),buf.push("\n          "),o&&buf.push('\n          <th nowrap class="',escape(i.PACKET_INFO),'">',escape(c.packet()),"</th>\n          "),buf.push('\n          <th class="',escape(i.MESSAGE),'">\n            ',escape(c.message()),'\n            <div class="packet-controls">\n              <span class="netsim-button secondary remove-packet-button" title="',escape(c.removePacket()),'"><i class="fa fa-times"></i></span>\n            </div>\n          </th>\n        </tr>\n      </thead>\n    ')}function b(a){buf.push('\n      <tr class="',escape(a),'">\n        <th nowrap class="',escape(i.ENCODING_LABEL),'">',escape(j(a)),"</th>\n        "),m&&buf.push('\n        <td nowrap class="',escape(i.TO_ADDRESS),'"><input type="text" class="',escape(f.HeaderType.TO_ADDRESS),'" /></td>\n        '),buf.push("\n        "),n&&buf.push('\n        <td nowrap class="',escape(i.FROM_ADDRESS),'"><input type="text" readonly class="',escape(f.HeaderType.FROM_ADDRESS),'" /></td>\n        '),buf.push("\n        "),o&&buf.push('\n        <td nowrap class="',escape(i.PACKET_INFO),'"><input type="text" readonly class="',escape(f.HeaderType.PACKET_INDEX),'" />',escape(c._of_()),'<input type="text" readonly class="',escape(f.HeaderType.PACKET_COUNT),'" /></td>\n        '),buf.push('\n        <td class="',escape(i.MESSAGE),'"><div><textarea class="message"></textarea></div></td>\n      </tr>\n    ')}buf.push("");var c=require("./locale"),d=require("./netsimConstants"),e=require("./netsimUtils"),f=require("./Packet"),g=d.EncodingType,h=d.MessageGranularity,i=d.PacketUIColumnType,j=e.getEncodingLabel,k=e.forEachEnumValue,l=packetSpec,m=l.indexOf(f.HeaderType.TO_ADDRESS)>-1,n=l.indexOf(f.HeaderType.FROM_ADDRESS)>-1,o=l.indexOf(f.HeaderType.PACKET_INDEX)>-1&&l.indexOf(f.HeaderType.PACKET_COUNT)>-1,p=messageGranularity===h.PACKETS;buf.push("\n<table>\n  "),p&&a(),buf.push("\n  <tbody>\n    "),k(g,function(a){b(a)}),buf.push("\n  </tbody>\n</table>\n\n"),p&&buf.push('\n  <div class="bit-counter"></div>\n'),buf.push("\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./Packet":228,"./locale":232,"./netsimConstants":235,"./netsimUtils":238,ejs:302}],192:[function(a,b){"use strict";var c=a("./NetSimMyDeviceTab.html.ejs"),d=a("./NetSimBitRateControl"),e=a("./NetSimPulseRateControl"),f=a("./NetSimChunkSizeControl"),g=a("./NetSimEncodingControl"),h=a("./NetSimMetronome"),i=a("./netsimGlobals"),j=b.exports=function(a,b,c){this.rootDiv_=a,this.runLoop_=b,this.bitsPerSecond_=1,this.chunkSizeSliderChangeCallback_=c.chunkSizeChangeCallback,this.bitRateChangeCallback_=c.bitRateChangeCallback,this.encodingChangeCallback_=c.encodingChangeCallback,this.metronome_=null,this.pulseRateControl_=null,this.bitRateControl_=null,this.chunkSizeControl_=null,this.encodingControl_=null,this.render()};j.prototype.render=function(){var a=i.getLevelConfig(),b=$(c({level:a}));this.rootDiv_.html(b),a.showMetronome&&(this.metronome_=new h(this.rootDiv_.find(".metronome"),this.runLoop_),this.metronome_.setFrequency(this.bitsPerSecond_)),a.showPulseRateSlider&&(this.pulseRateControl_=new e(this.rootDiv_.find(".pulse-rate"),1/this.bitsPerSecond_,function(a){this.bitRateChangeCallback_(1/a)}.bind(this))),a.showBitRateControl&&(this.bitRateControl_=new d(this.rootDiv_.find(".bitrate"),this.bitsPerSecond_,this.bitRateChangeCallback_),a.lockBitRateControl&&this.bitRateControl_.disable()),a.showChunkSizeControl&&(this.chunkSizeControl_=new f(this.rootDiv_.find(".chunk-size"),this.chunkSizeSliderChangeCallback_),a.lockChunkSizeControl&&this.chunkSizeControl_.disable()),a.showEncodingControls.length>0&&(this.encodingControl_=new g(this.rootDiv_.find(".encoding"),a,this.encodingChangeCallback_))},j.prototype.pulseRateSliderChange_=function(a){this.setBitRate(1/a)},j.prototype.setBitRate=function(a){this.bitsPerSecond_=a,this.metronome_&&this.metronome_.setFrequency(a),this.bitRateControl_&&this.bitRateControl_.setValue(a),this.pulseRateControl_&&1/0>a&&this.pulseRateControl_.setValue(1/a)},j.prototype.setChunkSize=function(a){this.chunkSizeControl_&&this.chunkSizeControl_.setValue(a)},j.prototype.setEncodings=function(a){this.encodingControl_&&this.encodingControl_.setEncodings(a)}},{"./NetSimBitRateControl":164,"./NetSimChunkSizeControl":165,"./NetSimEncodingControl":176,"./NetSimMetronome":190,"./NetSimMyDeviceTab.html.ejs":191,"./NetSimPulseRateControl":199,"./netsimGlobals":236}],199:[function(a,b){"use strict";a("../utils");var c=a("./locale"),d=a("./NetSimSlider"),e=b.exports=function(a,b,c){d.DecimalPrecisionSlider.call(this,a,{onChange:c,value:b,min:.5,max:5,step:-.25}),this.render()};e.inherits(d.DecimalPrecisionSlider),e.prototype.valueToLabel=function(a){var b=Math.floor(100*a)/100;return 1===b?c.xSecondPerPulse({x:b}):c.xSecondsPerPulse({x:b})},e.prototype.valueToShortLabel=function(a){return a}},{"../utils":292,"./NetSimSlider":216,"./locale":232}],191:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div class="netsim-my-device-tab">\n\n  '),level.showMetronome&&buf.push('\n    <div class="metronome"></div>\n  '),buf.push("\n\n  "),level.showPulseRateSlider&&buf.push('\n    <h1>Pulse rate</h1>\n    <div class="pulse-rate"></div>\n  '),buf.push("\n\n  "),level.showBitRateControl&&buf.push('\n    <h1>Bitrate</h1>\n    <div class="bitrate"></div>\n  '),buf.push("\n\n  "),level.showChunkSizeControl&&buf.push('\n    <h1>Chunk size</h1>\n    <div class="chunk-size"></div>\n  '),buf.push("\n\n  "),level.showEncodingControls.length>0&&buf.push('\n    <div class="encoding"></div>\n  '),buf.push("\n\n</div>\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:302}],190:[function(a,b){"use strict";var c=a("./NetSimMetronome.html.ejs"),d=b.exports=function(a,b){this.rootDiv_=a,this.lastPulseTime_=void 0,this.pulseIntervalMillis_=0,this.progress_=0,this.pulseAge_=0,b.tick.register(this.tick.bind(this)),b.render.register(this.render.bind(this))};d.prototype.tick=function(a){if(this.lastPulseTime_||(this.lastPulseTime_=a.time),1/0===this.pulseIntervalMillis_)return this.progress_=0,void(this.pulseAge_=1/0);if(this.pulseAge_=a.time-this.lastPulseTime_,this.progress_=Math.min(this.pulseAge_/this.pulseIntervalMillis_,1),this.pulseAge_>=this.pulseIntervalMillis_)for(var b=a.time-this.pulseIntervalMillis_;this.lastPulseTime_<b;)this.lastPulseTime_+=this.pulseIntervalMillis_},d.prototype.render=function(){var a=$(c({progress:this.progress_,pulseAge:this.pulseAge_}));this.rootDiv_.html(a)},d.prototype.setFrequency=function(a){return 0===a||1/0===a?void(this.pulseIntervalMillis_=1/0):void(this.pulseIntervalMillis_=1e3/a)}},{"./NetSimMetronome.html.ejs":189}],189:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(a,b){return"M"+a+" "+b}function b(a,b){return"L "+a+" "+b}function c(a,b,c,d,e,f,g){return"A "+a+" "+b+", "+c+", "+d+", "+e+", "+f+" "+g}function d(){return"Z"}function e(e){var h=2*Math.PI*e,i=e>=.5?1:0,j=Math.sin(h),k=Math.cos(h),l=f*k,m=f*j,n=g*k,o=g*j;return[a(f,0),c(f,f,0,i,1,l,m),b(n,o),c(g,g,0,i,0,g,0),d()].join(" ")}buf.push("");var f=45,g=30,h=500,i=Math.min(pulseAge/h,1),j=g*(1-i);buf.push('\n<div class="netsim-metronome">\n  <svg version="1.1" width="100" height="100" xmlns="http://www.w3.org/2000/svg">\n    <g id="centered-group" transform="translate(50,50)">\n      <circle r="48" cx="0" cy="0" fill="darkgray"></circle>\n      <circle r="48" cx="-1" cy="1" fill="lightgray"></circle>\n      <circle r="46" cx="0" cy="0" fill="#f5f5f5"></circle>\n      <circle class="pulse-dot" r="',escape(j),'" cx="0" cy="0"></circle>\n      <g transform="rotate(-90)">\n        <path class="progress-meter" d="',escape(e(progress)),'"></path>\n      </g>\n    </g>\n  </svg>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:302}],187:[function(a,b){"use strict";a("../utils");var c=a("./netsimConstants"),d=a("./netsimUtils"),e=a("./NetSimSlider"),f=b.exports=function(a,b,d){e.LogarithmicSlider.call(this,a,{onChange:b,onStop:d,value:1/0,min:c.BITS_PER_BYTE,max:c.BITS_PER_MEGABYTE,upperBoundInfinite:!0}),this.render()};f.inherits(e.LogarithmicSlider),f.prototype.valueToLabel=function(a){return d.bitsToLocalizedRoundedBytesize(a)}},{"../utils":292,"./NetSimSlider":216,"./netsimConstants":235,"./netsimUtils":238}],185:[function(a,b){"use strict";a("../utils");var c=a("./locale"),d=a("./NetSimLogPanel.html.ejs"),e=a("./Packet"),f=a("./NetSimLogPacket.html.ejs"),g=a("./NetSimPanel"),h=a("./NetSimEncodingControl"),i=a("./netsimGlobals"),j=400,k=b.exports=function(a,b){this.packetSpec_=b.packetSpec,this.packets_=[],this.currentEncodings_=[],this.currentChunkSize_=8,this.logTitle_=b.logTitle,this.hasUnreadMessages_=!!b.hasUnreadMessages,g.call(this,a,{className:"netsim-log-panel",panelTitle:b.logTitle,beginMinimized:b.isMinimized})};k.inherits(g),k.prototype.render=function(){k.superPrototype.render.call(this);var a=$(d({}));this.getBody().html(a),this.addButton(c.clear(),this.onClearButtonPress_.bind(this)),this.scrollArea_=this.getBody().find(".scroll-area"),this.updateUnreadCount()},k.prototype.onClearButtonPress_=function(){this.scrollArea_.empty(),this.packets_.length=0,this.updateUnreadCount()},k.prototype.log=function(a){var b=new l(a,{packetSpec:this.packetSpec_,encodings:this.currentEncodings_,chunkSize:this.currentChunkSize_,isUnread:this.hasUnreadMessages_,markAsReadCallback:this.updateUnreadCount.bind(this)});b.getRoot().hide(),b.getRoot().prependTo(this.scrollArea_),b.getRoot().slideDown(j),this.packets_.unshift(b),this.updateUnreadCount()},k.prototype.updateUnreadCount=function(){var a=this.packets_.reduce(function(a,b){return a+(b.isUnread?1:0)},0);this.setPanelTitle(a>0?c.appendCountToTitle({title:this.logTitle_,count:a}):this.logTitle_)},k.prototype.setEncodings=function(a){this.currentEncodings_=a,this.packets_.forEach(function(b){b.setEncodings(a)})},k.prototype.setChunkSize=function(a){this.currentChunkSize_=a,this.packets_.forEach(function(b){b.setChunkSize(a)})};var l=function(a,b){this.packetBinary_=a,this.packetSpec_=b.packetSpec,this.encodings_=b.encodings,this.chunkSize_=b.chunkSize,this.isUnread=b.isUnread,this.isMinimized=!1,this.markAsReadCallback_=b.markAsReadCallback,this.rootDiv_=$("<div>").addClass("packet"),this.rootDiv_.click(this.markAsRead.bind(this)),this.render()};l.prototype.render=function(){var a=f({packetBinary:this.packetBinary_,packetSpec:this.packetSpec_,enabledEncodings:this.encodings_,chunkSize:this.chunkSize_,isMinimized:this.isMinimized}),b=$(a);k.adjustHeaderColumnWidths(b),h.hideRowsByEncoding(b,this.encodings_),this.rootDiv_.html(b),this.rootDiv_.find(".expander").click(this.toggleMinimized.bind(this)),this.rootDiv_.toggleClass("unread",this.isUnread)},l.prototype.getRoot=function(){return this.rootDiv_},k.adjustHeaderColumnWidths=function(a){var b=i.getLevelConfig(),c=new e.Encoder(b.addressFormat,b.packetCountBitWidth,b.clientInitialPacketHeader),d=c.getFieldBitWidth(e.HeaderType.TO_ADDRESS),f=c.getFieldBitWidth(e.HeaderType.PACKET_COUNT),g=12.5,h=g*d;a.find("td.toAddress, th.toAddress, td.fromAddress, th.fromAddress").css("width",h+"px");var j=.75,k=j*d;a.find("td.toAddress input, td.fromAddress input").css("width",k+"em");var l=2*g*f+21;a.find("td.packetInfo, th.packetInfo").css("width",l+"px");var m=j*f;a.find("td.packetInfo input").css("width",m+"em")},l.prototype.setEncodings=function(a){this.encodings_=a,this.render()},l.prototype.setChunkSize=function(a){this.chunkSize_=a,this.render()},l.prototype.markAsRead=function(){this.isUnread&&(this.isUnread=!1,this.render(),this.markAsReadCallback_())},l.prototype.toggleMinimized=function(){this.isMinimized=!this.isMinimized,this.render()},k.prototype.setHeight=function(a){var b=this.getRoot().find(".netsim-panel"),c=b.find("h1"),d=b.find(".panel-body"),e=parseFloat(b.css("margin-top"))+parseFloat(b.css("margin-bottom")),f=c.outerHeight(!0),g=parseFloat(d.css("border-top-width"))+parseFloat(d.css("border-bottom-width")),h=parseFloat(this.scrollArea_.css("margin-top"))+parseFloat(this.scrollArea_.css("margin-bottom")),i=a-(e+f+g+h);this.scrollArea_.height(Math.floor(i))},k.prototype.getHeight=function(){return this.getRoot().find(".netsim-panel").outerHeight(!0)},k.prototype.onMinimizerClick_=function(){k.superPrototype.onMinimizerClick_.call(this),i.updateLayout()}},{"../utils":292,"./NetSimEncodingControl":176,"./NetSimLogPacket.html.ejs":183,"./NetSimLogPanel.html.ejs":184,"./NetSimPanel":198,"./Packet":228,"./locale":232,"./netsimGlobals":236}],184:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div class="scroll-area">\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:302}],183:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(a){return enabledEncodings.some(function(b){return b===a})}function b(){var b=x.getBodyAsBinary();return a(k.ASCII)?u(b,chunkSize):a(k.DECIMAL)?p(t(b,chunkSize)):a(k.HEXADECIMAL)?o(s(b),chunkSize):a(k.BINARY)?n(b,chunkSize):a(k.A_AND_B)?m(q(b),chunkSize):b}function c(a,b,c,d,e){buf.push('\n      <tr class="',escape(a),'">\n        <th nowrap class="',escape(l.ENCODING_LABEL),'">',escape(h(a)),"</th>\n        "),z&&buf.push('\n          <td nowrap class="',escape(l.TO_ADDRESS),'">',escape(b),"</td>\n        "),buf.push("\n        "),A&&buf.push('\n          <td nowrap class="',escape(l.FROM_ADDRESS),'">',escape(c),"</td>\n        "),buf.push("\n        "),B&&buf.push('\n          <td nowrap class="',escape(l.PACKET_INFO),'">',escape(d),"</td>\n        "),buf.push('\n        <td class="',escape(l.MESSAGE),'">',escape(e),"</td>\n      </tr>\n  ")}buf.push("");var d=require("./netsimConstants"),e=require("./netsimGlobals"),f=require("./dataConverters"),g=require("./locale"),h=require("./netsimUtils").getEncodingLabel,i=require("./Packet"),j=e.getLevelConfig(),k=d.EncodingType,l=d.PacketUIColumnType,m=f.formatAB,n=f.formatBinary,o=f.formatHex,p=f.alignDecimal,q=f.binaryToAB,r=f.binaryToInt,s=f.binaryToHex,t=f.binaryToDecimal,u=f.binaryToAscii,v=function(a){return f.binaryToAddressString(a,j.addressFormat)},w=function(a){return f.formatBinaryForAddressHeader(a,j.addressFormat)},x=new i(packetSpec,packetBinary),y=packetSpec,z=y.indexOf(i.HeaderType.TO_ADDRESS)>-1,A=y.indexOf(i.HeaderType.FROM_ADDRESS)>-1,B=y.indexOf(i.HeaderType.PACKET_INDEX)>-1&&y.indexOf(i.HeaderType.PACKET_COUNT)>-1;buf.push("\n  ");var C=z?x.getHeaderAsBinary(i.HeaderType.TO_ADDRESS):"",D=A?x.getHeaderAsBinary(i.HeaderType.FROM_ADDRESS):"",E=B?x.getHeaderAsBinary(i.HeaderType.PACKET_INDEX):"",F=B?x.getHeaderAsBinary(i.HeaderType.PACKET_COUNT):"",G=x.getBodyAsBinary();buf.push("\n  "),isMinimized?buf.push('\n      <div class="minimized-packet single-line-with-ellipsis user-data">\n        <i class="fa fa-plus-square expander"></i>\n        ',escape(b()),"\n      </div>\n  "):(buf.push('\n    <table class="maximized-packet">\n      <thead>\n        <tr>\n          <th nowrap class="',escape(l.ENCODING_LABEL),'">\n            <i class="fa fa-minus-square expander"></i>\n          </th>\n          '),z&&buf.push('\n            <th nowrap class="',escape(l.TO_ADDRESS),'">',escape(g.to()),"</th>\n          "),buf.push("\n          "),A&&buf.push('\n            <th nowrap class="',escape(l.FROM_ADDRESS),'">',escape(g.from()),"</th>\n          "),buf.push("\n          "),B&&buf.push('\n            <th nowrap class="',escape(l.PACKET_INFO),'">',escape(g.packet()),"</th>\n          "),buf.push('\n          <th class="',escape(l.MESSAGE),'">\n            ',escape(g.message()),"\n          </th>\n        </tr>\n      </thead>\n      <tbody>\n      "),c(k.ASCII,v(C),v(D),g.xOfYPackets({x:r(E),y:r(F)}),u(G,chunkSize)),c(k.DECIMAL,v(C),v(D),g.xOfYPackets({x:r(E),y:r(F)}),p(t(G,chunkSize))),c(k.HEXADECIMAL,s(C),s(D),g.xOfYPackets({x:s(E),y:s(F)}),o(s(G),chunkSize)),c(k.BINARY,w(C,4),w(D,4),n(E+F,j.packetCountBitWidth),n(G,chunkSize)),c(k.A_AND_B,q(C),q(D),m(q(E+F),j.packetCountBitWidth),m(q(G),chunkSize)),buf.push("\n      </tbody>\n    </table>\n  ")),buf.push("\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./Packet":228,"./dataConverters":230,"./locale":232,"./netsimConstants":235,"./netsimGlobals":236,"./netsimUtils":238,ejs:302}],181:[function(a,b){"use strict";var c=a("../utils"),d=c.getLodash(),e=a("./NetSimClientNode"),f=a("./NetSimEntity"),g=a("./NetSimMessage"),h=a("./NetSimHeartbeat"),i=a("./NetSimLogger"),j=a("../ObservableEvent"),k=a("./netsimConstants").MessageGranularity,l=i.getSingleton(),m=a("./netsimGlobals"),n=b.exports=function(a,b){e.call(this,a,b),this.myWire=null,this.myRemoteClient=null,this.myRouter=null,this.sentLog_=null,this.receivedLog_=null,this.heartbeat=null,this.remoteChange=new j,this.onNodeLostConnection_=void 0,this.eventKeys={}};n.inherits(e),n.create=function(a,b,c){var d=new n(a);d.displayName_=b,d.getTable().create(d.buildRow(),function(b,d){return b?void c(b,null):void h.getOrCreate(a,d.id,function(b,e){if(b)return void c(b,null);var f=new n(a,d);f.heartbeat=e,f.heartbeat.setFailureCallback(f.onFailedHeartbeat.bind(f)),c(null,f)})})},n.prototype.setDisplayName=function(a){this.displayName_=a},n.prototype.initializeSimulation=function(a,b){this.sentLog_=a,this.receivedLog_=b,this.eventKeys.wireTable=this.shard_.wireTable.tableChange.register(this.onWireTableChange_.bind(this)),this.eventKeys.messageTable=this.shard_.messageTable.tableChange.register(this.onMessageTableChange_.bind(this)),this.eventKeys.registeredOnShard=this.shard_},n.prototype.stopSimulation=function(){this.eventKeys.registeredOnShard&&(this.eventKeys.registeredOnShard.wireTable.tableChange.unregister(this.eventKeys.wireTable),this.eventKeys.registeredOnShard.messageTable.tableChange.unregister(this.eventKeys.messageTable),this.eventKeys.registeredOnShard=null)},n.prototype.tick=function(a){this.heartbeat.tick(a),this.myRouter&&this.myRouter.tick(a)},n.prototype.onFailedHeartbeat=function(){l.error("Heartbeat failed."),void 0!==this.onNodeLostConnection_&&this.onNodeLostConnection_()},n.prototype.setLostConnectionCallback=function(a){if(void 0!==this.onNodeLostConnection_&&void 0!==a)throw new Error("Node already has a lost connection callback.");this.onNodeLostConnection_=a},n.prototype.update=function(a){a=a||function(){};var b=this;n.superPrototype.update.call(this,function(c,d){c&&(l.error("Local node update failed: "+c.message),void 0!==b.onNodeLostConnection_&&b.onNodeLostConnection_()),a(c,d)
})},n.prototype.connectToNode=function(a,b){n.superPrototype.connectToNode.call(this,a,function(a,c){a?b(a,null):(this.myWire=c,b(a,c))}.bind(this))},n.prototype.connectToClient=function(a,b){this.connectToNode(a,function(a,c){this.shard_.wireTable.readAll(function(a,d){return a?void b(a,c):(this.onWireTableChange_(d),void b(a,c))}.bind(this))}.bind(this))},n.prototype.connectToRouter=function(a,b){b=b||function(){},this.connectToNode(a,function(c,d){return c?void b(c):(this.myRouter=a,this.myRouter.initializeSimulation(this.entityID),void a.requestAddress(d,this.getHostname(),function(a){return a?void this.disconnectRemote(b):(this.remoteChange.notifyObservers(this.myWire,this.myRouter),void b(null))}.bind(this)))}.bind(this))},n.prototype.synchronousDestroy=function(){(this.myRemoteClient||this.myRouter)&&this.synchronousDisconnectRemote(),this.shard_.messageTable.readAllCached().forEach(function(a){if(a.simulatedBy===this.entityID){var b=new g(this.shard_,a);b.synchronousDestroy()}},this),this.heartbeat.synchronousDestroy(),this.heartbeat=null,n.superPrototype.synchronousDestroy.call(this)},n.prototype.destroy=function(a){if(this.myRemoteClient||this.myRouter)return void this.disconnectRemote(function(b){return b?void a(b):void this.destroy(a)}.bind(this));var b=this.shard_.messageTable.readAllCached().filter(function(a){return a.simulatedBy===this.entityID},this).map(function(a){return new g(this.shard_,a)},this);return b.length>0?void f.destroyEntities(b,function(b){return b?void a(b):void this.destroy(a)}.bind(this)):void this.heartbeat.destroy(function(b){return b?void a(b):void n.superPrototype.destroy.call(this,a)})},n.prototype.synchronousDisconnectRemote=function(){this.myWire&&(this.myWire.synchronousDestroy(),this.myWire=null),this.myRouter&&this.myRouter.stopSimulation(),this.myRemoteClient=null,this.myRouter=null,this.remoteChange.notifyObservers(null,null)},n.prototype.disconnectRemote=function(a){a=a||function(){},this.myWire.destroy(function(b){b&&l.info("Error while disconnecting: "+b.message),this.myRouter&&this.myRouter.stopSimulation(),this.myWire=null,this.myRemoteClient=null,this.myRouter=null,this.remoteChange.notifyObservers(null,null),a(null)}.bind(this))},n.prototype.sendMessage=function(a,b){if(!this.myWire)return void b(new Error("Cannot send message; not connected."));var c=this.myWire.localNodeID,d=this.myWire.remoteNodeID,e=this.selectSimulatingNode_(c,d),f=this;g.send(this.shard_,c,d,e,a,function(c){return c?(l.error("Failed to send message: "+c.message+"\n"+JSON.stringify(a)),void b(c)):(l.info("Local node sent message"),f.sentLog_&&f.sentLog_.log(a),void b(null))})},n.prototype.selectSimulatingNode_=function(a,b){return m.getLevelConfig().messageGranularity===k.BITS?a:this.myRouter&&this.myRouter.entityID===b?a:b},n.prototype.sendMessages=function(a,b){return 0===a.length?void b(null):void this.sendMessage(a[0],function(c,d){return c?void b(c,d):void this.sendMessages(a.slice(1),b)}.bind(this))},n.prototype.onWireTableChange_=function(a){if(this.myWire){var b=d.find(a,function(a){return a.remoteNodeID===this.myWire.localNodeID&&a.localNodeID===this.myWire.remoteNodeID}.bind(this));b&&!this.myRemoteClient?e.get(b.localNodeID,this.shard_,function(a,b){this.myRemoteClient=b,this.remoteChange.notifyObservers(this.myWire,this.myRemoteClient)}.bind(this)):!b&&this.myRemoteClient&&(this.myRemoteClient=null,this.remoteChange.notifyObservers(this.myWire,this.myRemoteClient))}},n.prototype.onMessageTableChange_=function(a){if(m.getLevelConfig().automaticReceive&&!this.isProcessingMessages_){var b=a.map(function(a){return new g(this.shard_,a)}.bind(this)).filter(function(a){return a.toNodeID===this.entityID&&a.simulatedBy===this.entityID}.bind(this));0!==b.length&&(l.info("Local node received "+b.length+" messages"),this.isProcessingMessages_=!0,f.destroyEntities(b,function(a){return a?(l.error("Error pulling message off the wire: "+a.message),void(this.isProcessingMessages_=!1)):(b.forEach(function(a){this.handleMessage_(a)},this),l.info("Local node finished processing "+b.length+" messages"),void(this.isProcessingMessages_=!1))}.bind(this)))}},n.prototype.handleMessage_=function(a){this.receivedLog_&&this.receivedLog_.log(a.payload)},n.prototype.getLatestMessageOnSimplexWire=function(a){return this.myWire?void this.shard_.messageTable.readAll(function(b,c){if(b)return void a(b);var d=c.filter(function(a){return this.myWire.isMessageRowOnSimplexWire(a)}.bind(this));if(0===d.length)return void a(null,null);var e=d[d.length-1];a(null,new g(this.shard_,e))}.bind(this)):void a(new Error("Unable to retrieve message; not connected."))},n.prototype.setSimplexWireState=function(a,b){this.sendMessage(a,function(a){return a?(l.warn(a.message),void b(new Error("Failed to set wire state."))):void this.removeMyOldMessagesFromWire_(b)}.bind(this))},n.prototype.removeMyOldMessagesFromWire_=function(a){return this.myWire?void this.shard_.messageTable.readAll(function(b,c){if(b)return void a(b);var d=c.filter(function(a){return this.myWire.isMessageRowOnSimplexWire(a)},this),e=d.slice(0,-1),h=e.filter(function(a){return a.simulatedBy===this.entityID},this),i=h.map(function(a){return new g(this.shard_,a)},this);f.destroyEntities(i,a)}.bind(this)):void a(new Error("Unable to retrieve message; not connected."))}},{"../ObservableEvent":1,"../utils":292,"./NetSimClientNode":166,"./NetSimEntity":177,"./NetSimHeartbeat":179,"./NetSimLogger":186,"./NetSimMessage":188,"./netsimConstants":235,"./netsimGlobals":236}],180:[function(a,b){"use strict";var c=a("../utils"),d=c.getLodash(),e=a("./locale"),f=a("./netsimNodeFactory"),g=a("./NetSimClientNode"),h=a("./NetSimRouterNode"),i=a("./NetSimShardSelectionPanel"),j=a("./NetSimRemoteNodeSelectionPanel"),k=a("./NetSimLogger").getSingleton(),l=a("./netsimGlobals"),m=b.exports=function(a,b,c){this.rootDiv_=a,this.netsim_=b,this.levelKey_=c.levelKey,this.shardSelectionPanel_=null,this.nodeSelectionPanel_=null,this.shard_=null,this.myNode_=null,this.eventKeys={},this.displayName_=c.user.isSignedIn?c.user.name:"",this.shardChoices_=[],this.selectedShardID_=void 0,this.nodesOnShard_=[],this.incomingConnectionNodes_=[],this.remoteNode_=null,c.user.isSignedIn?this.getUserSections_(function(a){this.buildShardChoiceList_(a,c.sharedShardSeed),this.render()}.bind(this)):this.buildShardChoiceList_([],c.sharedShardSeed),this.render(),this.netsim_.shardChange.register(this.onShardChange_.bind(this))};m.prototype.render=function(){var a=null!==this.shard_;a?this.nodeSelectionPanel_=new j(this.rootDiv_,{nodesOnShard:this.nodesOnShard_,incomingConnectionNodes:this.incomingConnectionNodes_,remoteNode:this.remoteNode_,myNodeID:this.myNode_.entityID},{addRouterCallback:this.addRouterToLobby.bind(this),cancelButtonCallback:this.onCancelButtonClick_.bind(this),joinButtonCallback:this.onJoinButtonClick_.bind(this)}):this.shardSelectionPanel_=new i(this.rootDiv_,{displayName:this.displayName_,shardChoices:this.shardChoices_,selectedShardID:this.selectedShardID_},{setNameCallback:this.setDisplayName.bind(this),setShardCallback:this.setShardID.bind(this)})},m.prototype.setDisplayName=function(a){this.displayName_=a,this.render(),this.selectedShardID_&&this.displayName_&&!this.netsim_.isConnectedToShardID(this.selectedShardID_)&&this.netsim_.connectToShard(this.selectedShardID_,this.displayName_)},m.prototype.setShardID=function(a){this.selectedShardID_=a,this.render(),this.selectedShardID_&&this.displayName_&&!this.netsim_.isConnectedToShardID(this.selectedShardID_)&&this.netsim_.connectToShard(this.selectedShardID_,this.displayName_)},m.prototype.onShardChange_=function(a,b){this.eventKeys.registeredShard&&(this.eventKeys.registeredShard.nodeTable.tableChange.unregister(this.eventKeys.nodeTable),this.eventKeys.registeredShard.wireTable.tableChange.unregister(this.eventKeys.wireTable),this.registeredShard=void 0),this.shard_=a,this.myNode_=b,this.shard_?(this.eventKeys.nodeTable=this.shard_.nodeTable.tableChange.register(this.onNodeTableChange_.bind(this)),this.eventKeys.wireTable=this.shard_.wireTable.tableChange.register(this.onWireTableChange_.bind(this)),this.eventKeys.registeredShard=this.shard_,this.fetchInitialLobbyData_()):(this.selectedShardID_=void 0,this.nodesOnShard_.length=0,this.incomingConnectionNodes_.length=0,this.render(),1===this.shardChoices_.length&&this.setShardID(this.shardChoices_[0].shardID))},m.prototype.fetchInitialLobbyData_=function(){this.shard_.nodeTable.readAll(function(a,b){return a?void k.warn("Node table read failed: "+a.message):(this.onNodeTableChange_(b),void this.shard_.wireTable.readAll(function(a,b){return a?void k.warn("Wire table read failed: "+a.message):(this.onWireTableChange_(b),void(l.getLevelConfig().canConnectToRouters&&!this.doesShardContainRouter()&&this.addRouterToLobby()))}.bind(this)))}.bind(this))},m.prototype.doesShardContainRouter=function(){return void 0!==d.find(this.nodesOnShard_,function(a){return a instanceof h})},m.prototype.addRouterToLobby=function(){h.create(this.shard_,function(a){a&&k.error("Unable to create router: "+a.message)}.bind(this))},m.prototype.onJoinButtonClick_=function(a){a instanceof h?this.netsim_.connectToRouter(a.entityID):a instanceof g&&this.myNode_.connectToClient(a,function(){})},m.prototype.onCancelButtonClick_=function(){this.netsim_.disconnectFromRemote()},m.prototype.onNodeTableChange_=function(a){this.nodesOnShard_=f.nodesFromRows(this.shard_,a),this.render()},m.prototype.onWireTableChange_=function(a){this.incomingConnectionNodes_=a.filter(function(a){return a.remoteNodeID===this.myNode_.entityID},this).map(function(a){return d.find(this.nodesOnShard_,function(b){return b.entityID===a.localNodeID})},this).filter(function(a){return void 0!==a});var b=d.find(a,function(a){return a.localNodeID===this.myNode_.entityID}.bind(this));this.remoteNode_=b?d.find(this.nodesOnShard_,function(a){return a.entityID===b.remoteNodeID}):null,this.render()},m.prototype.getUserSections_=function(a){var b=$.ajax({dataType:"json",url:"/v2/sections/membership"}),c=$.ajax({dataType:"json",url:"/v2/sections"});$.when(b,c).done(function(b,c){var d=b[0],e=c[0];a(d.concat(e))})},m.prototype.buildShardChoiceList_=function(a,b){if(this.shardChoices_.length=0,b){var d=this.makeShardIDFromSeed_(b);this.shardChoices_.push({shardSeed:b,shardID:d,displayName:b})}if(this.shardChoices_=this.shardChoices_.concat(a.map(function(a){return{shardSeed:a.id,shardID:this.makeShardIDFromSeed_(a.id),displayName:a.name}}.bind(this))),0===this.shardChoices_.length){var f=c.createUuid(),g=this.makeShardIDFromSeed_(f);this.shardChoices_.push({shardSeed:f,shardID:g,displayName:e.myPrivateNetwork()})}1!==this.shardChoices_.length||this.selectedShardID_||this.setShardID(this.shardChoices_[0].shardID)},m.prototype.makeShardIDFromSeed_=function(a){return("ns_"+this.levelKey_+"_"+a).substr(0,48)},m.prototype.getShareLink=function(){if(!this.displayName_)return"";var a=d.find(this.shardChoices_,function(a){return a.shardID===this.selectedShardID_}.bind(this));if(a){var b=document.location.protocol+"//"+document.location.host+document.location.pathname;return b+"?s="+a.shardSeed}return""}},{"../utils":292,"./NetSimClientNode":166,"./NetSimLogger":186,"./NetSimRemoteNodeSelectionPanel":201,"./NetSimRouterNode":204,"./NetSimShardSelectionPanel":214,"./locale":232,"./netsimGlobals":236,"./netsimNodeFactory":237}],237:[function(a,b){"use strict";var c=a("./netsimConstants"),d=a("./NetSimClientNode"),e=a("./NetSimRouterNode"),f=c.NodeType,g=b.exports;g.nodesFromRows=function(a,b){return b.map(g.nodeFromRow.bind(this,a))},g.nodeFromRow=function(a,b){if(b.type===f.CLIENT)return new d(a,b);if(b.type===f.ROUTER)return new e(a,b);throw new Error("Unable to map row to node.")}},{"./NetSimClientNode":166,"./NetSimRouterNode":204,"./netsimConstants":235}],214:[function(a,b){"use strict";var c=a("../utils"),d=a("./locale"),e=a("./NetSimShardSelectionPanel.html.ejs"),f=a("./NetSimPanel"),g=a("../constants").KeyCodes,h="",i=b.exports=function(a,b,e){this.displayName_=b.displayName,this.shardChoices_=c.valueOr(b.shardChoices,[]),this.selectedShardID_=c.valueOr(b.selectedShardID,h),this.setNameCallback_=e.setNameCallback,this.setShardCallback_=e.setShardCallback,f.call(this,a,{className:"netsim-shard-selection-panel",panelTitle:d.pickASection(),canMinimize:!1})};i.inherits(f),i.prototype.render=function(){i.superPrototype.render.call(this);var a=$(e({displayName:this.displayName_,selectedShardID:this.selectedShardID_,shardChoices:this.shardChoices_,SELECTOR_NONE_VALUE:h}));this.getBody().html(a);var b=this.getBody().find("#netsim-lobby-name");b.keyup(this.onNameKeyUp_.bind(this));var c=this.getBody().find("#netsim-lobby-set-name-button");c.click(this.setNameButtonClick_.bind(this));var d=this.getBody().find("#netsim-shard-select");d.change(this.onShardSelectChange_.bind(this)),d.keyup(this.onShardSelectKeyUp_.bind(this));var f=this.getBody().find("#netsim-shard-confirm-button");f.click(this.setShardButtonClick_.bind(this)),0===this.displayName_.length?b.focus():this.selectedShardID_===h&&d.focus()},i.prototype.onNameKeyUp_=function(a){var b=a.target.value,c=this.getBody().find("#netsim-lobby-set-name-button");c.attr("disabled",0===b.length),b.length>0&&a.which===g.ENTER&&this.setNameButtonClick_()},i.prototype.setNameButtonClick_=function(){this.setNameCallback_(this.getBody().find("#netsim-lobby-name").val())},i.prototype.onShardSelectChange_=function(a){var b=a.target.value,c=this.getBody().find("#netsim-shard-confirm-button");c.attr("disabled",!b||b===h)},i.prototype.onShardSelectKeyUp_=function(a){var b=a.target.value;b&&b!==h&&a.which===g.ENTER&&this.setShardButtonClick_()},i.prototype.setShardButtonClick_=function(){this.setShardCallback_(this.getBody().find("#netsim-shard-select").val())}},{"../constants":86,"../utils":292,"./NetSimPanel":198,"./NetSimShardSelectionPanel.html.ejs":213,"./locale":232}],213:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("./locale");if(buf.push('\n<div class="content-wrap">\n  <div class="field-box display-name-control">\n    <label for="netsim-lobby-name">',escape(a.myName()),'</label>\n    <input id="netsim-lobby-name" type="text" value="',escape(displayName),'" '),displayName.length>0&&buf.push("disabled"),buf.push(" />\n    "),0===displayName.length&&buf.push('\n      <input id="netsim-lobby-set-name-button" type="button" value="',escape(a.setName()),'" disabled />\n    '),buf.push("\n  </div>\n  "),displayName.length>0){buf.push('\n    <div class="field-box shard-control">\n      <label for="netsim-shard-select">',escape(a.mySection()),'</label>\n      <select id="netsim-shard-select" '),selectedShardID&&buf.push("disabled"),buf.push('>\n        <option value="',escape(SELECTOR_NONE_VALUE),'">',escape(a.dropdownPickOne()),"</option>\n        ");var b=!1;shardChoices.forEach(function(a){var c="";a.shardID===selectedShardID&&(c="selected",b=!0),buf.push('\n              <option value="',escape(a.shardID),'" ',escape(c),">",escape(a.displayName),"</option>\n            ")}),buf.push("\n      </select>\n      "),selectedShardID||(buf.push('\n        <input id="netsim-shard-confirm-button" type="button" value="',escape(a.joinSection()),'" '),b||buf.push("disabled"),buf.push(" />\n      ")),buf.push("\n    </div>\n  ")}buf.push('\n  <div class="clearfix"></div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./locale":232,ejs:302}],204:[function(a,b){"use strict";var c=a("../utils"),d=a("./locale"),e=a("./netsimConstants"),f=a("./netsimUtils"),g=a("./NetSimNode"),h=a("./NetSimEntity"),i=a("./NetSimLogEntry"),j=a("./NetSimLogger"),k=a("./NetSimWire"),l=a("./NetSimMessage"),m=a("./NetSimHeartbeat"),n=a("../ObservableEvent"),o=a("./Packet"),p=a("./dataConverters"),q=c.getLodash(),r=f.serializeNumber,s=f.deserializeNumber,t=p.asciiToBinary,u=e.DnsMode,v=e.NodeType,w=e.BITS_PER_BYTE,x=j.getSingleton(),y=a("./netsimGlobals"),z=6,A=0,B=15,C="dns",D="NOT_FOUND",E=6e5,F=b.exports=function(a,b){b=void 0!==b?b:{},g.call(this,a,b);var d=y.getLevelConfig();this.creationTime=c.valueOr(b.creationTime,Date.now()),this.dnsMode=c.valueOr(b.dnsMode,d.defaultDnsMode),this.dnsNodeID=b.dnsNodeID,this.bandwidth=c.valueOr(s(b.bandwidth),d.defaultRouterBandwidth),this.memory=c.valueOr(s(b.memory),d.defaultRouterMemory),this.simulateForSender_=void 0,this.simulationTime_=0,this.packetSpec_=[],this.heartbeat=null,this.stateCache_={},this.stateChange=new n,this.statsChange=new n,this.myWireRowCache_=[],this.wiresChange=new n,this.myLogRowCache_=[],this.logChange=new n,this.isRouterProcessing_=!1,this.routerQueueCache_=[],this.localRoutingSchedule_=[],this.isAutoDnsProcessing_=!1,this.autoDnsQueue_=[]};F.inherits(g),F.create=function(a,b){h.create(F,a,function(c,d){return c?void b(c,null):void m.getOrCreate(a,d.entityID,function(a,c){return a?void b(a,null):(d.heartbeat=c,d.heartbeat.setBeatInterval(12e3),void d.update(function(a){b(a,d)}))})})},F.get=function(a,b,c){h.get(F,a,b,function(d,e){return d?void c(d,null):void m.getOrCreate(b,a,function(a,b){return a?void c(a,null):(e.heartbeat=b,e.heartbeat.setBeatInterval(12e3),void c(null,e))})})},F.prototype.buildRow=function(){return c.extend(F.superPrototype.buildRow.call(this),{creationTime:this.creationTime,bandwidth:r(this.bandwidth),memory:r(this.memory),dnsMode:this.dnsMode,dnsNodeID:this.dnsNodeID})},F.prototype.onMyStateChange_=function(a){this.creationTime=a.creationTime,this.bandwidth=s(a.bandwidth),this.memory=s(a.memory),this.dnsMode=a.dnsMode,this.dnsNodeID=a.dnsNodeID,this.stateChange.notifyObservers(this)},F.prototype.tick=function(a){this.simulationTime_=a.time,this.heartbeat.tick(a),this.routeOverdueMessages_(a),this.dnsMode===u.AUTOMATIC&&this.tickAutoDns_(a)},F.prototype.routeOverdueMessages_=function(a){if(!this.isRouterProcessing_){var b=[],c=[];if(this.localRoutingSchedule_.forEach(function(d){a.time>=d.completionTime?(d.beingRouted=!0,b.push(d)):a.time>=d.expirationTime&&(d.beingRouted=!0,c.push(d))}),b.length+c.length!==0){var d=c.map(function(a){return new l(this.shard_,a.row)}.bind(this)),e=b.map(function(a){return new l(this.shard_,a.row)}.bind(this));this.isRouterProcessing_=!0,h.destroyEntities(d,function(){this.routeMessages_(e,function(){this.localRoutingSchedule_=this.localRoutingSchedule_.filter(function(a){return!a.beingRouted}),this.isRouterProcessing_=!1}.bind(this))}.bind(this))}}},F.prototype.recalculateSchedule=function(){for(var a,b=0,c=this.simulationTime_,d=0;d<this.routerQueueCache_.length;d++)a=this.routerQueueCache_[d],b+=a.payload.length,c+=this.calculateProcessingDurationForMessage_(a),this.localSimulationOwnsMessageRow_(a)&&b<=this.memory&&this.scheduleRoutingForRow(a,c)},F.prototype.scheduleRoutingForRow=function(a,b){var c=q.find(this.localRoutingSchedule_,function(b){return b.row.id===a.id});c?b<c.completionTime&&(c.completionTime=b):this.addRowToSchedule_(a,b)},F.prototype.addRowToSchedule_=function(a,b){this.localRoutingSchedule_.push({row:a,completionTime:b,expirationTime:this.simulationTime_+E,beingRouted:!1})},F.prototype.removeRowFromSchedule_=function(a){for(var b,c=0;c<this.localRoutingSchedule_.length;c++)this.localRoutingSchedule_[c].row.id===a.id&&(b=c);void 0!==b&&this.localRoutingSchedule_.splice(b,1)},F.prototype.tickAutoDns_=function(){if(!this.isAutoDnsProcessing_){var a=this.autoDnsQueue_.filter(this.localSimulationOwnsMessageRow_.bind(this)).map(function(a){return new l(this.shard_,a)}.bind(this));0!==a.length&&(this.isAutoDnsProcessing_=!0,this.processAutoDnsRequests_(a,function(){this.isAutoDnsProcessing_=!1}.bind(this)))}},F.prototype.getDisplayName=function(){return y.getLevelConfig().broadcastMode?d.roomNumberX({x:this.entityID}):d.routerNumberX({x:this.entityID})},F.prototype.getAddress=function(){return this.makeLocalNetworkAddress_(A)},F.prototype.getAutoDnsAddress=function(){return this.makeLocalNetworkAddress_(B)},F.prototype.getHostname=function(){return this.getDisplayName().replace(/[^\w\d]/g,"").toLowerCase()},F.prototype.getNodeType=function(){return v.ROUTER},F.prototype.getStatus=function(){var a=y.getLevelConfig(),b=this.shard_.wireTable.readAllCached(),c=b.filter(function(a){return a.remoteNodeID===this.entityID},this);if(0===c.length)return a.broadcastMode?d.roomStatusNoConnections({maximumClients:z}):d.routerStatusNoConnections({maximumClients:z});var e=this.shard_.nodeTable.readAllCached(),f=c.map(function(a){var b=q.find(e,function(b){return b.id===a.localNodeID});return b?b.name:d.unknownNode()}).join(", ");return c.length>=z?a.broadcastMode?d.roomStatusFull({connectedClients:f}):d.routerStatusFull({connectedClients:f}):a.broadcastMode?d.roomStatus({connectedClients:f,remainingSpace:z-c.length}):d.routerStatus({connectedClients:f,remainingSpace:z-c.length})},F.prototype.isFull=function(){var a=this.shard_.wireTable.readAllCached(),b=a.filter(function(a){return a.remoteNodeID===this.entityID},this);return b.length>=z},F.prototype.validatePacketSpec_=function(a){a.some(function(a){return a===o.HeaderType.TO_ADDRESS})||x.error("Packet specification does not have a toAddress field."),a.some(function(a){return a===o.HeaderType.FROM_ADDRESS})||x.error("Packet specification does not have a fromAddress field.")},F.prototype.initializeSimulation=function(a){if(this.simulateForSender_=a,this.packetSpec_=y.getLevelConfig().routerExpectsPacketHeader,this.validatePacketSpec_(this.packetSpec_),void 0!==a){var b=this.shard_.nodeTable.tableChange,c=this.onNodeTableChange_.bind(this);this.nodeChangeKey_=b.register(c),x.info("Router registered for nodeTable tableChange");var d=this.shard_.wireTable.tableChange,e=this.onWireTableChange_.bind(this);this.wireChangeKey_=d.register(e),x.info("Router registered for wireTable tableChange");var f=this.shard_.logTable.tableChange,g=this.onLogTableChange_.bind(this);this.logChangeKey_=f.register(g),x.info("Router registered for logTable tableChange");var h=this.shard_.messageTable.tableChange,i=this.onMessageTableChange_.bind(this);this.newMessageEventKey_=h.register(i),x.info("Router registered for messageTable tableChange"),this.shard_.logTable.readAll(function(a,b){return a?void x.warn("Failed to read from log table: "+a.message):void this.onLogTableChange_(b)}.bind(this))}},F.prototype.stopSimulation=function(){if(void 0!==this.nodeChangeKey_){var a=this.shard_.messageTable.tableChange;a.unregister(this.nodeChangeKey_),this.nodeChangeKey_=void 0,x.info("Router unregistered from nodeTable tableChange")}if(void 0!==this.wireChangeKey_){var b=this.shard_.messageTable.tableChange;b.unregister(this.wireChangeKey_),this.wireChangeKey_=void 0,x.info("Router unregistered from wireTable tableChange")}if(void 0!==this.logChangeKey_){var c=this.shard_.messageTable.tableChange;c.unregister(this.logChangeKey_),this.logChangeKey_=void 0,x.info("Router unregistered from logTable tableChange")}if(void 0!==this.newMessageEventKey_){var d=this.shard_.messageTable.tableChange;d.unregister(this.newMessageEventKey_),this.newMessageEventKey_=void 0,x.info("Router unregistered from messageTable tableChange")}},F.prototype.setDnsMode=function(a){this.dnsMode!==a&&(this.dnsMode===u.NONE?this.dnsNodeID=void 0:this.dnsMode===u.AUTOMATIC&&(this.dnsNodeID=B),this.dnsMode=a,this.update())},F.prototype.setBandwidth=function(a){this.bandwidth!==a&&(this.bandwidth=a,this.recalculateSchedule(),this.update())},F.prototype.setMemory=function(a){this.memory!==a&&(this.memory=a,this.enforceMemoryLimit_(),this.update())},F.prototype.getConnections=function(a){a=a||function(){};var b=this.shard_,c=this.entityID;this.shard_.wireTable.readAll(function(d,e){if(d)return void a(d,[]);var f=e.map(function(a){return new k(b,a)}).filter(function(a){return a.remoteNodeID===c});a(null,f)})},F.prototype.countConnections=function(a){a=a||function(){},this.getConnections(function(b,c){a(b,c.length)})},F.prototype.log=function(a,b){i.create(this.shard_,this.entityID,a,b,function(){})};var G=function(a,b){return a.some(function(a){return a===b})};F.prototype.acceptConnection=function(a,b){var c=this;this.countConnections(function(a,d){return a?void b(a,!1):d>z?void b(new Error("Too many connections"),!1):void c.update(function(a){b(a,null===a)})})},F.prototype.requestAddress=function(a,b,c){c=c||function(){};var d=this;this.getConnections(function(e,f){if(e)return void c(e);for(var g=f.filter(function(a){return void 0!==a.localAddress}).map(function(a){return a.localAddress}),h=1,i=this.makeLocalNetworkAddress_(h);G(g,i);)h++,i=this.makeLocalNetworkAddress_(h);a.localAddress=i,a.localHostname=b,a.remoteAddress=d.getAddress(),a.remoteHostname=d.getHostname(),a.update(c)}.bind(this))},F.prototype.makeLocalNetworkAddress_=function(a){var b=y.getLevelConfig().addressFormat,c=!1,d=!1;return b.split(/(\D+)/).reverse().map(function(b){var e=parseInt(b,10);return isNaN(e)?b:c?d?"0":(d=!0,this.entityID.toString()):(c=!0,a.toString())}.bind(this)).reverse().join("")},F.prototype.getAddressTable=function(){var a=this.myWireRowCache_.map(function(a){return{hostname:a.localHostname,address:a.localAddress,isLocal:a.localNodeID===this.simulateForSender_,isDnsNode:a.localNodeID===this.dnsNodeID}}.bind(this));return this.dnsMode===u.AUTOMATIC&&a.push({hostname:C,address:this.getAutoDnsAddress(),isLocal:!1,isDnsNode:!0}),a},F.prototype.getAddressForNodeID_=function(a){var b=q.find(this.myWireRowCache_,function(b){return b.localNodeID===a});return void 0!==b?b.localAddress:void 0},F.prototype.getAddressForHostname_=function(a){if(a===this.getHostname())return this.getAddress();if(this.dnsMode===u.AUTOMATIC&&a===C)return this.getAutoDnsAddress();var b=q.find(this.myWireRowCache_,function(b){return b.localHostname===a});return void 0!==b?b.localAddress:void 0},F.prototype.getNodeIDForAddress_=function(a){if(a===this.getAddress())return this.entityID;if(this.dnsMode===u.AUTOMATIC&&a===this.getAutoDnsAddress())return this.entityID;var b=q.find(this.myWireRowCache_,function(b){return b.localAddress===a});return void 0!==b?b.localNodeID:void 0},F.prototype.onNodeTableChange_=function(a){var b=q.find(a,function(a){return a.id===this.entityID}.bind(this));if(void 0===b)throw new Error("Unable to find router node in node table listing.");q.isEqual(this.stateCache_,b)||(this.stateCache_=b,this.onMyStateChange_(b))},F.prototype.onWireTableChange_=function(a){var b=a.filter(function(a){return a.remoteNodeID===this.entityID}.bind(this));q.isEqual(this.myWireRowCache_,b)||(this.myWireRowCache_=b,this.wiresChange.notifyObservers())},F.prototype.onLogTableChange_=function(a){var b=a.filter(function(a){return a.nodeID===this.entityID}.bind(this));q.isEqual(this.myLogRowCache_,b)||(this.myLogRowCache_=b,this.logChange.notifyObservers())},F.prototype.getLog=function(){return this.myLogRowCache_.map(function(a){return new i(this.shard_,a,this.packetSpec_)}.bind(this))},F.prototype.getQueuedPacketCount=function(){return this.routerQueueCache_.length},F.prototype.getMemoryInUse=function(){return this.routerQueueCache_.reduce(function(a,b){return a+b.payload.length},0)},F.prototype.getCurrentDataRate=function(){return Math.min(this.getMemoryInUse(),this.bandwidth)},F.prototype.onMessageTableChange_=function(a){if(!this.simulateForSender_)throw new Error("Non-simulating router got message table change notifiction");this.updateRouterQueue_(a),this.dnsMode===u.AUTOMATIC&&this.updateAutoDnsQueue_(a)},F.prototype.updateRouterQueue_=function(a){var b=a.filter(this.isMessageToRouter_.bind(this));q.isEqual(this.routerQueueCache_,b)||(this.routerQueueCache_=b,this.recalculateSchedule(),this.enforceMemoryLimit_(),this.statsChange.notifyObservers(this))},F.prototype.enforceMemoryLimit_=function(){var a=this.findFirstLocallySimulatedPacketOverMemoryLimit();if(a){this.removeRowFromSchedule_(a);var b=new l(this.shard_,a);b.destroy(function(a){a||this.log(b.payload,i.LogStatus.DROPPED)}.bind(this))}},F.prototype.findFirstLocallySimulatedPacketOverMemoryLimit=function(){for(var a,b=0,c=0;c<this.routerQueueCache_.length;c++)if(a=this.routerQueueCache_[c],b+=a.payload.length,b>this.memory&&this.localSimulationOwnsMessageRow_(a))return a;return null},F.prototype.isMessageToRouter_=function(a){return this.dnsMode===u.AUTOMATIC&&this.isMessageToAutoDns_(a)?!1:a.toNodeID===this.entityID},F.prototype.routeMessages_=function(a,b){return 0===a.length?void b(null):void this.routeMessage_(a[0],function(c,d){return c?void b(c,d):void this.routeMessages_(a.slice(1),b)}.bind(this))},F.prototype.routeMessage_=function(a,b){a.destroy(function(c,d){if(c)return void b(c,d);var e=y.getLevelConfig();e.broadcastMode?(x.info("Forwarding to all"),this.forwardMessageToAll_(a,b)):this.forwardMessageToRecipient_(a,b)}.bind(this))},F.prototype.forwardMessageToAll_=function(a,b){var c=this.myWireRowCache_.map(function(a){return a.localNodeID});this.forwardMessageToNodeIDs_(a,c,function(c,d){c?this.log(a.payload,i.LogStatus.DROPPED):this.log(a.payload,i.LogStatus.SUCCESS),b(c,d)}.bind(this))},F.prototype.forwardMessageToNodeIDs_=function(a,b,c){if(0===b.length)return void c(null);var d=b[0];l.send(this.shard_,this.entityID,d,d,a.payload,function(d){return d?void c(d):void this.forwardMessageToNodeIDs_(a,b.slice(1),c)}.bind(this))},F.prototype.forwardMessageToRecipient_=function(a,b){var c,d=this.entityID;try{var e=new o(this.packetSpec_,a.payload);c=e.getHeaderAsAddressString(o.HeaderType.TO_ADDRESS)}catch(f){return x.warn("Packet not readable by router"),this.log(a.payload,i.LogStatus.DROPPED),void b(null)}if(c===this.getAddress())return x.warn("Packet stopped at router."),this.log(a.payload,i.LogStatus.SUCCESS),void b(null);var g=this.getNodeIDForAddress_(c);if(void 0===g)return x.warn("Destination address not in local network"),this.log(a.payload,i.LogStatus.SUCCESS),void b(null);var h=g;g===this.entityID&&(h=a.simulatedBy),l.send(this.shard_,d,g,h,a.payload,function(c,d){this.log(a.payload,i.LogStatus.SUCCESS),b(c,d)}.bind(this))},F.prototype.localSimulationOwnsMessageRow_=function(a){return this.simulateForSender_&&a.simulatedBy===this.simulateForSender_},F.prototype.calculateProcessingDurationForMessage_=function(a){return 1/0===this.bandwidth?0:1e3*a.payload.length/this.bandwidth},F.prototype.updateAutoDnsQueue_=function(a){var b=a.filter(this.isMessageToAutoDns_.bind(this));q.isEqual(this.autoDnsQueue_,b)||(this.autoDnsQueue_=b)},F.prototype.isMessageToAutoDns_=function(a){var b,c;try{b=new o(this.packetSpec_,a.payload),c=b.getHeaderAsAddressString(o.HeaderType.TO_ADDRESS)}catch(d){return x.warn("Packet not readable by auto-DNS: "+d),!1}return a.toNodeID===this.entityID&&a.fromNodeID===this.entityID&&c===this.getAutoDnsAddress()},F.prototype.processAutoDnsRequests_=function(a,b){h.destroyEntities(a,function(c,d){return c?void b(c,d):void this.generateDnsResponses_(a,b)}.bind(this))},F.prototype.generateDnsResponses_=function(a,b){return 0===a.length?void b(null):void this.generateDnsResponse_(a[0],function(c,d){return c?void b(c,d):void this.generateDnsResponses_(a.slice(1),b)}.bind(this))},F.prototype.generateDnsResponse_=function(a,b){var e,f,g,h,i,j,k=this.entityID,m=this.entityID;try{e=new o(this.packetSpec_,a.payload),f=e.getHeaderAsAddressString(o.HeaderType.FROM_ADDRESS),g=e.getBodyAsAscii(w)}catch(n){return void b(n)}var p=g.match(/GET\s+(\S.*)/);if(null!==p){var q=p[1].split(/\s+/).map(function(a){var b=this.getAddressForHostname_(a);return a+":"+c.valueOr(b,D)}.bind(this));i=q.join(" ")}else i=d.autoDnsUsageMessage();h={fromAddress:this.getAutoDnsAddress(),toAddress:f,packetIndex:1,packetCount:1},j=e.encoder.concatenateBinary(e.encoder.makeBinaryHeaders(h),t(i,w)),l.send(this.shard_,m,k,a.simulatedBy,j,b)}},{"../ObservableEvent":1,"../utils":292,"./NetSimEntity":177,"./NetSimHeartbeat":179,"./NetSimLogEntry":182,"./NetSimLogger":186,"./NetSimMessage":188,"./NetSimNode":193,"./NetSimWire":227,"./Packet":228,"./dataConverters":230,"./locale":232,"./netsimConstants":235,"./netsimGlobals":236,"./netsimUtils":238}],188:[function(a,b){"use strict";
a("../utils");var c=a("./NetSimEntity"),d=b.exports=function(a,b){b=void 0!==b?b:{},c.call(this,a,b),this.fromNodeID=b.fromNodeID,this.toNodeID=b.toNodeID,this.simulatedBy=b.simulatedBy,this.payload=b.payload};d.inherits(c),d.send=function(a,b,c,e,f,g){var h=new d(a);h.fromNodeID=b,h.toNodeID=c,h.simulatedBy=e,h.payload=f,h.getTable().create(h.buildRow(),g)},d.prototype.getTable=function(){return this.shard_.messageTable},d.prototype.buildRow=function(){return{fromNodeID:this.fromNodeID,toNodeID:this.toNodeID,simulatedBy:this.simulatedBy,payload:this.payload}}},{"../utils":292,"./NetSimEntity":177}],182:[function(a,b){"use strict";var c=a("../utils"),d=a("./locale"),e=a("./NetSimEntity"),f=a("./Packet"),g=a("./dataConverters"),h=g.formatBinary,i=a("./netsimConstants").BITS_PER_BYTE,j=b.exports=function(a,b,d){b=void 0!==b?b:{},e.call(this,a,b),this.nodeID=b.nodeID,this.binary=c.valueOr(b.binary,""),this.status=c.valueOr(b.status,j.LogStatus.SUCCESS),this.packet_=new f(c.valueOr(d,[]),this.binary),this.timestamp=void 0!==b.timestamp?b.timestamp:Date.now()};j.inherits(e),j.LogStatus={SUCCESS:"success",DROPPED:"dropped"},j.prototype.getTable=function(){return this.shard_.logTable},j.prototype.buildRow=function(){return{nodeID:this.nodeID,binary:this.binary,status:this.status,timestamp:this.timestamp}},j.create=function(a,b,c,d,e){var f=new j(a);f.nodeID=b,f.binary=c,f.status=d,f.timestamp=Date.now(),f.getTable().create(f.buildRow(),function(b,c){return b?void e(b,null):void e(b,new j(a,c))})},j.prototype.getHeaderField=function(a){try{return f.isAddressField(a)?this.packet_.getHeaderAsAddressString(a):this.packet_.getHeaderAsInt(a).toString()}catch(b){return""}},j.prototype.getMessageBinary=function(){return h(this.packet_.getBodyAsBinary(),i)},j.prototype.getMessageAscii=function(){return this.packet_.getBodyAsAscii(i)},j.prototype.getLocalizedStatus=function(){return this.status===j.LogStatus.SUCCESS?d.logStatus_success():this.status===j.LogStatus.DROPPED?d.logStatus_dropped():""}},{"../utils":292,"./NetSimEntity":177,"./Packet":228,"./dataConverters":230,"./locale":232,"./netsimConstants":235}],228:[function(a,b){"use strict";var c=a("./netsimUtils"),d=a("./dataConverters"),e=a("./netsimGlobals"),f=b.exports=function(a,b){var c=e.getLevelConfig();this.encoder=new f.Encoder(c.addressFormat,c.packetCountBitWidth,a),this.binary=b};f.HeaderType={TO_ADDRESS:"toAddress",FROM_ADDRESS:"fromAddress",PACKET_INDEX:"packetIndex",PACKET_COUNT:"packetCount"},f.isAddressField=function(a){return a===f.HeaderType.TO_ADDRESS||a===f.HeaderType.FROM_ADDRESS},f.isPacketField=function(a){return a===f.HeaderType.PACKET_INDEX||a===f.HeaderType.PACKET_COUNT},f.prototype.getHeaderAsBinary=function(a){return this.encoder.getHeader(a,this.binary)},f.prototype.getHeaderAsInt=function(a){return this.encoder.getHeaderAsInt(a,this.binary)},f.prototype.getHeaderAsAddressString=function(a){return this.encoder.getHeaderAsAddressString(a,this.binary)},f.prototype.getBodyAsBinary=function(){return this.encoder.getBody(this.binary)},f.prototype.getBodyAsAscii=function(a){return this.encoder.getBodyAsAscii(this.binary,a)},f.Encoder=function(a,b,c){this.addressFormat_=a,this.addressBitWidth_=this.calculateBitWidth(this.addressFormat_),this.packetCountBitWidth_=b,this.headerSpec_=c,this.validateSpec()},f.Encoder.prototype.calculateBitWidth=function(a){return a.split(/\D+/).reduce(function(a,b){return a+(parseInt(b,10)||0)},0)},f.Encoder.prototype.validateSpec=function(){for(var a={},b=0;b<this.headerSpec_.length;b++){var c=f.isAddressField(this.headerSpec_[b]),d=f.isPacketField(this.headerSpec_[b]);if(c&&0===this.addressBitWidth_)throw new Error("Invalid packet format: Includes an address field but  address format is invalid.");if(d&&0===this.packetCountBitWidth_)throw new Error("Invalid packet format: Includes a packet count field  but packet field bit width is zero");if(!c&&!d)throw new Error("Invalid packet format: Unrecognized packet header field "+this.headerSpec_[b]);if(a.hasOwnProperty(this.headerSpec_[b]))throw new Error("Invalid packet format: Field keys must be unique.");a[this.headerSpec_[b]]="used"}},f.Encoder.prototype.getHeader=function(a,b){var c=0,e=0;for(b=d.minifyBinary(b);this.headerSpec_[c]!==a;)if(e+=this.getFieldBitWidth(this.headerSpec_[c]),c++,c>=this.headerSpec_.length)throw new Error('Key "'+a+'" not found in packet spec.');var f=this.getFieldBitWidth(this.headerSpec_[c]),g=b.slice(e,e+f);if(1/0!==f)for(;g.length<f;)g+="0";return g},f.Encoder.prototype.getHeaderAsInt=function(a,b){return d.binaryToInt(this.getHeader(a,b))},f.Encoder.prototype.getHeaderAsAddressString=function(a,b){return d.binaryToAddressString(this.getHeader(a,b),this.addressFormat_)},f.Encoder.prototype.getBody=function(a){return d.minifyBinary(a).slice(this.getHeaderLength())},f.Encoder.prototype.getHeaderLength=function(){return this.headerSpec_.reduce(function(a,b){return a+this.getFieldBitWidth(b)}.bind(this),0)},f.Encoder.prototype.getBodyAsAscii=function(a,b){return d.binaryToAscii(this.getBody(a),b)},f.Encoder.prototype.getFieldBitWidth=function(a){if(f.isAddressField(a))return this.addressBitWidth_;if(f.isPacketField(a))return this.packetCountBitWidth_;throw new Error("Unable to select a bit-width for field "+a)},f.Encoder.prototype.makeBinaryHeaders=function(a){var b={};return this.headerSpec_.forEach(function(c){a.hasOwnProperty(c)&&(b[c]=f.isAddressField(c)?this.addressStringToBinary(a[c]):d.intToBinary(a[c],this.getFieldBitWidth(c)))},this),b},f.Encoder.prototype.addressStringToBinary=function(a){return d.addressStringToBinary(a,this.addressFormat_)},f.Encoder.prototype.concatenateBinary=function(a,b){var d=[];return this.headerSpec_.forEach(function(b){var e=this.getFieldBitWidth(b),f=a.hasOwnProperty(b)?a[b]:"";f=f.slice(0,e),f=c.zeroPadLeft(f,e),d.push(f)},this),d.push(b),d.join("")}},{"./dataConverters":230,"./netsimGlobals":236,"./netsimUtils":238}],201:[function(a,b){"use strict";var c=a("../utils"),d=c.getLodash(),e=a("./locale"),f=a("./NetSimPanel"),g=a("./NetSimRemoteNodeSelectionPanel.html.ejs"),h=a("./netsimConstants").NodeType,i=a("./netsimGlobals"),j=b.exports=function(a,b,c){this.nodesOnShard_=b.nodesOnShard,this.incomingConnectionNodes_=b.incomingConnectionNodes,this.remoteNode_=b.remoteNode,this.myNodeID_=b.myNodeID,this.addRouterCallback_=c.addRouterCallback,this.cancelButtonCallback_=c.cancelButtonCallback,this.joinButtonCallback_=c.joinButtonCallback,f.call(this,a,{className:"netsim-lobby-panel",panelTitle:this.getLocalizedPanelTitle(),canMinimize:!1})};j.inherits(f),j.prototype.render=function(){j.superPrototype.render.call(this);var a=$(g({controller:this,nodesOnShard:this.nodesOnShard_,incomingConnectionNodes:this.incomingConnectionNodes_,remoteNode:this.remoteNode_}));this.getBody().html(a),this.addRouterButton_=this.getBody().find("#netsim-lobby-add-router"),this.addRouterButton_.click(this.addRouterCallback_),this.getBody().find(".join-button").click(this.onJoinClick_.bind(this)),this.getBody().find(".accept-button").click(this.onJoinClick_.bind(this)),this.getBody().find(".cancel-button").click(this.cancelButtonCallback_)},j.prototype.getLocalizedPanelTitle=function(){var a=i.getLevelConfig();return a.canConnectToClients&&a.canConnectToRouters?e.connectToANode():a.canConnectToClients?e.connectToAPeer():a.canConnectToRouters?a.broadcastMode?e.connectToARoom():e.connectToARouter():e.connectToANode()},j.prototype.getLocalizedLobbyInstructions=function(){var a=i.getLevelConfig();return a.canConnectToClients&&a.canConnectToRouters?e.lobbyInstructionsGeneral():a.canConnectToClients?e.lobbyInstructionsForPeers():a.canConnectToRouters?a.broadcastMode?e.lobbyInstructionsForRooms():e.lobbyInstructionsForRouters():e.lobbyInstructionsGeneral()},j.prototype.onJoinClick_=function(a){var b=$(a.target);if(!b.is("[disabled]")){var c=b.data("nodeId"),e=d.find(this.nodesOnShard_,function(a){return a.entityID===c});this.joinButtonCallback_(e)}},j.prototype.isMyNode=function(a){return this.myNodeID_===a.entityID},j.prototype.canConnectToNode=function(a){if(this.isMyNode(a))return!1;var b=a.getNodeType()===h.CLIENT,c=a.getNodeType()===h.ROUTER;if(c&&a.isFull())return!1;var d=i.getLevelConfig(),e=d.canConnectToClients,f=d.canConnectToRouters;return b&&e||c&&f},j.prototype.hasOutgoingRequest=function(){return!!this.remoteNode_},j.prototype.shouldShowNode=function(a){var b=i.getLevelConfig(),c=a.getNodeType()===h.CLIENT,d=a.getNodeType()===h.ROUTER,e=b.showClientsInLobby,f=b.showRoutersInLobby;return c&&e||d&&f}},{"../utils":292,"./NetSimPanel":198,"./NetSimRemoteNodeSelectionPanel.html.ejs":200,"./locale":232,"./netsimConstants":235,"./netsimGlobals":236}],200:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(a,b,c,d){var f=e.valueOr(c,[]);f.push("netsim-button"),f.push("large-button"),d=e.valueOr(d,{});var g='<span class="'+f.join(" ")+'" ';b&&(g+='id="'+b+'" ');for(var h in d)d.hasOwnProperty(h)&&(g+=h+'="'+d[h]+'" ');return g+=">"+a+"</span>"}function b(a){buf.push('\n    <tr>\n      <th colspan="3">',escape(a),"</th>\n    </tr>\n  ")}function c(a){a=e.valueOr(a,""),buf.push('\n    <tr>\n      <td colspan="3" class="empty-row">',a,"</td>\n    </tr>\n  ")}function d(b,c,d,e,f){buf.push("\n    <tr>\n      <td nowrap>",escape(c),"</td>\n      <td>",d,'</td>\n      <td class="button-column">\n        ');var h="";"join-button"===e?h=a(g.buttonJoin(),void 0,[e,f],{"data-node-id":b}):"accept-button"===e?h=a(g.buttonAccept(),void 0,[e,f],{"data-node-id":b}):"cancel-button"===e?h=a(g.buttonCancel(),void 0,[e,f,"secondary"],{"data-node-id":b}):"full-button"===e&&(h=a(g.buttonFull(),void 0,[e,f],{disabled:"disabled"})),buf.push("\n        ",h,"\n      </td>\n    </tr>\n  ")}buf.push("");var e=require("../utils"),f=e.getLodash(),g=require("./locale"),h=require("./netsimGlobals"),i=require("./netsimConstants").NodeType,j=h.getAssetUrlFunction(),k=h.getLevelConfig(),l=function(a){return void 0===f.find(incomingConnectionNodes,function(b){return b.entityID===a.entityID})},m=function(a){return!remoteNode||remoteNode.entityID!==a.entityID},n=function(a){var b=a.getNodeType()===i.ROUTER?["router-row"]:["user-row"];return controller.isMyNode(a)&&b.push("own-row"),{nodeID:a.entityID,classAttr:b.join(" "),displayName:a.getDisplayName(),status:a.getStatus(),isFull:a.getNodeType()===i.ROUTER&&a.isFull(),canConnectToNode:controller.canConnectToNode(a)}},o=function(a,b){return a.displayName>b.displayName?1:-1},p=nodesOnShard.filter(controller.shouldShowNode.bind(controller)).filter(l).filter(m).map(n).sort(o),q=incomingConnectionNodes.filter(controller.shouldShowNode.bind(controller)).filter(m).map(n).sort(o),r=(remoteNode?[remoteNode]:[]).filter(controller.shouldShowNode.bind(controller)).map(n);if(buf.push('\n<div class="content-wrap">\n  <div class="instructions">',escape(controller.getLocalizedLobbyInstructions()),'</div>\n  <div class="controls">\n    <table>\n\n      '),b(g.lobby()),p.forEach(function(a){var b;controller.hasOutgoingRequest()||(a.isFull?b="full-button":a.canConnectToNode&&(b="join-button")),d(a.nodeID,a.displayName,a.status,b,a.classAttr)}),!controller.hasOutgoingRequest()&&k.showAddRouterButton){var s=k.broadcastMode?g.addRoom():g.addRouter();c(a(s,"netsim-lobby-add-router",["secondary"]))}else 0===p.length&&c(g.lobbyIsEmpty());q.length>0&&(c(),b(g.incomingConnectionRequests()),q.forEach(function(a){var b;!controller.hasOutgoingRequest()&&a.canConnectToNode&&(b="accept-button");var c=g.lobbyStatusWaitingForYou();d(a.nodeID,a.displayName,c,b,a.classAttr)})),r.length>0&&(c(),b(g.outgoingConnectionRequests()),r.forEach(function(a){var b=g.lobbyStatusWaitingForOther({spinner:'<img src="'+j("media/netsim/loading.gif")+'" />',otherName:a.displayName,otherStatus:a.status});d(a.nodeID,a.displayName,b,"cancel-button",a.classAttr)})),buf.push('\n\n    </table>\n  </div>\n  <div class="clear"></div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../utils":292,"./locale":232,"./netsimConstants":235,"./netsimGlobals":236,ejs:302}],179:[function(a,b){"use strict";a("../utils");var c=a("./NetSimEntity"),d=6e3,e=b.exports=function(a,b){b=void 0!==b?b:{},c.call(this,a,b),this.nodeID=b.nodeID,this.time_=void 0!==b.time?b.time:Date.now(),this.intervalMs_=d,this.onFailedHeartbeat=void 0,this.falseAgeMS_=0};e.inherits(c),e.create=function(a,b){c.create(e,a,b)},e.getOrCreate=function(a,b,c){a.heartbeatTable.readAll(function(d,f){var g=f.filter(function(a){return a.nodeID==b}).sort(function(a,b){return a.time<b.time?1:-1});g.length>0?c(null,new e(a,g[0])):e.create(a,function(a,d){return a?void c(a,null):(d.nodeID=b,void d.update(function(a){return a?(d.destroy(),void c(a,null)):void c(null,d)}))})})},e.prototype.getTable=function(){return this.shard_.heartbeatTable},e.prototype.buildRow=function(){return{nodeID:this.nodeID,time:this.time_-this.falseAgeMS_}},e.prototype.setBeatInterval=function(a){this.intervalMs_=a},e.prototype.setFailureCallback=function(a){if(void 0!==this.onFailedHeartbeat&&void 0!==a)throw new Error("Heartbeat already has a failure callback.");this.onFailedHeartbeat=a},e.prototype.tick=function(){Date.now()-this.time_>this.intervalMs_&&(this.time_=Date.now(),this.update(function(a){a&&void 0!==this.onFailedHeartbeat&&this.onFailedHeartbeat()}.bind(this)))},e.prototype.spoofExpired=function(){this.falseAgeMS_+=6e5,this.update()}},{"../utils":292,"./NetSimEntity":177}],178:[function(a,b){"use strict";a("../utils");var c=a("./netsimUtils").jQuerySvgElement,d=a("./NetSimVizElement"),e=a("./NetSimVizNode"),f=b.exports=function(a,b){d.call(this);var e=this.getRoot();e.addClass("viz-wire"),this.line_=c("path").appendTo(e),this.getEntityByID_=b,this.localVizNode=null,this.remoteVizNode=null,this.configureFrom(a),this.render()};f.inherits(d),f.prototype.configureFrom=function(a){this.localVizNode=this.getEntityByID_(e,a.nodeA),this.remoteVizNode=this.getEntityByID_(e,a.nodeB)},f.prototype.localNodeID=function(){return this.localVizNode?this.localVizNode.id:void 0},f.prototype.remoteNodeID=function(){return this.remoteVizNode?this.remoteVizNode.id:void 0},f.prototype.render=function(){f.superPrototype.render.call(this);var a="M 0 0";this.localVizNode&&this.remoteVizNode&&(a="M "+this.localVizNode.posX+" "+this.localVizNode.posY+" L "+this.remoteVizNode.posX+" "+this.remoteVizNode.posY),this.line_.attr("d",a)},f.prototype.hide=function(){this.getRoot().addClass("hidden-wire")},f.prototype.kill=function(){f.superPrototype.kill.call(this),this.localVizNode=null,this.remoteVizNode=null},f.prototype.setWireClasses_=function(a){var b="0"===a,c=!b&&"1"===a,d=!b&&!c;this.getRoot().toggleClass("state-on",c),this.getRoot().toggleClass("state-off",b),this.getRoot().toggleClass("state-unknown",d)}},{"../utils":292,"./NetSimVizElement":223,"./NetSimVizNode":225,"./netsimUtils":238}],225:[function(a,b){"use strict";a("../utils");var c=a("./netsimConstants"),d=a("./netsimUtils").jQuerySvgElement,e=a("./NetSimVizEntity"),f=a("./tweens"),g=c.DnsMode,h=c.NodeType,i=a("./netsimGlobals"),j=30,k=20,l=10,m=b.exports=function(a){e.call(this,a),this.address_=void 0,this.dnsMode_=void 0,this.nodeID=void 0,this.isRouter=!1,this.isLocalNode=!1,this.isDnsNode=!1;var b=this.getRoot();b.addClass("viz-node");var c=37,g=4;d("circle").attr("cx",0).attr("cy",0).attr("r",c).appendTo(b),this.nameGroup_=d("g").attr("transform","translate(0,0)").appendTo(b),this.displayName_=d("text").attr("x",0).attr("y",g),this.nameBox_=d("rect").addClass("name-box"),this.nameGroup_.append(this.nameBox_).append(this.displayName_),this.addressGroup_=d("g").attr("transform","translate(0,30)").hide().appendTo(b),this.addressBox_=d("rect").addClass("address-box").appendTo(this.addressGroup_),this.addressText_=d("text").addClass("address-box").attr("x",0).attr("y",g).text("?").appendTo(this.addressGroup_),this.snapToScale(0),this.tweenToScale(.5,800,f.easeOutElastic),this.configureFrom(a),this.render()};m.inherits(e),m.prototype.configureFrom=function(a){var b=i.getLevelConfig();this.setName(b.showHostnameInGraph?a.getHostname():a.getShortDisplayName()),this.nodeID=a.entityID,a.getNodeType()===h.ROUTER&&(this.isRouter=!0,this.getRoot().addClass("router-node"),b.broadcastMode&&this.getRoot().css("display","none"))},m.prototype.setIsLocalNode=function(){this.isLocalNode=!0,this.getRoot().addClass("local-node")},m.prototype.setName=function(a){this.displayName_.text(a),this.resizeNameBox_()},m.prototype.resizeNameBox_=function(){this.resizeRectToText_(this.nameBox_,this.displayName_)},m.prototype.resizeAddressBox_=function(){this.resizeRectToText_(this.addressBox_,this.addressText_)},m.prototype.resizeRectToText_=function(a,b){try{var c=b[0].getBBox(),d=Math.max(j,c.width+k),e=c.height+l,f=d/2,g=e/2;a.attr("x",-f).attr("y",-g).attr("rx",g).attr("ry",g).attr("width",d).attr("height",e)}catch(h){}},m.prototype.kill=function(){m.superPrototype.kill.call(this),this.stopAllAnimation(),this.tweenToScale(0,200,f.easeInQuad)},m.prototype.tick=function(a){if(m.superPrototype.tick.call(this,a),this.isForeground||0!==this.tweens_.length)this.isForeground&&this.tweens_.length>0&&(this.resizeNameBox_(),this.resizeAddressBox_());else{var b=300*Math.random()-150,c=300*Math.random()-150;this.tweenToPosition(b,c,2e4,f.easeInOutQuad)}},m.prototype.onDepthChange=function(a){m.superPrototype.onDepthChange.call(this,a),this.tweens_.length=0,a?this.tweenToScale(1,600,f.easeOutElastic):this.tweenToScale(.5,600,f.easeOutElastic)},m.prototype.setAddress=function(a){this.address_=a,this.updateAddressDisplay()},m.prototype.setDnsMode=function(a){this.dnsMode_=a,this.updateAddressDisplay()},m.prototype.setIsDnsNode=function(a){this.isDnsNode=a,this.updateAddressDisplay()},m.prototype.updateAddressDisplay=function(){var a=i.getLevelConfig();return void 0===this.address_||a.broadcastMode||this.isRouter?void this.addressGroup_.hide():(this.addressGroup_.show(),this.addressText_.text(this.dnsMode_===g.NONE?void 0!==this.address_?this.address_:"?":this.isLocalNode||this.isDnsNode?this.address_:"?"),void this.resizeAddressBox_())}},{"../utils":292,"./NetSimVizEntity":224,"./netsimConstants":235,"./netsimGlobals":236,"./netsimUtils":238,"./tweens":241}],224:[function(a,b){"use strict";a("../utils");var c=a("./NetSimVizElement"),d=b.exports=function(a){c.call(this),this.id=a.entityID};d.inherits(c),d.prototype.kill=function(){this.id=void 0,d.superPrototype.kill.call(this)}},{"../utils":292,"./NetSimVizElement":223}],223:[function(a,b){"use strict";var c=a("./netsimUtils").jQuerySvgElement,d=a("./tweens"),e=b.exports=function(){this.posX=0,this.posY=0,this.scale=1,this.isForeground=!1,this.rootGroup_=c("g"),this.tweens_=[],this.isDead_=!1};e.prototype.getRoot=function(){return this.rootGroup_},e.prototype.kill=function(){this.isDead_=!0},e.prototype.isDead=function(){return this.isDead_&&0===this.tweens_.length},e.prototype.isDying=function(){return this.isDead_&&this.tweens_.length>0},e.prototype.tick=function(a){this.tweens_.forEach(function(b){b.tick(a)}),this.tweens_=this.tweens_.filter(function(a){return!a.isFinished})},e.prototype.render=function(){var a="translate("+this.posX+" "+this.posY+") scale("+this.scale+")";this.rootGroup_.attr("transform",a)},e.prototype.onDepthChange=function(a){this.isForeground=a},e.prototype.stopAllAnimation=function(){this.tweens_.length=0},e.prototype.tweenToPosition=function(a,b,c,e){this.removeAllTweensOnProperties(["posX","posY"]),c>0?(this.tweens_.push(new d.TweenValueTo(this,"posX",a,c,e)),this.tweens_.push(new d.TweenValueTo(this,"posY",b,c,e))):(this.posX=a,this.posY=b)},e.prototype.snapToPosition=function(a,b){this.tweenToPosition(a,b,0)},e.prototype.tweenToScale=function(a,b,c){this.removeAllTweensOnProperty("scale"),b>0?this.tweens_.push(new d.TweenValueTo(this,"scale",a,b,c)):this.scale=a},e.prototype.doAfterDelay=function(a,b){a>0?this.tweens_.push(new d.DoAfterDelay(this,a,b)):b()},e.prototype.removeAllTweensOnProperty=function(a){this.removeAllTweensOnProperties([a])},e.prototype.removeAllTweensOnProperties=function(a){this.tweens_=this.tweens_.filter(function(b){var c=b.target===this,d=a.some(function(a){return b.propertyName===a});return!(c&&d)},this)},e.prototype.snapToScale=function(a){this.tweenToScale(a,0)}},{"./netsimUtils":238,"./tweens":241}],241:[function(a,b,c){"use strict";var d=a("../utils").valueOr,e=600;c.easeOutElastic=function(a,b,c,d){var e,f,g;return e=1.70158,f=0,g=c,0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),g<Math.abs(c)?(g=c,e=f/4):e=f/(2*Math.PI)*Math.asin(c/g),g*Math.pow(2,-10*a)*Math.sin(2*(a*d-e)*Math.PI/f)+c+b)},c.easeInQuad=function(a,b,c,d){return c*(a/=d)*a+b},c.easeOutQuad=function(a,b,c,d){return-c*(a/=d)*(a-2)+b},c.easeInOutQuad=function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},c.linear=function(a,b,c,d){return c*(a/d)+b},c.TweenValueTo=function(a,b,f,g,h){this.isFinished=!1,this.startTime_=void 0,this.target=a,this.propertyName=b,this.tweenFunction_=d(h,c.linear),this.startValue_=a[b],this.deltaValue_=f-this.startValue_,this.duration_=d(g,e)},c.TweenValueTo.prototype.tick=function(a){void 0===this.startTime_&&(this.startTime_=a.time);var b=a.time-this.startTime_;0!==this.deltaValue_&&(this.target[this.propertyName]=this.tweenFunction_(b,this.startValue_,this.deltaValue_,this.duration_)),b>=this.duration_&&(this.target[this.propertyName]=this.startValue_+this.deltaValue_,this.isFinished=!0)},c.DoAfterDelay=function(a,b,c){this.isFinished=!1,this.startTime_=void 0,this.target=a,this.propertyName=null,this.duration_=b,this.callback_=c},c.DoAfterDelay.prototype.tick=function(a){void 0===this.startTime_&&(this.startTime_=a.time);var b=a.time-this.startTime_;b>=this.duration_&&(this.callback_(),this.isFinished=!0)}},{"../utils":292}],172:[function(a,b){"use strict";var c=a("./NetSimDnsTab.html.ejs"),d=a("./netsimConstants").DnsMode,e=a("./NetSimDnsModeControl"),f=a("./NetSimDnsManualControl"),g=a("./NetSimDnsTable"),h=a("./netsimGlobals"),i=b.exports=function(a,b,c){this.rootDiv_=a,this.dnsModeChangeCallback_=b,this.becomeDnsCallback_=c,this.dnsModeControl_=null,this.dnsManualControl_=null,this.dnsTable_=null,this.render()};i.prototype.render=function(){var a=h.getLevelConfig(),b=$(c({level:a}));this.rootDiv_.html(b),a.showDnsModeControl&&(this.dnsModeControl_=new e(this.rootDiv_.find(".dns_mode"),this.dnsModeChangeCallback_)),this.dnsManualControl_=new f(this.rootDiv_.find(".dns_manual_control"),this.becomeDnsCallback_),this.dnsTable_=new g(this.rootDiv_.find(".dns_table"))},i.prototype.setDnsMode=function(a){this.dnsModeControl_&&this.dnsModeControl_.setDnsMode(a),this.dnsTable_.setDnsMode(a),this.rootDiv_.find(".dns_manual_control").toggle(a===d.MANUAL),this.rootDiv_.find(".dns-notes").toggle(a!==d.NONE)},i.prototype.setIsDnsNode=function(a){this.dnsManualControl_.setIsDnsNode(a)},i.prototype.setDnsTableContents=function(a){this.dnsTable_.setDnsTableContents(a)}},{"./NetSimDnsManualControl":168,"./NetSimDnsModeControl":170,"./NetSimDnsTab.html.ejs":171,"./NetSimDnsTable":174,"./netsimConstants":235,"./netsimGlobals":236}],174:[function(a,b){"use strict";var c=a("./NetSimDnsTable.html.ejs"),d=a("./netsimConstants").DnsMode,e=b.exports=function(a){this.rootDiv_=a,this.dnsMode_=d.NONE,this.addressTableData_=[],this.render()};e.prototype.render=function(){var a=$(c({dnsMode:this.dnsMode_,tableData:this.addressTableData_}));this.rootDiv_.html(a)},e.prototype.setDnsMode=function(a){this.dnsMode_=a,this.render()},e.prototype.setDnsTableContents=function(a){this.addressTableData_=a,this.render()}},{"./NetSimDnsTable.html.ejs":173,"./netsimConstants":235}],173:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("./netsimConstants").DnsMode;buf.push('\n<div class="netsim-dns-table">\n  <h1>My Network</h1>\n  <table>\n    <thead>\n    <tr>\n      <th>Hostname</th>\n      <th>Address</th>\n    </tr>\n    </thead>\n    <tbody>\n    '),tableData.forEach(function(b){var c=b.hostname,d="",e=[];(dnsMode===a.NONE||b.isDnsNode||b.isLocal)&&(d=b.address),b.isLocal&&(c+=" (Me)",e.push("local-node")),b.isDnsNode&&dnsMode!==a.NONE&&(c+=" (DNS)",e.push("dns-node")),buf.push('\n        <tr class="',escape(e.join(" ")),'">\n          <td>',escape(c),"</td>\n          <td>",escape(d),"</td>\n        </tr>\n      ")}),buf.push("\n    </tbody>\n  </table>\n</div>")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./netsimConstants":235,ejs:302}],171:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div class="netsim-dns-tab">\n  '),level.showDnsModeControl&&buf.push('\n  <div class="dns_mode"></div>\n  '),buf.push('\n  <div class="dns_manual_control"></div>\n  <div class="dns_table"></div>\n  <div class="dns-notes">\n    <h1>Notes</h1>\n    <div>\n      <textarea></textarea>\n    </div>\n  </div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:302}],170:[function(a,b){"use strict";var c=a("./NetSimDnsModeControl.html.ejs"),d=a("./netsimConstants").DnsMode,e=b.exports=function(a,b){this.rootDiv_=a,this.dnsModeChangeCallback_=b,this.dnsModeRadios_=null,this.currentDnsMode_=d.NONE,this.render()};e.prototype.render=function(){var a=$(c({}));this.rootDiv_.html(a),this.dnsModeRadios_=this.rootDiv_.find('input[type="radio"][name="dns_mode"]'),this.dnsModeRadios_.change(this.onDnsModeChange_.bind(this)),this.setDnsMode(this.currentDnsMode_)},e.prototype.onDnsModeChange_=function(){var a=this.dnsModeRadios_.filter(":checked").val();this.dnsModeChangeCallback_(a)},e.prototype.setDnsMode=function(a){this.currentDnsMode_=a,this.dnsModeRadios_.filter('[value="'+a+'"]').prop("checked",!0)}},{"./NetSimDnsModeControl.html.ejs":169,"./netsimConstants":235}],169:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(a,b){buf.push('\n    <div class="dns_mode_',escape(a),'">\n      <input id="dns_mode_',escape(a),'"\n                   type="radio"\n                   name="dns_mode"\n                   value="',escape(a),'" />\n      <label for="dns_mode_',escape(a),'">',escape(b),"</label>\n    </div>\n    ")}buf.push("");var b=require("./netsimConstants").DnsMode,c=require("./locale");buf.push('\n<div class="dns-mode-control">\n  <h1>',escape(c.dnsMode()),"</h1>\n  "),a(b.NONE,c.dnsMode_NONE()),buf.push("\n  "),a(b.MANUAL,c.dnsMode_MANUAL()),buf.push("\n  "),a(b.AUTOMATIC,c.dnsMode_AUTOMATIC()),buf.push("\n</div>\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./locale":232,"./netsimConstants":235,ejs:302}],168:[function(a,b){"use strict";var c=a("./NetSimDnsManualControl.html.ejs"),d=b.exports=function(a,b){this.rootDiv_=a,this.becomeDnsCallback_=b,this.render()};d.prototype.render=function(){var a=$(c({}));this.rootDiv_.html(a),this.rootDiv_.find('input[type="button"]').click(this.onBecomeDnsButtonClick_.bind(this))},d.prototype.onBecomeDnsButtonClick_=function(){this.becomeDnsCallback_()},d.prototype.setIsDnsNode=function(a){this.rootDiv_.find('input[type="button"]').attr("disabled",a)}},{"./NetSimDnsManualControl.html.ejs":167}],167:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div class="netsim_dns_manual_control">\n  <h1>Manual Control</h1>\n  <input id="become_dns_button" type="button" value="Take over as DNS" />\n</div>')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:302}],166:[function(a,b){"use strict";var c=a("../utils"),d=c.getLodash(),e=a("./locale"),f=a("./netsimConstants").NodeType,g=a("./NetSimEntity"),h=a("./NetSimNode"),i=b.exports=function(a,b){h.call(this,a,b)};i.inherits(h),i.prototype.getNodeType=function(){return f.CLIENT},i.prototype.getStatus=function(){var a=this.shard_.wireTable.readAllCached(),b=d.find(a,function(a){return a.localNodeID===this.entityID},this);if(b){var c=this.shard_.nodeTable.readAllCached(),g=d.find(c,function(a){return a.id===b.remoteNodeID}),h=e.unknownNode();g&&(h=g.name);var i;return i=g&&g.type===f.ROUTER?!0:d.find(a,function(a){return a.localNodeID===b.remoteNodeID&&a.remoteNodeID===b.localNodeID}),i?e.connectedToNodeName({nodeName:h}):e.connectingToNodeName({nodeName:h})}return e.notConnected()},i.get=function(a,b,c){g.get(i,a,b,c)}},{"../utils":292,"./NetSimEntity":177,"./NetSimNode":193,"./locale":232,"./netsimConstants":235}],193:[function(a,b){"use strict";a("../utils");var c=a("./locale"),d=a("./NetSimEntity"),e=a("./NetSimWire"),f=b.exports=function(a,b){b=void 0!==b?b:{},d.call(this,a,b),this.displayName_=b.name};f.inherits(d),f.prototype.getTable=function(){return this.shard_.nodeTable},f.prototype.buildRow=function(){return{type:this.getNodeType(),name:this.getDisplayName()}},f.prototype.getDisplayName=function(){return this.displayName_?this.displayName_:c.defaultNodeName()},f.prototype.getShortDisplayName=function(){var a=this.getDisplayName();return a.length>10&&(a=a.split(/\s/)[0]),a},f.prototype.getHostname=function(){return this.getShortDisplayName().replace(/[^\w\d]/g,"").toLowerCase()+this.entityID},f.prototype.getNodeType=function(){throw new Error("getNodeType method is not implemented")},f.prototype.getStatus=function(){throw new Error("getStatus method is not implemented")},f.prototype.connectToNode=function(a,b){b=b||function(){};var c=this;e.create(this.shard_,this.entityID,a.entityID,function(d,e){return d?void b(d,null):void a.acceptConnection(c,function(a,c){return a||!c?void e.destroy(function(){b(new Error("Connection rejected."),null)}):void b(null,e)})})},f.prototype.acceptConnection=function(a,b){b(null,!0)}},{"../utils":292,"./NetSimEntity":177,"./NetSimWire":227,"./locale":232}],227:[function(a,b){"use strict";a("../utils");var c=a("./NetSimEntity"),d=b.exports=function(a,b){b=void 0!==b?b:{},c.call(this,a,b),this.localNodeID=b.localNodeID,this.remoteNodeID=b.remoteNodeID,this.localAddress=b.localAddress,this.remoteAddress=b.remoteAddress,this.localHostname=b.localHostname,this.remoteHostname=b.remoteHostname};d.inherits(c),d.create=function(a,b,c,e){var f=new d(a);f.localNodeID=b,f.remoteNodeID=c,f.getTable().create(f.buildRow(),function(b,c){return b?void e(b,null):void e(null,new d(a,c))})},d.prototype.getTable=function(){return this.shard_.wireTable},d.prototype.buildRow=function(){return{localNodeID:this.localNodeID,remoteNodeID:this.remoteNodeID,localAddress:this.localAddress,remoteAddress:this.remoteAddress,localHostname:this.localHostname,remoteHostname:this.remoteHostname}},d.prototype.isMessageRowOnDuplexWire=function(a){return this.localNodeID===a.fromNodeID&&this.remoteNodeID===a.toNodeID},d.prototype.isMessageRowOnSimplexWire=function(a){var b=this.isMessageRowOnDuplexWire(a),c=this.localNodeID===a.toNodeID&&this.remoteNodeID===a.fromNodeID;return b||c}},{"../utils":292,"./NetSimEntity":177}],177:[function(a,b){"use strict";var c=b.exports=function(a,b){void 0===b&&(b={}),this.shard_=a,this.entityID=b.id
};c.create=function(a,b,c){var d=new a(b);d.getTable().create(d.buildRow(),function(d,e){d?c(d,null):c(null,new a(b,e))})},c.get=function(a,b,c,d){var e=new a(c);e.getTable().read(b,function(b,e){b?d(b,null):d(b,new a(c,e))})},c.prototype.update=function(a){a=a||function(){},this.getTable().update(this.entityID,this.buildRow(),a)},c.prototype.destroy=function(a){a=a||function(){},this.getTable()["delete"](this.entityID,a)},c.prototype.synchronousDestroy=function(){return this.getTable().synchronousDelete(this.entityID)},c.prototype.getTable=function(){throw new Error("Method getTable is not implemented.")},c.prototype.buildRow=function(){return{}},c.destroyEntities=function(a,b){return 0===a.length?void b(null,!0):void a[0].destroy(function(d,e){return d?void b(d,e):void c.destroyEntities(a.slice(1),b)}.bind(this))}},{}],165:[function(a,b){"use strict";var c=a("./locale"),d=a("./NetSimSlider"),e=b.exports=function(a,b){d.call(this,a,{onChange:b,min:1,max:32}),this.render()};e.inherits(d),e.prototype.valueToLabel=function(a){return c.numBitsPerChunk({numBits:a})},e.prototype.valueToShortLabel=function(a){return a.toString()}},{"./NetSimSlider":216,"./locale":232}],164:[function(a,b){"use strict";a("../utils");var c=a("./netsimUtils"),d=a("./NetSimSlider"),e=b.exports=function(a,b,c){d.call(this,a,{onChange:c,value:b,min:1,max:20,upperBoundInfinite:!0}),this.render()};e.inherits(d),e.prototype.valueToLabel=function(a){return c.bitrateToLocalizedRoundedBitrate(a)}},{"../utils":292,"./NetSimSlider":216,"./netsimUtils":238}],163:[function(a,b){"use strict";a("../utils");var c=a("./locale"),d=a("./NetSimBitLogPanel.html.ejs"),e=a("./NetSimPanel"),f=a("./NetSimEncodingControl"),g=a("./netsimGlobals"),h=a("./NetSimLogger").getSingleton(),i=b.exports=function(a,b){this.binary_="",this.encodings_=[],this.chunkSize_=8,this.logTitle_=b.logTitle,this.netsim_=b.netsim,this.showReadWireButton_=b.showReadWireButton,this.openHeight_=0,e.call(this,a,{className:"netsim-log-panel",panelTitle:b.logTitle,beginMinimized:b.isMinimized})};i.inherits(e),i.prototype.render=function(){i.superPrototype.render.call(this);var a=$(d({binary:this.binary_,enabledEncodings:this.encodings_,chunkSize:this.chunkSize_,showReadWireButton:this.showReadWireButton_}));this.getBody().html(a),f.hideRowsByEncoding(this.getBody(),this.encodings_),this.getBody().find("#read-wire-button").click(this.onReceiveButtonPress_.bind(this)),this.addButton(c.clear(),this.onClearButtonPress_.bind(this)),this.sizeToOpenHeight_()},i.prototype.onClearButtonPress_=function(){this.binary_="",this.render()},i.prototype.onReceiveButtonPress_=function(a){var b=$(a.target);b.is("[disabled]")||(b.attr("disabled","disabled"),this.netsim_.receiveBit(function(a,c){if(a)return h.warn("Error reading wire state: "+a.message),void b.removeAttr("disabled");var d="0";c&&(d=c.payload),this.log(d),this.netsim_.animateReadWireState(d),b.removeAttr("disabled")}.bind(this)))},i.prototype.log=function(a){this.binary_+=a.toString(),this.render()},i.prototype.setEncodings=function(a){this.encodings_=a,this.render()},i.prototype.setChunkSize=function(a){this.chunkSize_=a,this.render()},i.prototype.setHeight=function(a){this.openHeight_=a,this.sizeToOpenHeight_()},i.prototype.sizeToOpenHeight_=function(){var a=this.getRoot().find(".netsim-panel"),b=a.find("h1"),c=a.find(".panel-body"),d=a.find(".scroll-area"),e=parseFloat(a.css("margin-top"))+parseFloat(a.css("margin-bottom")),f=b.outerHeight(!0),g=parseFloat(c.css("border-top-width"))+parseFloat(c.css("border-bottom-width")),h=parseFloat(d.css("margin-top"))+parseFloat(d.css("margin-bottom")),i=this.openHeight_-(e+f+g+h);d.height(Math.floor(i))},i.prototype.getHeight=function(){return this.getRoot().find(".netsim-panel").outerHeight(!0)},i.prototype.onMinimizerClick_=function(){i.superPrototype.onMinimizerClick_.call(this),g.updateLayout()}},{"../utils":292,"./NetSimBitLogPanel.html.ejs":162,"./NetSimEncodingControl":176,"./NetSimLogger":186,"./NetSimPanel":198,"./locale":232,"./netsimGlobals":236}],236:[function(a,b){"use strict";var c=null,d=null;b.exports={setRootControllers:function(a,b){c=a,d=b},getLevelConfig:function(){return d.level},getAssetUrlFunction:function(){return c.assetUrl},updateLayout:function(){d.updateLayout()}}},{}],198:[function(a,b){"use strict";var c=a("../utils"),d=a("./NetSimPanel.html.ejs"),e=b.exports=function(a,b){this.instanceID_=e.uniqueIDCounter,e.uniqueIDCounter++,this.rootDiv_=a,this.className_=c.valueOr(b.className,""),this.panelTitle_=c.valueOr(b.panelTitle,""),this.canMinimize_=c.valueOr(b.canMinimize,!0),this.isMinimized_=c.valueOr(b.beginMinimized,!1),this.render()};e.uniqueIDCounter=0,e.prototype.render=function(){var a=$(d({instanceID:this.instanceID_,className:this.className_,panelTitle:this.panelTitle_,canMinimize:this.canMinimize_}));this.rootDiv_.html(a),this.canMinimize_?(this.rootDiv_.find(".minimizer").click(this.onMinimizerClick_.bind(this)),this.setMinimized(this.isMinimized_)):this.setMinimized(!1)},e.prototype.getRoot=function(){return this.rootDiv_},e.prototype.setPanelTitle=function(a){this.panelTitle_=a,this.rootDiv_.find(".title-text").text(a)},e.prototype.onMinimizerClick_=function(){this.setMinimized(!this.isMinimized_)},e.prototype.setMinimized=function(a){var b=this.rootDiv_.find(".netsim-panel"),c=b.find(".minimizer");a?(b.addClass("minimized"),c.find(".fa").addClass("fa-plus-square").removeClass("fa-minus-square")):(b.removeClass("minimized"),c.find(".fa").addClass("fa-minus-square").removeClass("fa-plus-square")),this.isMinimized_=a},e.prototype.isMinimized=function(){return this.isMinimized_},e.prototype.addButton=function(a,b){$("<span>").addClass("netsim-button").addClass("secondary").html(a).click(b).appendTo(this.rootDiv_.find(".panel-controls"))},e.prototype.getBody=function(){return this.rootDiv_.find(".panel-body")}},{"../utils":292,"./NetSimPanel.html.ejs":197}],197:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div id="netsim-panel-',escape(instanceID),'"\n     class="netsim-panel ',escape(className),'">\n  <h1>\n    <div class="panel-controls"></div>\n    <div class="minimizer single-line-with-ellipsis">\n      '),canMinimize&&buf.push('\n        <i class="fa fa-minus-square"></i>\n      '),buf.push('\n      <span class="title-text">',escape(panelTitle),'</span>\n    </div>\n  </h1>\n  <div class="panel-body">\n  </div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:302}],176:[function(a,b){"use strict";var c=a("./NetSimEncodingControl.html.ejs"),d=a("./netsimConstants").EncodingType,e=b.exports=function(a,b,c){this.rootDiv_=a,this.levelConfig_=b,this.changeEncodingCallback_=c,this.checkboxes_=null,this.render()};e.prototype.render=function(){var a=$(c({level:this.levelConfig_}));this.rootDiv_.html(a),this.checkboxes_=this.rootDiv_.find('input[type="checkbox"][name="encoding_checkboxes"]'),this.checkboxes_.change(this.onCheckboxesChange_.bind(this))},e.prototype.onCheckboxesChange_=function(){var a=[];this.checkboxes_.filter(":checked").each(function(b,c){a.push(c.value)}),this.changeEncodingCallback_(a)},e.prototype.setEncodings=function(a){this.checkboxes_.each(function(b,c){$(c).attr("checked",a.indexOf(c.value)>-1)})};var f=function(a){return a.map(function(a){return"tr."+a}).join(", ")};e.hideRowsByEncoding=function(a,b){var c=[];for(var e in d)d.hasOwnProperty(e)&&-1===b.indexOf(d[e])&&c.push(d[e]);a.find(f(b)).show(),a.find(f(c)).hide()}},{"./NetSimEncodingControl.html.ejs":175,"./netsimConstants":235}],175:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(a,b){var c=["encoding_checkboxes_"+a];-1===level.showEncodingControls.indexOf(a)&&c.push("hidden-control"),buf.push('\n    <div class="',escape(c.join(" ")),'">\n      <input type="checkbox"\n             name="encoding_checkboxes"\n             id="encoding_checkboxes_',escape(a),'"\n             value="',escape(a),'"\n          />\n      <label for="encoding_checkboxes_',escape(a),'">',escape(b),"</label>\n    </div>\n    ")}buf.push("");var b=require("./netsimConstants").EncodingType,c=require("./locale");buf.push('\n<div class="netsim-encoding-selector">\n  <h1>',escape(c.encoding()),"</h1>\n  "),a(b.ASCII,c.ascii()),buf.push("\n  "),a(b.DECIMAL,c.decimal()),buf.push("\n  "),a(b.HEXADECIMAL,c.hexadecimal()),buf.push("\n  "),a(b.BINARY,c.binary()),buf.push("\n  "),a(b.A_AND_B,c.a_and_b()),buf.push("\n</div>")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./locale":232,"./netsimConstants":235,ejs:302}],162:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(a,b){buf.push('\n    <tr class="',escape(a),'">\n      <th nowrap class="',escape(g.ENCODING_LABEL),'">',escape(e(a)),'</th>\n      <td class="',escape(g.MESSAGE),'">',escape(b),"</td>\n    </tr>\n    ")}buf.push("");var b=require("./locale"),c=require("./netsimConstants"),d=require("./dataConverters"),e=require("./netsimUtils").getEncodingLabel,f=c.EncodingType,g=c.PacketUIColumnType;buf.push('\n<div class="scroll-area bit-log-scroll-area">\n  <div class="packet">\n    <table>\n      <tbody>\n        '),a(f.ASCII,d.binaryToAscii(binary,chunkSize)),a(f.DECIMAL,d.alignDecimal(d.binaryToDecimal(binary,chunkSize))),a(f.HEXADECIMAL,d.formatHex(d.binaryToHex(binary),chunkSize)),a(f.BINARY,d.formatBinary(binary,chunkSize)),a(f.A_AND_B,d.formatAB(d.binaryToAB(binary),chunkSize)),buf.push("\n      </tbody>\n    </table>\n  </div>\n  "),showReadWireButton&&buf.push('\n    <div class="panel-footer bit-log-panel-footer">\n      <div class="right-side-controls">\n        <span class="netsim-button large-button" id="read-wire-button">',escape(b.readWire()),"</span>\n      </div>\n    </div>\n  "),buf.push("\n</div>\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./dataConverters":230,"./locale":232,"./netsimConstants":235,"./netsimUtils":238,ejs:302}],230:[function(a,b,c){"use strict";a("../utils");var d=a("./netsimUtils");c.minifyAB=function(a){return a.replace(/[^AB]/gi,"").toUpperCase()},c.formatAB=function(a,b){return c.formatBinary(c.abToBinary(a),b).replace(/0/g,"A").replace(/1/g,"B")},c.minifyBinary=function(a){return a.replace(/[^01]/g,"")},c.formatBinary=function(a,b){if(0>=b)throw new RangeError("Parameter chunkSize must be greater than zero");for(var d=c.minifyBinary(a),e=[],f=0;f<d.length;f+=b)e.push(d.substr(f,b));return e.join(" ")},c.minifyHex=function(a){return a.replace(/[^0-9A-F]/gi,"").toUpperCase()},c.minifyDecimal=function(a){return a.replace(/(^\s+|\s+$|[^0-9\s])/g,"").replace(/\s+/g," ")},c.formatHex=function(a,b){if(0>=b)throw new RangeError("Parameter chunkSize must be greater than zero");if(b%4!==0)return a;for(var d=b/4,e=c.minifyHex(a),f=[],g=0;g<e.length;g+=d)f.push(e.substr(g,d));return f.join(" ")},c.alignDecimal=function(a){if(""===a.replace(/\D/g,""))return"";var b=c.minifyDecimal(a).split(/\s+/),d=b.reduce(function(a,b){return b.length>a?b.length:a},0),e="0".repeat(d);return b.map(function(a){return(e+a).slice(-d)}).join(" ")},c.abToInt=function(a){return c.binaryToInt(c.abToBinary(a))},c.intToAB=function(a,b){return c.binaryToAB(c.intToBinary(a,b))},c.abToBinary=function(a){return c.minifyAB(a).replace(/A/g,"0").replace(/B/g,"1")},c.binaryToAB=function(a){return c.minifyBinary(a).replace(/0/g,"A").replace(/1/g,"B")},c.binaryToInt=function(a){return parseInt(c.minifyBinary(a),2)};var e=function(a,b,c){if(0>=c)throw new RangeError("Output width must be greater than zero");return d.zeroPadLeft(a.toString(b),c)};c.intToBinary=function(a,b){return e(a,2,b)},c.hexToInt=function(a){return parseInt(c.minifyHex(a),16)},c.intToHex=function(a,b){return e(a,16,b).toUpperCase()},c.hexToBinary=function(a){for(var b=c.minifyHex(a),d="",e=0;e<b.length;e++)d+=c.intToBinary(c.hexToInt(b.substr(e,1)),4);return d},c.binaryToHex=function(a){for(var b,e=4,f=[],g=c.minifyBinary(a),h=0;h<g.length;h+=e)b=d.zeroPadRight(g.substr(h,e),e),f.push(c.intToHex(c.binaryToInt(b),1));return f.join("")},c.decimalToBinary=function(a,b){return""===a.replace(/\D/g,"")?"":c.minifyDecimal(a).split(/\s+/).map(function(a){return c.intToBinary(parseInt(a,10),b)}).join("")},c.binaryToDecimal=function(a,b){for(var e,f=[],g=c.minifyBinary(a),h=0;h<g.length;h+=b)e=d.zeroPadRight(g.substr(h,b),b),f.push(c.binaryToInt(e));return f.join(" ")},c.asciiToBinary=function(a,b){for(var d=[],e=0;e<a.length;e++)d.push(c.intToBinary(a.charCodeAt(e),b));return d.join("")},c.binaryToAscii=function(a,b){if(0>=b)throw new RangeError("Parameter byteSize must be greater than zero");for(var e,f=[],g=c.minifyBinary(a),h=0;h<g.length;h+=b)e=d.zeroPadRight(g.substr(h,b),b),f.push(String.fromCharCode(c.binaryToInt(e)));return f.join("")},c.binaryToAddressString=function(a,b){var d=c.minifyBinary(a);if(0===d.length)return"";var e=0;return b.split(/(\D+)/).map(function(a){var b=parseInt(a,10);if(isNaN(b))return a;var f=d.substr(e,b),g=f.length>0?c.binaryToInt(f):0;return e+=b,g.toString()}).join("")},c.addressStringToBinary=function(a,b){if(0===a.length)return"";for(var d,e=a.toString().split(/\D+/).map(function(a){return parseInt(a,10)}).filter(function(a){return!isNaN(a)}),f=b.split(/\D+/).map(function(a){return parseInt(a,10)}).filter(function(a){return!isNaN(a)}),g="",h=0;h<f.length;h++)d=h<e.length?e[h]:0,g+=c.intToBinary(d,f[h]);return g},c.formatBinaryForAddressHeader=function(a,b){var d=c.minifyBinary(a),e=b.split(/\D+/).map(function(a){return parseInt(a,10)}).filter(function(a){return!isNaN(a)}),f=[],g=0;e.forEach(function(a){var b=d.substr(g,a);b.length>0&&f.push(b),g+=a});var h=d.substr(g);return h.length>0&&f.push(h),f.join(" ")}},{"../utils":292,"./netsimUtils":238}],161:[function(a,b){"use strict";a("../utils");var c=a("./netsimConstants"),d=a("./netsimUtils"),e=a("./NetSimSlider"),f=b.exports=function(a,b,d){e.LogarithmicSlider.call(this,a,{onChange:b,onStop:d,value:1/0,min:4,max:128*c.BITS_PER_KILOBIT,upperBoundInfinite:!0}),this.render()};f.inherits(e.LogarithmicSlider),f.prototype.valueToLabel=function(a){return d.bitrateToLocalizedRoundedBitrate(a)}},{"../utils":292,"./NetSimSlider":216,"./netsimConstants":235,"./netsimUtils":238}],238:[function(a,b,c){"use strict";var d=a("../utils"),e=d.getLodash(),f=a("./locale"),g=a("./netsimConstants"),h=a("./NetSimLogger").getSingleton(),i=g.EncodingType;c.jQuerySvgElement=function(a){var b=$(document.createElementNS("http://www.w3.org/2000/svg",a));return b.addClass=function(a){var c=b.attr("class");return c?b.hasClass(a)||b.attr("class",c+" "+a):b.attr("class",a),b},b.removeClass=function(a){var c=b.attr("class");if(c){var d=c.split(/\s+/g).filter(function(b){return b!==a}).join(" ");b.attr("class",d)}return b},b.hasClass=function(a){var c=b.attr("class");return c&&c.split(/\s+/g).some(function(b){return b===a})},b.toggleClass=function(a,c){return c=d.valueOr(c,!b.hasClass(a)),c?b.addClass(a):b.removeClass(a),b},b},c.shouldShowTab=function(a,b){return a.showTabs.indexOf(b)>-1},c.getEncodingLabel=function(a){return a===i.ASCII?f.ascii():a===i.DECIMAL?f.decimal():a===i.HEXADECIMAL?f.hex():a===i.BINARY?f.binary():a===i.A_AND_B?f.a_and_b():""},c.forEachEnumValue=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c])};var j=[{jsVal:1/0,jsonVal:"Infinity"},{jsVal:-1/0,jsonVal:"-Infinity"},{jsVal:0/0,jsonVal:"NaN"},{jsVal:void 0,jsonVal:"undefined"}],k=function(a){return a!==a};c.serializeNumber=function(a){var b=e.find(j,function(b){return b.jsVal===a||k(b.jsVal)&&k(a)});return b?b.jsonVal:a},c.deserializeNumber=function(a){var b=e.find(j,function(b){return b.jsonVal===a});return b?b.jsVal:a},c.scrubHeaderSpecForBackwardsCompatibility=function(a){var b=!1,c=[];return a.forEach(function(a){"string"==typeof a?c.push(a):null!==a&&"object"==typeof a&&(c.push(a.key),b=!0)}),b&&h.warn("Converting old header specification format to new format. This level should be updated to use the new format."),c},c.scrubLevelConfiguration_=function(a){var b=e.clone(a,!0);return b.routerExpectsPacketHeader=c.scrubHeaderSpecForBackwardsCompatibility(b.routerExpectsPacketHeader),b.clientInitialPacketHeader=c.scrubHeaderSpecForBackwardsCompatibility(b.clientInitialPacketHeader),b.addressFormat=b.addressFormat.toString(),b.defaultPacketSizeLimit=c.deserializeNumber(b.defaultPacketSizeLimit),b.defaultBitRateBitsPerSecond=c.deserializeNumber(b.defaultBitRateBitsPerSecond),b.defaultChunkSizeBits=c.deserializeNumber(b.defaultChunkSizeBits),b.defaultRouterBandwidth=c.deserializeNumber(b.defaultRouterBandwidth),b.defaultRouterMemory=c.deserializeNumber(b.defaultRouterMemory),Object.keys(b).filter(function(a){return!/_/.test(a)}).forEach(function(a){var c=j.some(function(c){return b[a]===c.jsonVal});c&&h.warn("Level option '"+a+"' has unconverted string value '"+b[a]+"'")}),b},c.bitsToLocalizedRoundedBytesize=function(a){if(1/0===a)return f.unlimited();var b=Math.floor(a/g.BITS_PER_GIGABYTE);if(b>0)return f.x_GBytes({x:b});var c=Math.floor(a/g.BITS_PER_MEGABYTE);if(c>0)return f.x_MBytes({x:c});var d=Math.floor(a/g.BITS_PER_KILOBYTE);if(d>0)return f.x_KBytes({x:d});var e=Math.floor(a/g.BITS_PER_BYTE);return e>0?f.x_Bytes({x:e}):f.x_bits({x:a})},c.bitrateToLocalizedRoundedBitrate=function(a){if(1/0===a)return f.unlimited();var b=Math.floor(a/g.BITS_PER_GIGABIT);if(b>0)return f.x_Gbps({x:b});var c=Math.floor(a/g.BITS_PER_MEGABIT);if(c>0)return f.x_Mbps({x:c});var d=Math.floor(a/g.BITS_PER_KILOBIT);if(d>0)return f.x_Kbps({x:d});var e=Math.floor(100*a)/100;return f.x_bps({x:e})},c.zeroPadLeft=function(a,b){var c="0".repeat(b);return(c+a).slice(-b)},c.zeroPadRight=function(a,b){var c="0".repeat(b);return(a+c).substr(0,b)}},{"../utils":292,"./NetSimLogger":186,"./locale":232,"./netsimConstants":235}],186:[function(a,b){"use strict";var c=b.exports=function(a,b){this.outputConsole_=a,this.log_=function(){},this.info=function(){},this.warn=function(){},this.error=function(){},this.setVerbosity(void 0===b?d.VERBOSE:b)},d={NONE:0,ERROR:1,WARN:2,INFO:3,VERBOSE:4};c.LogLevel=d;var e;c.getSingleton=function(){return void 0===e&&(e=new c(console,d.VERBOSE)),e},c.prototype.setVerbosity=function(a){this.log_=this.outputConsole_&&this.outputConsole_.log?Function.prototype.bind.call(this.outputConsole_.log,this.outputConsole_):function(){},this.info=a>=d.INFO?this.outputConsole_&&this.outputConsole_.info?Function.prototype.bind.call(this.outputConsole_.info,this.outputConsole_):this.log_:function(){},this.warn=a>=d.WARN?this.outputConsole_&&this.outputConsole_.warn?Function.prototype.bind.call(this.outputConsole_.warn,this.outputConsole_):this.log_:function(){},this.error=a>=d.ERROR?this.outputConsole_&&this.outputConsole_.error?Function.prototype.bind.call(this.outputConsole_.error,this.outputConsole_):this.log_:function(){}},c.prototype.log=function(a,b){switch(void 0===b&&(b=d.INFO),b){case d.ERROR:this.error(a);break;case d.WARN:this.warn(a);break;case d.INFO:this.info(a);break;default:this.log_(a)}}},{}],235:[function(a,b,c){"use strict";c.BITS_PER_NIBBLE=4,c.BITS_PER_BYTE=8,c.BITS_PER_KILOBYTE=1024*c.BITS_PER_BYTE,c.BITS_PER_MEGABYTE=1024*c.BITS_PER_KILOBYTE,c.BITS_PER_GIGABYTE=1024*c.BITS_PER_MEGABYTE,c.BITS_PER_KILOBIT=1024,c.BITS_PER_MEGABIT=1024*c.BITS_PER_KILOBIT,c.BITS_PER_GIGABIT=1024*c.BITS_PER_MEGABIT,c.NodeType={CLIENT:"client",ROUTER:"router"},c.MessageGranularity={PACKETS:"packets",BITS:"bits"},c.DnsMode={NONE:"none",MANUAL:"manual",AUTOMATIC:"automatic"},c.EncodingType={ASCII:"ascii",DECIMAL:"decimal",HEXADECIMAL:"hexadecimal",BINARY:"binary",A_AND_B:"a_and_b"},c.NetSimTabType={INSTRUCTIONS:"instructions",MY_DEVICE:"my_device",ROUTER:"router",DNS:"dns"},c.PacketUIColumnType={ENCODING_LABEL:"encodingLabel",TO_ADDRESS:"toAddress",FROM_ADDRESS:"fromAddress",PACKET_INFO:"packetInfo",MESSAGE:"message"}},{}],216:[function(a,b){"use strict";var c=a("../utils"),d=a("./NetSimSlider.html.ejs"),e=a("./locale"),f=0,g=100,h=b.exports=function(a,b){if(this.instanceID_=h.uniqueIDCounter,h.uniqueIDCounter++,this.rootDiv_=a,this.changeCallback_=c.valueOr(b.onChange,function(){}),this.stopCallback_=c.valueOr(b.onStop,function(){}),this.minValue_=c.valueOr(b.min,f),this.maxValue_=c.valueOr(b.max,g),this.value_=c.valueOr(b.value,this.minValue_),this.isUpperBoundInfinite_=c.valueOr(b.upperBoundInfinite,!1),this.isLowerBoundInfinite_=c.valueOr(b.lowerBoundInfinite,!1),this.step_=c.valueOr(b.step,1),0===this.step_)throw new Error("NetSimSlider does not support zero step values.");if(this.step_%1!==0)throw new Error("NetSimSlider does not support non-integer step values.  Use DecimalPrecisionSlider instead.");this.isDisabled_=c.valueOr(b.isDisabled,!1)};h.uniqueIDCounter=0,h.prototype.isStepNegative_=function(){return this.step_<0},h.prototype.render=function(){var a=this.isLowerBoundInfinite_?-1/0:this.minValue_,b=this.isUpperBoundInfinite_?1/0:this.maxValue_,c=this.valueToSliderPosition(this.isStepNegative_()?b:a),e=this.valueToSliderPosition(this.isStepNegative_()?a:b),f=$(d({instanceID:this.instanceID_,minValue:this.valueToShortLabel(this.isStepNegative_()?b:a),maxValue:this.valueToShortLabel(this.isStepNegative_()?a:b)}));this.rootDiv_.html(f),this.rootDiv_.find(".slider").slider({value:this.valueToSliderPosition(this.value_),min:c,max:e,step:Math.abs(this.step_),slide:this.onSliderValueChange_.bind(this),stop:this.onSliderStop_.bind(this),disabled:this.isDisabled_}),(this.isLowerBoundInfinite_||this.isUpperBoundInfinite_)&&this.rootDiv_.find(".slider-labels").addClass("wide-labels"),this.setLabelFromValue_(this.value_)},h.prototype.disable=function(){this.isDisabled_=!0,this.rootDiv_.find(".slider").slider("option","disabled",!0)},h.prototype.enable=function(){this.isDisabled_=!1,this.rootDiv_.find(".slider").slider("option","disabled",!1)},h.prototype.setValue=function(a){this.value_!==a&&(this.value_=a,this.rootDiv_.find(".slider").slider("option","value",this.valueToSliderPosition(a)),this.setLabelFromValue_(a))},h.prototype.onSliderValueChange_=function(a,b){var c=this.sliderPositionToValue(b.value);this.value_=c,this.setLabelFromValue_(c),this.changeCallback_(c)},h.prototype.onSliderStop_=function(){this.stopCallback_(this.value_)},h.prototype.setLabelFromValue_=function(a){this.rootDiv_.find(".slider-value").text(this.valueToLabel(a))},h.prototype.valueToSliderPosition=function(a){return this.isUpperBoundInfinite_&&a>this.maxValue_?this.valueToSliderPosition(this.maxValue_)+this.step_:this.isLowerBoundInfinite_&&a<this.minValue_?this.valueToSliderPosition(this.minValue_)-this.step_:Math.max(this.minValue_,Math.min(this.maxValue_,a))*(this.isStepNegative_()?-1:1)},h.prototype.sliderPositionToValue=function(a){return this.isStepNegative_()?a<this.valueToSliderPosition(this.maxValue_)?this.isUpperBoundInfinite_?1/0:this.maxValue_:a>this.valueToSliderPosition(this.minValue_)?this.isLowerBoundInfinite_?-1/0:this.minValue_:-a:a>this.valueToSliderPosition(this.maxValue_)?this.isUpperBoundInfinite_?1/0:this.maxValue_:a<this.valueToSliderPosition(this.minValue_)?this.isLowerBoundInfinite_?-1/0:this.minValue_:a},h.prototype.valueToLabel=function(a){return 1/0===a||a===-1/0?e.unlimited():a},h.prototype.valueToShortLabel=function(a){return this.valueToLabel(a)},h.DecimalPrecisionSlider=function(a,b){this.precision_=c.valueOr(b.precision,2),b.step=b.step*Math.pow(10,this.precision_),h.call(this,a,b)},h.DecimalPrecisionSlider.inherits(h),h.DecimalPrecisionSlider.prototype.valueToSliderPosition=function(a){return h.prototype.valueToSliderPosition.call(this,a)*Math.pow(10,this.precision_)},h.DecimalPrecisionSlider.prototype.sliderPositionToValue=function(a){return h.prototype.sliderPositionToValue.call(this,a)/Math.pow(10,this.precision_)};var i=1,j=2;h.LogarithmicSlider=function(a,b){b.min=c.valueOr(b.min,i),h.call(this,a,b),this.logBase_=c.valueOr(b.logBase,j),this.lnLogBase_=Math.log(this.logBase_),this.calculateSliderBounds_()},h.LogarithmicSlider.inherits(h),h.LogarithmicSlider.prototype.calculateSliderBounds_=function(){this.maxSliderPosition=this.logFloor_(this.maxValue_),Math.pow(this.logBase_,this.maxSliderPosition)!==this.maxValue_&&(this.maxSliderPosition+=this.step_),this.minSliderPosition=this.logFloor_(this.minValue_),this.infinitySliderPosition=this.maxSliderPosition+this.step_,this.negInfinitySliderPosition=this.minSliderPosition-this.step_},h.LogarithmicSlider.prototype.logFloor_=function(a){var b=1e-7;return Math.floor(b+Math.log(a)/this.lnLogBase_)},h.LogarithmicSlider.prototype.valueToSliderPosition=function(a){return a>this.maxValue_?this.isUpperBoundInfinite_?this.infinitySliderPosition:this.maxSliderPosition:a===this.maxValue_?this.maxSliderPosition:a<this.minValue_?this.isLowerBoundInfinite_?this.negInfinitySliderPosition:this.minSliderPosition:a===this.minValue_?this.minSliderPosition:Math.max(this.minSliderPosition,this.logFloor_(a))},h.LogarithmicSlider.prototype.sliderPositionToValue=function(a){return a>this.maxSliderPosition?this.isUpperBoundInfinite_?1/0:this.maxValue_:a===this.maxSliderPosition?this.maxValue_:a<this.minSliderPosition?this.isLowerBoundInfinite_?-1/0:this.minValue_:a===this.minSliderPosition?this.minValue_:Math.pow(this.logBase_,a)}},{"../utils":292,"./NetSimSlider.html.ejs":215,"./locale":232}],232:[function(a,b){b.exports=window.blockly.netsim_locale},{}],215:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div id="netsim_slider_',escape(instanceID),'" class="netsim-slider">\n  <div class="slider-inline-wrap">\n    <div class="slider"></div>\n    <div class="slider-labels">\n      <div class="max-value">',escape(maxValue),'</div>\n      <div class="min-value">',escape(minValue),'</div>\n      <div class="current-value">\n        <label><span class="slider-value"></span></label>\n      </div>\n    </div>\n  </div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:302}],160:[function(a,b){"use strict";var c=b.exports=function(){this.isReady=!1,this.whenReadyCallbacks_=[],this.id=void 0,this.name=""};c.currentUser_=null,c.getCurrentUser=function(){return c.currentUser_||(c.currentUser_=new c,$.ajax({url:"/v2/user",type:"get",dataType:"json",success:function(a){c.currentUser_.initialize(a)},error:function(){c.currentUser_.initialize({isSignedIn:!1})}})),c.currentUser_},c.prototype.initialize=function(a){this.id=a.id,this.name=a.name,this.isSignedIn=a.isSignedIn!==!1,this.isReady=!0,this.whenReadyCallbacks_.forEach(function(a){a(this)}.bind(this)),this.whenReadyCallbacks_.length=0},c.prototype.whenReady=function(a){this.isReady?a(this):this.whenReadyCallbacks_.push(a)}},{}],85:[function(a,b){"use strict";a("./utils");var c=b.exports,d={NOT_STARTED:0,WORKING:1,SUCCESS:2,FAILURE:3},e=c.Command=function(){this.status_=d.NOT_STARTED};e.prototype.isStarted=function(){return this.status_!==d.NOT_STARTED},e.prototype.isFinished=function(){return this.succeeded()||this.failed()},e.prototype.succeeded=function(){return this.status_===d.SUCCESS},e.prototype.failed=function(){return this.status_===d.FAILURE},e.prototype.begin=function(){this.status_=d.WORKING,this.onBegin_()},e.prototype.succeed=function(){if(!this.isStarted())throw new Error("Command cannot succeed before it begins.");this.status_=d.SUCCESS,this.onEnd_()},e.prototype.fail=function(){if(!this.isStarted())throw new Error("Command cannot fail before it begins.");this.status_=d.FAILURE,this.onEnd_()},e.prototype.onBegin_=function(){},e.prototype.tick=function(){},e.prototype.onEnd_=function(){};var f=c.CommandSequence=function(a){e.call(this),this.commandList_=a,this.currentCommandIndex_=0};f.inherits(e),f.prototype.onBegin_=function(){this.currentCommandIndex_=0,0===this.commandList_.length&&this.succeed()},f.prototype.currentCommand=function(){return this.commandList_[this.currentCommandIndex_]},f.prototype.tick=function(a){for(;this.isStarted()&&!this.isFinished()&&this.currentCommand();)if(this.currentCommand().isStarted()?this.currentCommand().tick(a):this.currentCommand().begin(),this.currentCommand().succeeded())this.currentCommandIndex_++,void 0===this.currentCommand()&&this.succeed();else{if(!this.currentCommand().failed())break;this.fail()}}},{"./utils":292}],83:[function(a,b){"use strict";a("./utils");var c=function(a){this.apiBaseUrl_=a};c.prototype.get=function(a,b){$.ajax({url:this.apiBaseUrl_+a,type:"get",dataType:"json",success:function(a){b(null,a)},error:function(a,c,d){b(new Error("textStatus: "+c+"; errorThrown: "+d),null)}})},c.prototype.readAll=function(a){this.get("",a)},c.prototype.read=function(a,b){this.get("/"+a,b)},c.prototype.post=function(a,b,c){$.ajax({url:this.apiBaseUrl_+a,type:"post",contentType:"application/json; charset=utf-8",data:JSON.stringify(b),success:function(){c(null,null)},error:function(a,b,d){c(new Error("textStatus: "+b+"; errorThrown: "+d),null)}})},c.prototype.postToGet=function(a,b,c){$.ajax({url:this.apiBaseUrl_+a,type:"post",contentType:"application/json; charset=utf-8",data:JSON.stringify(b),success:function(a){c(null,a)},error:function(a,b,d){c(new Error("textStatus: "+b+"; errorThrown: "+d),null)}})},c.prototype.create=function(a,b){this.postToGet("",a,b)},c.prototype["delete"]=function(a,b){$.ajax({url:this.apiBaseUrl_+"/"+a,type:"delete",success:function(){b(null,null)},error:function(a,c,d){b(new Error("textStatus: "+c+"; errorThrown: "+d),null)}})},c.prototype.update=function(a,b,c){this.post("/"+a,b,c)},c.prototype.synchronousDelete=function(a){var b=null;return $.ajax({url:this.apiBaseUrl_+"/"+a,type:"delete",async:!1,error:function(a,c,d){b=new Error("textStatus: "+c+"; errorThrown: "+d)}}),b},c.prototype.set=function(a,b,c){this.post("/"+a,b,c)};var d=function(){c.call(this,"/v3/channels")};d.inherits(c);var e=function(a,b){c.call(this,"/v3/shared-tables/"+a+"/"+b)};e.inherits(c);var f=function(a,b){c.call("/v3/user-tables/"+a+"/"+b)};f.inherits(c);var g=function(a){c.call("/v3/shared-properties/"+a)};g.inherits(c);var h=function(a){c.call("/v3/user-properties/"+a)};h.inherits(c),b.exports={ChannelsApi:d,SharedTableApi:e,UserTableApi:f,PropertyBagApi:g,UserPropertyBagApi:h}},{"./utils":292}],3:[function(a,b){"use strict";var c=a("./ObservableEvent"),d=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now,e=30,f=1e3/e,g=b.exports=function(){this.enabled=!1,this.clock=new g.Clock,this.tick_=this.buildTickMethod_(),this.tick=new c,this.render=new c};g.Clock=function(){this.time=d(),this.deltaTime=0},g.prototype.buildTickMethod_=function(){var a,b=this;return a=window.requestAnimationFrame?function(c){b.enabled&&(b.clock.deltaTime=c-b.clock.time,b.clock.time=c,b.tick.notifyObservers(b.clock),b.render.notifyObservers(b.clock),requestAnimationFrame(a))}:function(){if(b.enabled){var c=d();b.clock.deltaTime=c-b.clock.time,b.clock.time=c,b.tick.notifyObservers(b.clock),b.render.notifyObservers(b.clock),setTimeout(a,f-b.clock.deltaTime)}}},g.prototype.begin=function(){this.enabled=!0,this.clock.time=d(),this.tick_(this.clock.time)},g.prototype.end=function(){this.enabled=!1}},{"./ObservableEvent":1}],1:[function(a,b){"use strict";var c=b.exports=function(){this.observerList_=[]
};c.prototype.register=function(a){var b={toCall:a};return Object.freeze(b),this.observerList_.push(b),b},c.prototype.unregister=function(a){for(var b=0;b<this.observerList_.length;b++)if(a===this.observerList_[b])return this.observerList_.splice(b,1),!0;return!1},c.prototype.notifyObservers=function(){var a=Array.prototype.slice.call(arguments,0);this.observerList_.forEach(function(b){b.toCall.apply(void 0,a)})}},{}]},{},[233]);