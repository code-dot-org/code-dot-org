require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({36:[function(a){var b=a("../appMain");window.Calc=a("./calc");var c=a("./blocks"),d=a("../skins"),e=a("./levels");window.calcMain=function(a){a.skinsModule=d,a.blocksModule=c,b(window.Calc,e,a)}},{"../appMain":3,"../skins":142,"./blocks":29,"./calc":30,"./levels":35}],30:[function(a,b){"use strict";function c(a,b){if(a instanceof B.Equation&&(a=a.expression),b instanceof B.Equation&&(b=b.expression),"string"==typeof a){var c=a!==b&&void 0!==b;return[new C(a,c)]}return a?b?a.getTokenListDiff(b):a.getTokenList(!1):null}function d(a){var b=a.computeEquation();if(b&&b.expression){var d,e=0,f=a.hasSingleFunction();if(!f){var g=a.sortedEquations();g.forEach(function(a){if(a.isFunction()&&g.length>1)throw new Error("Calc doesn't support goal with multiple functions or mixed functions/vars");d=a.expression.getTokenList(!1),l("answerExpression",a.signature,d,e++)})}d=b.expression.getTokenList(!1);var h=a.evaluate();f&&(d=d.concat(c(" = "+h.toString()))),l("answerExpression",b.signature,d,e)}}function e(a){if(a){if(0!==Blockly.mainBlockSpace.getTopBlocks().length)throw new Error("generateTargetExpression shouldn't be called with blocksif we already have blocks in the workspace");t.loadBlocks(a)}var b=new B(Blockly.mainBlockSpace.getTopBlocks());return Blockly.mainBlockSpace.getTopBlocks().forEach(function(a){a.dispose()}),b}function f(a){return a===E.QUESTION_MARKS_IN_NUMBER_FIELD||a===E.EMPTY_FUNCTIONAL_BLOCK||a===E.EXTRA_TOP_BLOCKS_FAIL}function g(){if(J.message=void 0,t.hasExtraTopBlocks())return J.result=F.FAILURE,void(J.testResults=E.EXTRA_TOP_BLOCKS_FAIL);if(t.hasUnfilledBlock()){J.result=F.FAILURE,J.testResults=E.EMPTY_FUNCTIONAL_BLOCK;var a=y.find(Blockly.mainBlockSpace.getTopBlocks(),function(a){return"functional_compute"===a.type});return void(J.message=a&&!a.getInputTargetBlock("ARG1")?u.emptyComputeBlock():u.emptyFunctionalBlock())}if(t.hasQuestionMarksInNumberField())return J.result=F.FAILURE,void(J.testResults=E.QUESTION_MARKS_IN_NUMBER_FIELD);if(J.userSet=new B(Blockly.mainBlockSpace.getTopBlocks()),J.failedInput=null,q.freePlay||q.edit_blocks)J.result=F.SUCCESS,J.testResults=E.FREE_PLAY;else{var b=s.evaluateResults_(J.targetSet,J.userSet);J.result=b.result,J.testResults=b.testResults,J.message=b.message,J.failedInput=b.failedInput}J.testResults!==E.LEVEL_INCOMPLETE_FAIL||J.message||(J.message=u.levelIncompleteError())}function h(){var a;j();var b=J.userSet.computeEquation();if(null!==b&&null!==b.expression){var d,e=J.targetSet.hasSingleFunction(),f=0;J.userSet.sortedEquations().forEach(function(a){var b=e?null:J.targetSet.getEquation(a.name);d=c(a,b),l("userExpression",a.signature,d,f++,"errorToken")});var g=(b&&b.expression.getType(),J.targetSet.computeEquation());d=c(b,g),a=J.userSet.evaluate().toString();var h=null===J.targetSet.computeEquation()?a:J.targetSet.evaluate().toString();if(d=d.concat(c(" = "),c(a,h)),l("userExpression",null,d,f++,"errorToken"),J.failedInput){for(var i=b.expression.clone(),k=0;k<i.numChildren();k++)i.setChildValue(k,J.failedInput[k]);a=J.userSet.evaluateWithExpression(i).toString(),d=c(i).concat(c(" = ")).concat(c(a," ")),l("userExpression",null,d,f++,"errorToken")}}}function i(){J.animating=!1,o()}function j(){for(var a=document.getElementById("userExpression"),b=a.childNodes.length-1;b>=0;b--)a.removeChild(a.childNodes[b])}function k(a){var b=J.userSet.computeEquation();if(!b)throw new Error("require user expression");var c=b.expression;if(!c)return!0;var d=!1;if(J.userSet.hasVariablesOrFunctions()||J.targetSet.hasVariablesOrFunctions())throw new Error("Can't animate if either user/target have functions/vars");j();for(var e=c.clone(),f=e,g=0,h=0;a>=h&&!d;h++){var i;if(g===a)i=e.getTokenListDiff(f);else if(g+1===a){var k=e.getDeepestOperation();k&&t.highlight("block_id_"+k.blockId),i=e.getTokenList(!0)}else i=e.getTokenList(!1);l("userExpression",null,i,g,"markedToken"),f=e.clone(),e.collapse()?g++:h===g+1&&(d=!0)}return d}function l(a,b,c,d,e){var f=document.getElementById(a),g=document.createElementNS(Blockly.SVG_NS,"g");f.appendChild(g);var h,i=0;b&&(h=m(g,b+" = ",i,null),i+=h);for(var j=0;j<c.length;j++)h=m(g,c[j].str,i,c[j].marked&&e),i+=h;var k=(H-g.getBoundingClientRect().width)/2,l=d*I;g.setAttribute("transform","translate("+k+", "+l+")")}function m(a,b,c,d){var e,f;return e=document.createElementNS(Blockly.SVG_NS,"text"),e.textContent=b.replace(/ /g,"_"),a.appendChild(e),f=e.getComputedTextLength?e.getComputedTextLength():0,e.textContent=b,e.setAttribute("x",c+f/2),e.setAttribute("text-anchor","middle"),d&&e.setAttribute("class",d),f}function n(a){for(var b=document.getElementById(a).cloneNode(!0),c=b.getElementsByTagName("*"),d=0;d<c.length;d++){var e=c[d];e.removeAttribute("id")}return b}function o(){if(J.response&&!J.animating){q.extraTopBlocks=u.extraTopBlocks();var a=null;f(J.testResults)||(a=n("svgCalc"));var b={app:"Calc",skin:r.id,response:J.response,level:q,feedbackType:J.testResults,appStrings:{reinfFeedbackMsg:u.reinfFeedbackMsg()},appDiv:a};J.message&&(b.message=J.message),t.displayFeedback(b)}}function p(a){var b=document.getElementById("runButton");b.disabled=!1,J.response=a,o()}var q,r,s=b.exports,t=a("../StudioApp").singleton,s=b.exports,u=(a("../../locale/current/common"),a("../../locale/current/calc")),v=(a("../skins"),a("./levels"),a("./api"),a("../templates/page.html")),w=a("../dom"),x=a("../block_utils"),y=a("../utils").getLodash(),z=a("../timeoutList"),A=a("./expressionNode"),B=a("./equationSet"),C=A.Token,D=a("./inputIterator"),E=t.TestResults,F=t.ResultType;t.setCheckForEmptyBlocks(!1);var G=400,H=400,I=20,J={targetSet:null,userSet:null,animating:!1,response:null,message:null,result:null,testResults:null,failedInput:null};s.appState_=J;var K=2e3;s.init=function(b){r=b.skin,q=b.level,q.scale&&void 0!==q.scale.stepSpeed&&(K=q.scale.stepSpeed),b.grayOutUndeletableBlocks=!0,b.forceInsertTopBlock="functional_compute",b.enableShowCode=!1,b.html=v({assetUrl:t.assetUrl,data:{localeDirection:t.localeDirection(),visualization:a("./visualization.html")(),controls:a("./controls.html")({assetUrl:t.assetUrl}),blockUsed:void 0,idealBlockNumber:void 0,editCode:q.editCode,blockCounterClass:"block-counter-default"}}),b.loadAudio=function(){t.loadAudio(r.winSound,"win"),t.loadAudio(r.startSound,"start"),t.loadAudio(r.failureSound,"failure")},b.afterInject=function(){var a=document.getElementById("svgCalc");a.setAttribute("width",H),a.setAttribute("height",G),q.freePlay&&document.getElementById("goalHeader").setAttribute("visibility","hidden"),Blockly.BROKEN_CONTROL_POINTS=!1,Blockly.JavaScript.addReservedWords("Calc,code");var c=q.solutionBlocks;q.solutionBlocks&&""!==q.solutionBlocks&&(c=x.forceInsertTopBlock(q.solutionBlocks,b.forceInsertTopBlock)),J.targetSet=e(c),d(J.targetSet);var f=document.getElementById("visualizationColumn");f.style.width="400px";var g=document.getElementById("resetButton");w.addClickTouchEvent(g,s.resetButtonClick)},t.init(b)},t.runButtonClick=function(){t.toggleRunReset("reset"),Blockly.mainBlockSpace.traceOn(!0),t.attempts++,s.execute()},s.resetButtonClick=function(){J.animating=!1,J.response=null,J.message=null,J.result=null,J.testResults=null,J.failedInput=null,z.clearTimeouts(),j()},s.evaluateFunction_=function(a,b){var c={result:F.UNSET,testResults:E.NO_TESTS_RUN,message:void 0,failedInput:null},d=a.computeEquation().expression.clone(),e=b.computeEquation(),f=e&&e.expression;if(!d.hasSameSignature(f)||!b.hasSingleFunction())return c.result=F.FAILURE,c.testResults=E.LEVEL_INCOMPLETE_FAIL,c;if(a.evaluateWithExpression(d)!==b.evaluateWithExpression(d))return c.result=F.FAILURE,c.testResults=E.LEVEL_INCOMPLETE_FAIL,c;for(var g=y.range(1,101).concat(y.range(-0,-101,-1)),h=d.numChildren(),i=new D(g,h),j=function(a,b){d.setChildValue(b,a)};i.remaining()>0&&!c.failedInput;){var k=i.next();k.forEach(j),a.evaluateWithExpression(d)!==b.evaluateWithExpression(d)&&(c.failedInput=y.clone(k))}return c.failedInput?(c.result=F.FAILURE,c.testResults=E.APP_SPECIFIC_FAIL,c.message=u.failedInput()):a.computeEquation().expression.isIdenticalTo(b.computeEquation().expression)?(c.result=F.SUCCESS,c.testResults=E.ALL_PASS):(c.result=F.FAILURE,c.testResults=E.APP_SPECIFIC_FAIL,c.message=u.wrongInput()),c},s.evaluateResults_=function(a,b){var c,d,e,f={result:F.UNSET,testResults:E.NO_TESTS_RUN,message:void 0,failedInput:null};if(a.hasSingleFunction())return s.evaluateFunction_(a,b);if(b.hasVariablesOrFunctions()||a.hasVariablesOrFunctions())return a.isIdenticalTo(b)?(f.result=F.SUCCESS,f.testResults=E.ALL_PASS):(f.result=F.FAILURE,f.testResults=E.LEVEL_INCOMPLETE_FAIL),f;if(d=b.computeEquation(),e=a.computeEquation(),c=a.isIdenticalTo(b))f.result=F.SUCCESS,f.testResults=E.ALL_PASS;else{f.result=F.FAILURE;var g=f.result===F.SUCCESS;f.testResults=t.getTestResults(g),e&&d.expression&&d.expression.isEquivalentTo(e.expression)&&(f.testResults=E.APP_SPECIFIC_FAIL,f.message=u.equivalentExpression())}return f},s.execute=function(){g();var a=Blockly.Xml.blockSpaceToDom(Blockly.mainBlockSpace),b=Blockly.Xml.domToText(a),c={app:"calc",level:q.id,builder:q.builder,result:J.result===F.SUCCESS,testResult:J.testResults,program:encodeURIComponent(b),onComplete:p};return t.report(c),t.playAudio(J.result===F.SUCCESS?"win":"failure"),f(J.testResults)?o():(J.animating=!0,void(J.result!==F.SUCCESS||J.userSet.hasVariablesOrFunctions()||q.edit_blocks?(h(),z.setTimeout(function(){i()},K)):s.step(0)))},s.step=function(a){var b=k(a);z.setTimeout(function(){b?(k(a+1),i()):s.step(a+1)},K)},s.__testonly__={displayGoal:d,appState:J}},{"../../locale/current/calc":187,"../../locale/current/common":188,"../StudioApp":2,"../block_utils":17,"../dom":44,"../skins":142,"../templates/page.html":163,"../timeoutList":169,"../utils":183,"./api":28,"./controls.html":31,"./equationSet":32,"./expressionNode":33,"./inputIterator":34,"./levels":35,"./visualization.html":37}],37:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../../locale/current/calc");buf.push('\n\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="svgCalc">\n  <rect x="0" y="0" width="400" height="300" fill="#33ccff"/>\n  <rect x="0" y="300" width="400" height="100" fill="#996633"/>\n  <text x="0" y="30" class="calcHeader">',escape(a.yourExpression()),'</text>\n  <g id="userExpression" class="expr" transform="translate(0, 100)">\n  </g>\n  <text x="0" y="330" class="calcHeader" id="goalHeader">',escape(a.goal()),'</text>\n  <g id="answerExpression" class="expr" transform="translate(0, 350)">\n  </g>\n</svg>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/calc":187,ejs:204}],35:[function(a,b){var c=(a("../../locale/current/calc"),a("../block_utils"));b.exports={example1:{solutionBlocks:c.calcBlockXml("functional_times",[c.calcBlockXml("functional_plus",[1,2]),c.calcBlockXml("functional_plus",[3,4])]),ideal:1/0,toolbox:c.createToolbox(c.blockOfType("functional_plus")+c.blockOfType("functional_minus")+c.blockOfType("functional_times")+c.blockOfType("functional_dividedby")+c.blockOfType("functional_math_number")+'<block type="functional_math_number_dropdown">  <title name="NUM" config="0,1,2,3,4,5,6,7,8,9,10">???</title></block>'),startBlocks:"",requiredBlocks:"",freePlay:!1},custom:{answer:"",ideal:1/0,toolbox:"",startBlocks:"",requiredBlocks:"",freePlay:!1}}},{"../../locale/current/calc":187,"../block_utils":17}],34:[function(a,b){var c=function(a,b){this.numParams_=b,this.remaining_=Math.pow(a.length,b),this.availableValues_=a,this.indices_=[-1];for(var c=1;b>c;c++)this.indices_[c]=0};b.exports=c,c.prototype.next=function(){if(0===this.remaining_)throw new Error("empty");var a,b=0;do a=!1,this.indices_[b]++,this.indices_[b]===this.availableValues_.length&&(this.indices_[b]=0,b++,a=!0);while(a&&b<this.numParams_);return this.remaining_--,this.indices_.map(function(a){return this.availableValues_[a]},this)},c.prototype.remaining=function(){return this.remaining_}},{}],32:[function(a,b){function c(a){var b;if(!a)return null;var d=a.getChildren()[0];switch(a.type){case"functional_compute":return d?c(d):new f(null,[],null);case"functional_plus":case"functional_minus":case"functional_times":case"functional_dividedby":var g=a.getTitles()[0].getValue(),h=["ARG1","ARG2"].map(function(b){var d=a.getInputTargetBlock(b);return d?c(d).expression:0});return new f(null,[],new e(g,h,a.id));case"functional_math_number":case"functional_math_number_dropdown":var i=a.getTitleValue("NUM")||0;return"???"===i&&(i=0),new f(null,[],new e(parseFloat(i),[],a.id));case"functional_call":b=a.getCallName();var j=Blockly.Procedures.getDefinition(b,Blockly.mainBlockSpace);if(j.isVariable())return new f(null,[],new e(b));for(var k,l,m=[],n=0;k=a.getInput("ARG"+n);n++)l=k.connection.targetBlock(),m.push(l?c(l).expression:new e(0));return new f(null,[],new e(b,m));case"functional_definition":b=a.getTitleValue("NAME");var o=d?c(d).expression:new e(0);return new f(b,a.getVars(),o);case"functional_parameters_get":return new f(null,[],new e(a.getTitleValue("VAR")));case"functional_example":return null;default:throw"Unknown block type: "+a.type}}var d=a("../utils").getLodash(),e=a("./expressionNode"),f=function(a,b,c){this.name=a,this.params=b||[],this.expression=c,this.signature=this.name,this.params.length>0&&(this.signature+="("+this.params.join(",")+")")};f.prototype.isFunction=function(){return this.params.length>0};var g=function(a){this.compute_=null,this.equations_=[],a&&a.forEach(function(a){var b=c(a);b&&this.addEquation_(b)},this)};g.Equation=f,b.exports=g,g.prototype.addEquation_=function(a){if(a.name){if(this.getEquation(a.name))throw new Error("equation already exists: "+a.name);this.equations_.push(a)}else{if(this.compute_)throw new Error("compute expression already exists");this.compute_=a}},g.prototype.getEquation=function(a){if(null===a)return this.computeEquation();for(var b=0;b<this.equations_.length;b++)if(this.equations_[b].name===a)return this.equations_[b];return null},g.prototype.computeEquation=function(){return this.compute_},g.prototype.hasVariablesOrFunctions=function(){return this.equations_.length>0},g.prototype.hasSingleFunction=function(){return 1===this.equations_.length&&this.equations_[0].isFunction()?!0:!1},g.prototype.isIdenticalTo=function(a){if(this.equations_.length!==a.equations_.length)return!1;var b=a.computeEquation().expression;if(!this.compute_.expression.isIdenticalTo(b))return!1;for(var c=0;c<this.equations_.length;c++){var d=this.equations_[c],e=a.getEquation(d.name);if(!e||!d.expression.isIdenticalTo(e.expression))return!1}return!0},g.prototype.sortedEquations=function(){return this.equations_.sort(function(a,b){return a.name.localeCompare(b.name)}),this.equations_},g.prototype.evaluate=function(){return this.evaluateWithExpression(this.compute_.expression)},g.prototype.evaluateWithExpression=function(a){if(0===this.equations_.length)return a.evaluate();var b,c,e={},f=function(a){c[a]=1};do{b=!1;for(var g=0;g<this.equations_.length;g++){var h=this.equations_[g];if(h.isFunction()){if(e[h.name])continue;if(c=d.clone(e),h.params.forEach(f),!h.expression.canEvaluate(c))continue;b=!0,e[h.name]={variables:h.params,expression:h.expression}}else void 0===e[h.name]&&h.expression.canEvaluate(e)&&(b=!0,e[h.name]=h.expression.evaluate(e))}}while(b);if(!a.canEvaluate(e))throw new Error("Can't resolve EquationSet");return a.evaluate(e)},g.__testonly__={getEquationFromBlock:c}},{"../utils":183,"./expressionNode":33}],31:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");require("../../locale/current/calc"),require("../../locale/current/common");buf.push("\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/calc":187,"../../locale/current/common":188,ejs:204}],29:[function(a,b,c){"use strict";function d(a,b){a.Blocks.functional_compute={helpUrl:"",init:function(){a.FunctionalBlockUtils.initTitledFunctionalBlock(this,e.compute(),a.BlockValueType.NONE,[{name:"ARG1",type:a.BlockValueType.NUMBER}])}},b.functional_compute=function(){var a=Blockly.JavaScript.statementToCode(this,"ARG1",!1)||0;return"Calc.compute("+a+", 'block_id_"+this.id+"');\n"}}var e=a("../../locale/current/calc"),f=(a("../../locale/current/common"),a("../sharedFunctionalBlocks"));c.install=function(a,b){var c=(b.skin,a.Generator.get("JavaScript"));a.JavaScript=c;var e=function(b){var d=a.Variables.NAME_TYPE;return c.variableDB_.getDistinctName(b,d)};f.install(a,c,e),d(a,c,e)}},{"../../locale/current/calc":187,"../../locale/current/common":188,"../sharedFunctionalBlocks":141}],187:[function(a,b){b.exports=window.blockly.appLocale},{}],28:[function(a,b,c){var d=a("./expressionNode");c.compute=function(a){Calc.computedExpression=a instanceof d?a:new d(parseFloat(a))},c.expression=function(a,b,c,e){return new d(a,[b,c],e)}},{"./expressionNode":33}],33:[function(a,b){var c=a("../utils"),d=c.getLodash(),e={ARITHMETIC:1,FUNCTION_CALL:2,VARIABLE:3,NUMBER:4},f=function(a,b,c){if(this.value_=a,this.blockId_=c,void 0===b&&(b=[]),!Array.isArray(b))throw new Error("Expected array");if(this.children_=b.map(function(a){return a instanceof f||(a=new f(a)),a}),this.getType()===e.NUMBER&&b.length>0)throw new Error("Can't have args for number ExpressionNode");if(this.getType()===e.ARITHMETIC&&2!==b.length)throw new Error("Arithmetic ExpressionNode needs 2 args")};b.exports=f,f.ValueType=e,f.prototype.getType=function(){return-1!==["+","-","*","/"].indexOf(this.value_)?e.ARITHMETIC:"string"==typeof this.value_?0===this.children_.length?e.VARIABLE:e.FUNCTION_CALL:"number"==typeof this.value_?e.NUMBER:void 0},f.prototype.clone=function(){var a=this.children_.map(function(a){return a.clone()});return new f(this.value_,a,this.blockId_)},f.prototype.canEvaluate=function(a){try{this.evaluate(a)}catch(b){return!1}return!0},f.prototype.evaluate=function(a){a=a||{};var b=this.getType();if(b===e.VARIABLE&&void 0!==a[this.value_]){var c=this.clone();return c.setValue(a[this.value_]),c.evaluate(a)}if(b===e.FUNCTION_CALL&&void 0!==a[this.value_]){var f=a[this.value_];if(!f.variables||!f.expression)throw new Error("Bad mapping for: "+this.value_);if(f.variables.length!==this.children_.length)throw new Error("Bad mapping for: "+this.value_);var g={};return d.keys(a).forEach(function(b){g[b]=a[b]}),f.variables.forEach(function(a,b){g[a]=this.getChildValue(b)},this),f.expression.evaluate(g)}if(b===e.VARIABLE||b===e.FUNCTION_CALL)throw new Error("Must resolve variables/functions before evaluation");if(b===e.NUMBER)return this.value_;if(b!==e.ARITHMETIC)throw new Error("Unexpected error");var h=this.children_[0].evaluate(a),i=this.children_[1].evaluate(a);switch(this.value_){case"+":return h+i;case"-":return h-i;case"*":return h*i;case"/":return h/i;default:throw new Error("Unknown operator: "+this.value_)}},f.prototype.depth=function(){for(var a=0,b=0;b<this.children_.length;b++)a=Math.max(a,1+this.children_[b].depth());return a},f.prototype.getDeepestOperation=function(){if(0===this.children_.length)return null;for(var a=null,b=0,c=0;c<this.children_.length;c++){var d=this.children_[c].depth();d>b&&(b=d,a=this.children_[c])}return 0===b?this:a.getDeepestOperation()},f.prototype.collapse=function(){var a=this.getDeepestOperation();return null===a?!1:this===a?(this.value_=this.evaluate(),this.children_=[],!0):a.collapse()},f.prototype.getTokenListDiff=function(a){var b,c=a&&this.value_===a.value_&&this.children_.length===a.children_.length,f=this.getType();if(0===this.children_.length)return[new g(this.value_.toString(),!c)];if(f===e.ARITHMETIC)b=[new g("(",!c)],this.children_.length>0&&b.push([this.children_[0].getTokenListDiff(c&&a.children_[0]),new g(" "+this.value_+" ",!c),this.children_[1].getTokenListDiff(c&&a.children_[1])]),b.push(new g(")",!c));else if(f===e.FUNCTION_CALL){b=[new g(this.value_,this.value_!==a.value_),new g("(",!c)];for(var h=0;h<this.children_.length;h++)h>0&&b.push(new g(",",!c)),b.push(this.children_[h].getTokenListDiff(c&&a.children_[h]));b.push(new g(")",!c))}else this.getType()===e.VARIABLE;return d.flatten(b)},f.prototype.getTokenList=function(a){var b=this.depth();if(1>=b)return this.getTokenListDiff(a?null:this);if(this.getType()!==e.ARITHMETIC)throw new Error("Unsupported");var c=this.children_[1].depth()>this.children_[0].depth();return d.flatten([new g("(",!1),this.children_[0].getTokenList(a&&!c),new g(" "+this.value_+" ",!1),this.children_[1].getTokenList(a&&c),new g(")",!1)])},f.prototype.isIdenticalTo=function(a){if(!a||this.value_!==a.value_||this.children_.length!==a.children_.length)return!1;for(var b=0;b<this.children_.length;b++)if(!this.children_[b].isIdenticalTo(a.children_[b]))return!1;return!0},f.prototype.hasSameSignature=function(a){return a?this.getType()!==e.FUNCTION_CALL||a.getType()!==e.FUNCTION_CALL?!1:this.value_!==a.value_?!1:this.children_.length!==a.children_.length?!1:!0:!1},f.prototype.isEquivalentTo=function(a){if(this.getType()!==e.ARITHMETIC)return this.isIdenticalTo(a);if(!a||this.value_!==a.value_)return!1;var b=this.children_[0],c=this.children_[1],d=a.children_[0],f=a.children_[1];return b.isEquivalentTo(d)?c.isEquivalentTo(f):b.isEquivalentTo(f)?c.isEquivalentTo(d):!1},f.prototype.numChildren=function(){return this.children_.length},f.prototype.setValue=function(a){var b=this.getType();if(b!==e.VARIABLE&&b!==e.NUMBER)throw new Error("Can't modify value");this.value_=a},f.prototype.getChildValue=function(a){return this.children_[a].value_},f.prototype.setChildValue=function(a,b){return this.children_[a].setValue(b)},f.prototype.debug=function(){return 0===this.children_.length?this.value_:"("+this.value_+" "+this.children_.map(function(a){return a.debug()}).join(" ")+")"};var g=function(a,b){this.str=a,this.marked=b};f.Token=g},{"../utils":183}]},{},[36]);