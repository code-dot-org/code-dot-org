require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({"/home/ubuntu/staging/apps/build/js/gamelab/main.js":[function(a,b,c){"use strict";var d=a("../appMain"),e=a("../StudioApp").singleton,f=a("./GameLab"),g=a("./blocks"),h=a("./skins"),i=a("./levels");window.gamelabMain=function(a){a.skinsModule=h,a.blocksModule=g;var b=new f;b.injectStudioApp(e),d(b,i,a)}},{"../StudioApp":"/home/ubuntu/staging/apps/build/js/StudioApp.js","../appMain":"/home/ubuntu/staging/apps/build/js/appMain.js","./GameLab":"/home/ubuntu/staging/apps/build/js/gamelab/GameLab.js","./blocks":"/home/ubuntu/staging/apps/build/js/gamelab/blocks.js","./levels":"/home/ubuntu/staging/apps/build/js/gamelab/levels.js","./skins":"/home/ubuntu/staging/apps/build/js/gamelab/skins.js"}],"/home/ubuntu/staging/apps/build/js/gamelab/skins.js":[function(a,b,c){"use strict";var d=a("../skins");c.load=function(a,b){var c=d.load(a,b);return c}},{"../skins":"/home/ubuntu/staging/apps/build/js/skins.js"}],"/home/ubuntu/staging/apps/build/js/gamelab/blocks.js":[function(a,b,c){"use strict";var d=a("./locale");a("../locale"),a("./GameLab");c.install=function(a,b){var c=(b.skin,a.Generator.get("JavaScript"));a.JavaScript=c,a.Blocks.gamelab_foo={helpUrl:"",init:function(){this.setHSV(184,1,.74),this.appendDummyInput().appendTitle(d.foo()),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(d.fooTooltip())}},c.gamelab_foo=function(){return"GameLab.foo();\n"}}},{"../locale":"/home/ubuntu/staging/apps/build/js/locale.js","./GameLab":"/home/ubuntu/staging/apps/build/js/gamelab/GameLab.js","./locale":"/home/ubuntu/staging/apps/build/js/gamelab/locale.js"}],"/home/ubuntu/staging/apps/build/js/gamelab/GameLab.js":[function(a,b,c){"use strict";var d=(a("../locale"),a("./locale")),e=(a("./levels"),a("../codegen")),f=a("./api"),g=a("./apiJavascript"),h=a("../templates/page.html.ejs"),i=a("../utils"),j=(a("../dropletUtils"),i.getLodash()),k=a("./dropletConfig"),l=a("../JSInterpreter"),m=function(){this.skin=null,this.level=null,this.tickIntervalId=0,this.tickCount=0,this.studioApp_=null,this.JSInterpreter=null,this.eventHandlers=[],this.Globals={},this.currentCmdQueue=null,this.api=f,this.api.injectGameLab(this),this.apiJS=g,this.apiJS.injectGameLab(this)};b.exports=m,m.prototype.injectStudioApp=function(a){this.studioApp_=a,this.studioApp_.reset=j.bind(this.reset,this),this.studioApp_.runButtonClick=j.bind(this.runButtonClick,this),this.studioApp_.setCheckForEmptyBlocks(!0)},m.prototype.init=function(b){if(!this.studioApp_)throw new Error("GameLab requires a StudioApp");this.skin=b.skin,this.level=b.level,b.dropletConfig=k;var c=("media/turtle/"+(b.isLegacyShare&&b.hideSource?"icons_white.png":"icons.png"),!this.level.isProjectLevel),d=j.isEmpty(this.level.softButtons),e=a("./controls.html.ejs")({assetUrl:this.studioApp_.assetUrl,finishButton:d&&c}),f=a("./extraControlRows.html.ejs")({assetUrl:this.studioApp_.assetUrl,finishButton:!d&&c});b.html=h({assetUrl:this.studioApp_.assetUrl,data:{visualization:"",localeDirection:this.studioApp_.localeDirection(),controls:e,extraControlRows:f,blockUsed:void 0,idealBlockNumber:void 0,editCode:this.level.editCode,blockCounterClass:"block-counter-default",readonlyWorkspace:b.readonlyWorkspace}}),b.loadAudio=j.bind(this.loadAudio_,this),b.afterInject=j.bind(this.afterInject_,this,b),this.studioApp_.init(b)},m.prototype.loadAudio_=function(){this.studioApp_.loadAudio(this.skin.winSound,"win"),this.studioApp_.loadAudio(this.skin.startSound,"start"),this.studioApp_.loadAudio(this.skin.failureSound,"failure")},m.prototype.afterInject_=function(a){this.studioApp_.isUsingBlockly()&&Blockly.JavaScript.addReservedWords("GameLab,code");var b=document.getElementById("visualizationColumn");b.style.width="400px"},m.prototype.reset=function(a){this.eventHandlers=[],window.clearInterval(this.tickIntervalId),this.tickIntervalId=0,this.tickCount=0,this.JSInterpreter=null,this.executionError=null},m.prototype.runButtonClick=function(){this.studioApp_.toggleRunReset("reset"),this.studioApp_.isUsingBlockly()&&Blockly.mainBlockSpace.traceOn(!0),this.studioApp_.attempts++,this.execute()},m.prototype.callHandler=function(a,b,c){this.eventHandlers.forEach(j.bind(function(d){if(this.studioApp_.isUsingBlockly()){if(d.name===a&&(b||0===d.cmdQueue.length)){this.currentCmdQueue=d.cmdQueue;try{d.func(this.studioApp_,this.api,this.Globals)}catch(e){}this.currentCmdQueue=null}}else d.name===a&&this.JSInterpreter.queueEvent(d.func,c)},this))},m.prototype.executeQueue=function(a,b){this.eventHandlers.forEach(j.bind(function(b){if(b.name===a&&b.cmdQueue.length)for(var c=b.cmdQueue[0];c&&this.callCmd(c);c=b.cmdQueue[0])b.cmdQueue.shift()},this))},m.prototype.evalCode=function(a){try{e.evalWith(a,{GameLab:this.api})}catch(b){b!==1/0&&(window.onerror&&window.onerror("UserCode:"+b.message,document.URL,0),window.alert(b))}},m.prototype.execute=function(){if(this.studioApp_.reset(),this.studioApp_.isUsingBlockly()&&(this.studioApp_.hasExtraTopBlocks()||this.studioApp_.hasDuplicateVariablesInForLoops()))return void this.checkAnswer();if(this.level.editCode){if(this.JSInterpreter=new l({code:this.studioApp_.getCode(),blocks:k.blocks,blockFilter:this.level.executePaletteApisOnly&&this.level.codeFunctions,enableEvents:!0,studioApp:this.studioApp_,onExecutionError:j.bind(this.handleExecutionError,this)}),!this.JSInterpreter.initialized())return}else this.code=Blockly.Generator.blockSpaceToCode("JavaScript"),this.evalCode(this.code);this.studioApp_.playAudio("start",{loop:!0}),this.studioApp_.isUsingBlockly()&&Blockly.mainBlockSpaceEditor.setEnableToolbox(!1),this.tickIntervalId=window.setInterval(j.bind(this.onTick,this),33)},m.prototype.onTick=function(){this.tickCount++;1===this.tickCount&&this.callHandler("whenGameStarts"),this.executeQueue("whenGameStarts"),this.callHandler("repeatForever"),this.executeQueue("repeatForever"),this.JSInterpreter&&this.JSInterpreter.executeInterpreter(1===this.tickCount)},m.prototype.handleExecutionError=function(a,b){throw a},m.prototype.executeCmd=function(a,b,c){console.log("GameLab executeCmd "+b)},m.prototype.finishExecution_=function(){this.studioApp_.isUsingBlockly()&&Blockly.mainBlockSpace.highlightBlock(null),this.checkAnswer()},m.prototype.displayFeedback_=function(){var a=this.level;this.studioApp_.displayFeedback({app:"gamelab",skin:this.skin.id,feedbackType:this.testResults,message:this.message,response:this.response,level:a,showingSharing:!a.disableSharing&&a.freePlay,saveToGalleryUrl:a.freePlay&&this.response&&this.response.save_to_gallery_url,appStrings:{reinfFeedbackMsg:d.reinfFeedbackMsg(),sharingText:d.shareDrawing()}})},m.prototype.onReportComplete=function(a){this.response=a;var b=document.getElementById("runButton");b.disabled=!1,this.displayFeedback_()},m.prototype.checkAnswer=function(){var a=this.level,b=a.freePlay&&(!a.editCode||!this.executionError);this.testResults=this.studioApp_.getTestResults(b);var c;if(this.studioApp_.isUsingBlockly()){var d=Blockly.Xml.blockSpaceToDom(Blockly.mainBlockSpace);c=Blockly.Xml.domToText(d)}this.message=void 0,a.editCode&&(c=this.studioApp_.editor.getValue()),a.freePlay&&(this.testResults=this.studioApp_.TestResults.FREE_PLAY),this.studioApp_.stopLoopingAudio("start"),this.testResults===this.studioApp_.TestResults.FREE_PLAY||this.testResults>=this.studioApp_.TestResults.TOO_MANY_BLOCKS_FAIL?this.studioApp_.playAudio("win"):this.studioApp_.playAudio("failure");var e={app:"gamelab",level:a.id,builder:a.builder,result:b,testResult:this.testResults,program:encodeURIComponent(c),onComplete:j.bind(this.onReportComplete,this)};this.studioApp_.report(e),this.studioApp_.isUsingBlockly()&&Blockly.mainBlockSpaceEditor.setEnableToolbox(!0)}},{"../JSInterpreter":"/home/ubuntu/staging/apps/build/js/JSInterpreter.js","../codegen":"/home/ubuntu/staging/apps/build/js/codegen.js","../dropletUtils":"/home/ubuntu/staging/apps/build/js/dropletUtils.js","../locale":"/home/ubuntu/staging/apps/build/js/locale.js","../templates/page.html.ejs":"/home/ubuntu/staging/apps/build/js/templates/page.html.ejs","../utils":"/home/ubuntu/staging/apps/build/js/utils.js","./api":"/home/ubuntu/staging/apps/build/js/gamelab/api.js","./apiJavascript":"/home/ubuntu/staging/apps/build/js/gamelab/apiJavascript.js","./controls.html.ejs":"/home/ubuntu/staging/apps/build/js/gamelab/controls.html.ejs","./dropletConfig":"/home/ubuntu/staging/apps/build/js/gamelab/dropletConfig.js","./extraControlRows.html.ejs":"/home/ubuntu/staging/apps/build/js/gamelab/extraControlRows.html.ejs","./levels":"/home/ubuntu/staging/apps/build/js/gamelab/levels.js","./locale":"/home/ubuntu/staging/apps/build/js/gamelab/locale.js"}],"/home/ubuntu/staging/apps/build/js/gamelab/levels.js":[function(a,b,c){"use strict";var d=(a("./locale"),a("../utils")),e=a("../block_utils"),f=e.createToolbox,g=e.blockOfType,h=(e.createCategory,b.exports={});h.custom={ideal:1/0,requiredBlocks:[],scale:{snapRadius:2},startBlocks:""},h.sandbox={ideal:1/0,requiredBlocks:[],scale:{snapRadius:2},softButtons:["leftButton","rightButton","downButton","upButton"],freePlay:!0,toolbox:f(g("gamelab_foo")),startBlocks:'<block type="when_run" deletable="false" x="20" y="20"></block>'},h.ec_sandbox=d.extend(h.sandbox,{editCode:!0,codeFunctions:{foo:null},startBlocks:""})},{"../block_utils":"/home/ubuntu/staging/apps/build/js/block_utils.js","../utils":"/home/ubuntu/staging/apps/build/js/utils.js","./locale":"/home/ubuntu/staging/apps/build/js/gamelab/locale.js"}],"/home/ubuntu/staging/apps/build/js/gamelab/extraControlRows.html.ejs":[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../locale");buf.push("\n"),buf.push("\n\n"),finishButton&&buf.push('\n  <div id="share-cell" class="share-cell-none">\n    <button id="finishButton" class="share">\n      <img src="',escape(assetUrl("media/1x1.gif")),'">',escape(a.finish()),"\n    </button>\n  </div>\n"),buf.push("\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../locale":"/home/ubuntu/staging/apps/build/js/locale.js",ejs:"/home/ubuntu/staging/apps/node_modules/ejs/lib/ejs.js"}],"/home/ubuntu/staging/apps/build/js/gamelab/dropletConfig.js":[function(a,b,c){"use strict";var d=(a("./locale"),a("./apiJavascript.js"));b.exports.blocks=[{func:"foo",parent:d,category:""}],b.exports.categories={"":{color:"red",blocks:[]},"Game Lab":{color:"red",blocks:[]},Commands:{color:"red",blocks:[]},Events:{color:"green",blocks:[]}},b.exports.autocompleteFunctionsWithParens=!0,b.exports.showParamDropdowns=!0},{"./apiJavascript.js":"/home/ubuntu/staging/apps/build/js/gamelab/apiJavascript.js","./locale":"/home/ubuntu/staging/apps/build/js/gamelab/locale.js"}],"/home/ubuntu/staging/apps/build/js/gamelab/locale.js":[function(a,b,c){"use strict";b.exports=window.blockly.gamelab_locale},{}],"/home/ubuntu/staging/apps/build/js/gamelab/controls.html.ejs":[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../locale");buf.push("\n"),buf.push('\n\n<div id="soft-buttons" class="soft-buttons-none">\n  <button id="leftButton" disabled=true class="arrow">\n    <img src="',escape(assetUrl("media/1x1.gif")),'" class="left-btn icon21">\n  </button>\n  <button id="rightButton" disabled=true class="arrow">\n    <img src="',escape(assetUrl("media/1x1.gif")),'" class="right-btn icon21">\n  </button>\n  <button id="upButton" disabled=true class="arrow">\n    <img src="',escape(assetUrl("media/1x1.gif")),'" class="up-btn icon21">\n  </button>\n  <button id="downButton" disabled=true class="arrow">\n    <img src="',escape(assetUrl("media/1x1.gif")),'" class="down-btn icon21">\n  </button>\n</div>\n\n'),finishButton&&buf.push('\n  <div id="share-cell" class="share-cell-none">\n    <button id="finishButton" class="share">\n      <img src="',escape(assetUrl("media/1x1.gif")),'">',escape(a.finish()),"\n    </button>\n  </div>\n"),buf.push("\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../locale":"/home/ubuntu/staging/apps/build/js/locale.js",ejs:"/home/ubuntu/staging/apps/node_modules/ejs/lib/ejs.js"}],"/home/ubuntu/staging/apps/build/js/gamelab/apiJavascript.js":[function(a,b,c){"use strict";var d;c.injectGameLab=function(a){d=a},c.foo=function(){d.executeCmd(null,"foo")}},{}],"/home/ubuntu/staging/apps/build/js/gamelab/api.js":[function(a,b,c){"use strict";var d;c.injectGameLab=function(a){d=a},c.random=function(a){var b=Math.floor(Math.random()*a.length);return a[b]},c.foo=function(a){d.executeCmd(a,"foo")}},{}]},{},["/home/ubuntu/staging/apps/build/js/gamelab/main.js"]);