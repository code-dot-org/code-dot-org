#
# This will generate two new files:
# scripts.en.new.yml - The file we want to end up with
# scripts.en.merged.yml - A file that contains both the new and the old keys

require 'yaml'

scripts_yml = File.expand_path('config/locales/scripts.en.yml')
i18n = YAML.load_file(scripts_yml)
i18n_new = i18n.deep_dup

i18n_new['en']['data']['script']['name'].each do |_, course_node|
  course_node['stages'] = {}
  course_node['stage'].each do |key, stage_node|
    # new key "stages"
    course_node['stages'][key] = {
      'name' => stage_node
    }
    course_node.delete('stage')
  end
end

merged = i18n.deep_merge(i18n_new)

File.write(File.expand_path('config/locales/scripts.en.new.yml'), "# Autogenerated scripts locale file.\n" + i18n_new.to_yaml(line_width: -1))
File.write(File.expand_path('config/locales/scripts.en.merged.yml'), "# Autogenerated scripts locale file.\n" + merged.to_yaml(line_width: -1))
