name: Experimental Health Check

on:
  pull_request:
    types: [opened, synchronize, reopened]
  workflow_dispatch:
    inputs:
      pullRequestNumber:
        description: 'Pull Request Number (for manual trigger)'
        required: true
        type: integer

jobs:
  health-check:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Code
      uses: actions/checkout@v2

    - name: Determine PR Number
      id: pr-info
      run: |
        echo "PR_NUMBER=${{ github.event.pull_request.number || github.event.inputs.pullRequestNumber }}" >> $GITHUB_ENV

    - name: Verify PR Author
      run: |
        if [ "${{ github.event.pull_request.user.login }}" != "pablo-code-org" ]; then
          echo "PR author is not pablo-code-org, skipping run."
          exit 78
        fi

    - name: Post Start Comment
      run: |
        pr_number=${{ env.PR_NUMBER }}
        github_token=${{ secrets.GITHUB_TOKEN }}
        curl \
          -X POST \
          -H "Authorization: token $github_token" \
          -H "Accept: application/vnd.github.v3+json" \
          "https://api.github.com/repos/${{ github.repository }}/issues/$pr_number/comments" \
          -d '{"body":"ðŸš€ Hi there! This is an experimental health check by GitHub Actions. It\'s part of a fun experiment, so feel free to ignore this message. ðŸŽ‰"}'

    # Add your health check steps here
    # - name: Run Health Check
    #   run: ...

    - name: Post Completion Comment
      run: |
        pr_number=${{ env.PR_NUMBER }}
        github_token=${{ secrets.GITHUB_TOKEN }}
        curl \
          -X POST \
          -H "Authorization: token $github_token" \
          -H "Accept: application/vnd.github.v3+json" \
          "https://api.github.com/repos/${{ github.repository }}/issues/$pr_number/comments" \
          -d '{"body":"âœ… The experimental health check is now complete! Thanks for participating in this fun test. ðŸ¥³"}'
